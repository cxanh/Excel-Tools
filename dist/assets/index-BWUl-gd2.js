import{P as M}from"./PluginTemplate-Bk8KtKqf.js";import{r as S}from"./py-lgh_vU0b.js";import{g as y}from"./plugin-DiTjGwyF.js";import{_ as V,r as p,m as j,b as d,h as F,d as h,w as s,g,e as n,i as f,c as A,F as B,j as C,t as I}from"./index-tMO3H4K7.js";const L={class:"plugin-content"},O={class:"settings-section"},H={__name:"index",setup(J){const m=p(1),l=p(null),u=p("csv"),v=p(""),_=p([]);j(()=>{var t;return(t=l.value)==null?void 0:t.files},async t=>{t&&t.length>0&&await x(t[0])},{deep:!0});const x=async t=>{try{if(!await y("convert-format"))return;const a=await S(`
import io
import openpyxl

def process(data):
    file_content = data['file']
    wb = openpyxl.load_workbook(io.BytesIO(file_content), read_only=True)
    return {
        'success': True,
        'sheetNames': wb.sheetnames,
        'activeSheet': wb.active.title
    }
    `,{type:"single",file:t.file,fileName:t.name,settings:{}});a.success&&(_.value=a.sheetNames||[],v.value=a.activeSheet||"")}catch(e){console.error("获取工作表名称失败:",e),_.value=[]}},N=async()=>{const t=l.value.files;if(t.length===0)return;const e=await y("convert-format");if(e)for(const o of t)try{const a=await S(e,{type:"single",file:o.file,fileName:o.name,settings:{targetFormat:u.value,sheetName:v.value}});if(a.success){let r=o.name.replace(/\.[^/.]+$/,""),i="application/octet-stream";u.value==="csv"?(r+=".csv",i="text/csv"):u.value==="json"?(r+=".json",i="application/json"):u.value==="html"&&(r+=".html",i="text/html"),l.value.handleFileProcessed({...o,name:r,mimeType:i},a)}else l.value.handleFileError(o,a.error||"转换失败")}catch(a){l.value.handleFileError(o,a.message||"转换失败")}},w=async()=>{m.value===1&&await N(),m.value++},b=t=>{l.value.addFiles(t)},T=()=>{l.value.importFromFolder()},k=()=>{l.value.showMoreActions()},P=()=>{m.value--},E=t=>{l.value.removeFile(t)};return(t,e)=>{const o=d("a-alert"),a=d("a-select-option"),r=d("a-select"),i=d("a-form-item");return h(),F(M,{"plugin-title":"Excel 转换为其它格式","info-message":"将Excel文件转换为CSV、JSON、HTML等其他格式","current-step":m.value,onAddFile:b,onImportFolder:T,onMoreAction:k,onNextStep:w,onPrevStep:P,onRemoveFile:E,ref_key:"pluginTemplate",ref:l},{default:s(()=>[g("div",L,[n(o,{message:"格式转换说明",description:"支持将Excel文件转换为CSV、JSON和HTML格式。转换时仅处理单个工作表。",type:"info","show-icon":"",class:"mb-4"}),g("div",O,[e[5]||(e[5]=g("h3",{class:"section-title"},"转换设置",-1)),n(i,{label:"目标格式"},{default:s(()=>[n(r,{value:u.value,"onUpdate:value":e[0]||(e[0]=c=>u.value=c),placeholder:"请选择目标格式"},{default:s(()=>[n(a,{value:"csv"},{default:s(()=>[...e[2]||(e[2]=[f("CSV",-1)])]),_:1}),n(a,{value:"json"},{default:s(()=>[...e[3]||(e[3]=[f("JSON",-1)])]),_:1}),n(a,{value:"html"},{default:s(()=>[...e[4]||(e[4]=[f("HTML",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),n(i,{label:"工作表选择"},{default:s(()=>[n(r,{value:v.value,"onUpdate:value":e[1]||(e[1]=c=>v.value=c),placeholder:"自动选择活动工作表"},{default:s(()=>[(h(!0),A(B,null,C(_.value,c=>(h(),F(a,{key:c,value:c},{default:s(()=>[f(I(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})])])]),_:1},8,["current-step"])}}},q=V(H,[["__scopeId","data-v-1c7b9a3c"]]);export{q as default};
