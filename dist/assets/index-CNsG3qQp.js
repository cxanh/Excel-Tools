import{P as E}from"./PluginTemplate-CSzU_o8L.js";import{r as R}from"./py-Dmvp32T8.js";import{g as G}from"./plugin-DiTjGwyF.js";import{_ as O,r as v,m as K,b as d,h as F,d as _,w as t,g as x,e as l,c as N,f as j,i as n,F as S}from"./index-ArcfRATZ.js";const q={class:"plugin-content"},z={class:"settings-section"},D={__name:"index",setup(H){const c=v(1),u=v(null),p=v("by_row"),y=v(","),g=v("utf-8"),b=v("by_index"),s=v({rowsPerFile:1e3,columnIndex:0,columnName:""});K(p,r=>{r==="by_row"?s.value.rowsPerFile=1e3:r==="by_column"&&(s.value.columnIndex=0,s.value.columnName="",b.value="by_index")});const k=async()=>{const r=u.value.files;if(r.length===0)return;const e=await G("split-csv");if(e)for(const i of r)try{const a=await R(e,{type:"single",file:i.file,fileName:i.name,settings:{splitMode:p.value,delimiter:y.value,encoding:g.value,splitOptions:s.value}});if(a.success)if(a.results&&a.results.length>0)for(const f of a.results)u.value.handleFileProcessed({...i,name:f.file_name,mimeType:"text/csv"},{...a,buffer:f.buffer});else u.value.handleFileProcessed(i,a);else u.value.handleFileError(i,a.error||"拆分失败")}catch(a){u.value.handleFileError(i,a.message||"拆分失败")}},U=async()=>{c.value===1&&await k(),c.value++},T=r=>{u.value.addFiles(r)},V=()=>{u.value.importFromFolder()},C=()=>{u.value.showMoreActions()},I=()=>{c.value--},B=r=>{u.value.removeFile(r)};return(r,e)=>{const i=d("a-alert"),a=d("a-select-option"),f=d("a-select"),m=d("a-form-item"),w=d("a-input-number"),P=d("a-radio"),A=d("a-radio-group"),M=d("a-input");return _(),F(E,{"plugin-title":"CSV 拆分成多个文件","info-message":"将一个CSV文件根据指定条件拆分成多个CSV文件","current-step":c.value,onAddFile:T,onImportFolder:V,onMoreAction:C,onNextStep:U,onPrevStep:I,onRemoveFile:B,ref_key:"pluginTemplate",ref:u},{default:t(()=>[x("div",q,[l(i,{message:"拆分说明",description:"支持两种拆分模式：按行数拆分和按列值拆分。请确保CSV文件包含表头。",type:"info","show-icon":"",class:"mb-4"}),x("div",z,[e[18]||(e[18]=x("h3",{class:"section-title"},"拆分设置",-1)),l(m,{label:"拆分模式"},{default:t(()=>[l(f,{value:p.value,"onUpdate:value":e[0]||(e[0]=o=>p.value=o),placeholder:"请选择拆分模式"},{default:t(()=>[l(a,{value:"by_row"},{default:t(()=>[...e[7]||(e[7]=[n("按行数拆分",-1)])]),_:1}),l(a,{value:"by_column"},{default:t(()=>[...e[8]||(e[8]=[n("按列值拆分",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(m,{label:"分隔符"},{default:t(()=>[l(f,{value:y.value,"onUpdate:value":e[1]||(e[1]=o=>y.value=o),placeholder:"请选择分隔符"},{default:t(()=>[l(a,{value:","},{default:t(()=>[...e[9]||(e[9]=[n("逗号 (,)",-1)])]),_:1}),l(a,{value:";"},{default:t(()=>[...e[10]||(e[10]=[n("分号 (;)",-1)])]),_:1}),l(a,{value:"\\t"},{default:t(()=>[...e[11]||(e[11]=[n("制表符 (Tab)",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(m,{label:"编码"},{default:t(()=>[l(f,{value:g.value,"onUpdate:value":e[2]||(e[2]=o=>g.value=o),placeholder:"请选择文件编码"},{default:t(()=>[l(a,{value:"utf-8"},{default:t(()=>[...e[12]||(e[12]=[n("UTF-8",-1)])]),_:1}),l(a,{value:"gbk"},{default:t(()=>[...e[13]||(e[13]=[n("GBK",-1)])]),_:1}),l(a,{value:"gb2312"},{default:t(()=>[...e[14]||(e[14]=[n("GB2312",-1)])]),_:1}),l(a,{value:"utf-16"},{default:t(()=>[...e[15]||(e[15]=[n("UTF-16",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),p.value==="by_row"?(_(),N(S,{key:0},[l(m,{label:"每文件行数"},{default:t(()=>[l(w,{value:s.value.rowsPerFile,"onUpdate:value":e[3]||(e[3]=o=>s.value.rowsPerFile=o),min:1,max:1e5,placeholder:"请输入每文件行数"},null,8,["value"])]),_:1}),l(i,{message:"注意",description:"建议每文件行数不超过10000行，以保证处理速度和稳定性。",type:"warning","show-icon":"",class:"mt-2 mb-2"})],64)):p.value==="by_column"?(_(),N(S,{key:1},[l(m,{label:"拆分列"},{default:t(()=>[l(A,{value:b.value,"onUpdate:value":e[4]||(e[4]=o=>b.value=o),class:"mr-4"},{default:t(()=>[l(P,{value:"by_index"},{default:t(()=>[...e[16]||(e[16]=[n("按列索引",-1)])]),_:1}),l(P,{value:"by_name"},{default:t(()=>[...e[17]||(e[17]=[n("按列名",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),b.value==="by_index"?(_(),F(m,{key:0,label:"列索引"},{default:t(()=>[l(w,{value:s.value.columnIndex,"onUpdate:value":e[5]||(e[5]=o=>s.value.columnIndex=o),min:0,max:1e3,placeholder:"请输入列索引（从0开始）"},null,8,["value"])]),_:1})):(_(),F(m,{key:1,label:"列名"},{default:t(()=>[l(M,{value:s.value.columnName,"onUpdate:value":e[6]||(e[6]=o=>s.value.columnName=o),placeholder:"请输入列名"},null,8,["value"])]),_:1})),l(i,{message:"提示",description:"拆分将基于所选列的唯一值进行，每个唯一值生成一个新文件。",type:"info","show-icon":"",class:"mt-2 mb-2"})],64)):j("",!0)])])]),_:1},8,["current-step"])}}},X=O(D,[["__scopeId","data-v-399fccf6"]]);export{X as default};
