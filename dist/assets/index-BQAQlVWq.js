import{_ as G,u as J,r as b,a as Q,o as W,b as n,c as d,d as r,e as t,f as X,g as u,w as l,i as p,t as x,l as Z,v as ee,F as T,j as $,h as P,k as te}from"./index-ArcfRATZ.js";import{P as le}from"./PluginTemplate-CSzU_o8L.js";import{r as M}from"./py-Dmvp32T8.js";import{g as ae}from"./plugin-DiTjGwyF.js";import{P as se}from"./PlayCircleOutlined-69VyeNye.js";const oe={class:"plugin-container"},ne={key:0,class:"step-content"},re={key:1,class:"step-content"},ie={class:"slider-value"},ue={class:"slider-value"},de={class:"color-picker-container"},pe={class:"color-value"},ce={key:2,class:"step-content"},fe={key:3,class:"step-content"},me={key:4,class:"step-content"},ve={class:"log-container"},_e={class:"start-process-container"},ye={key:0,class:"success-result"},ke={key:1,class:"error-result"},ge="添加 Excel 文字水印",we=4,be={__name:"index",setup(xe){J();const g=b(null),c=b(0),S=b(!1),y=b([]),A=b({success:!1,error:null}),w=b(!1),B=b([]),s=Q({watermark:{text:"水印",fontName:"Arial",fontSize:36,color:"#000000",opacity:.3,rotation:-45},sheetNames:["*"]}),z=async()=>{if(!(!g.value||g.value.files.length===0))try{const o=g.value.files[0],e=await o.file.arrayBuffer(),f=new Uint8Array(e),i=await M(`
import io
from openpyxl import load_workbook

def process(input_data):
    file = input_data["file"]
    wb = load_workbook(io.BytesIO(file))
    return {
        'success': True,
        'sheetNames': wb.sheetnames
    }
`,{type:"single",file:f,fileName:o.name,settings:{}});i.success&&i.sheetNames&&(B.value=i.sheetNames)}catch(o){console.error("获取工作表列表失败:",o)}},I=async o=>{console.log("添加文件:",o)},L=()=>{console.log("从文件夹导入")},O=o=>{console.log("更多操作:",o)},V=()=>{c.value<we&&c.value++},j=()=>{c.value>0&&c.value--},E=o=>{console.log("删除文件:",o)},D=async()=>{if(!(!g.value||g.value.files.length===0)){S.value=!0,y.value=["开始处理文件..."];try{const o=await ae("add-watermark");if(!o){y.value.push("获取Python脚本失败");return}const e=g.value.files;for(let f=0;f<e.length;f++){const k=e[f];y.value.push(`正在处理文件：${k.name}`);const i=await k.file.arrayBuffer(),N=new Uint8Array(i),m=await M(o,{type:"single",file:N,fileName:k.name,settings:s});if(y.value.push(`${k.name} 处理完成！`),y.value.push(...m.logs),m.success&&m.buffer){const v=new Blob([m.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),U=URL.createObjectURL(v),_=document.createElement("a");_.href=U,_.download=`${k.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,_.click(),URL.revokeObjectURL(U)}}y.value.push("所有文件处理完成！"),A.value={success:!0,error:null},w.value=!0}catch(o){y.value.push(`处理错误: ${o.message}`),A.value={success:!1,error:o.message},w.value=!0}finally{S.value=!1}}};return W(()=>{console.log("插件初始化")}),(o,e)=>{const f=n("a-divider"),k=n("a-input"),i=n("a-form-item"),N=n("a-form"),m=n("a-card"),v=n("a-select-option"),U=n("a-select"),_=n("a-col"),H=n("a-input-number"),C=n("a-slider"),h=n("a-row"),F=n("a-button"),K=n("a-spin"),R=n("a-result"),Y=n("a-modal");return r(),d("div",oe,[t(le,{ref_key:"pluginTemplate",ref:g,"plugin-title":ge,"current-step":c.value,onAddFile:I,onImportFolder:L,onMoreAction:O,onNextStep:V,onPrevStep:j,onRemoveFile:E},null,8,["current-step"]),c.value===0?(r(),d("div",ne)):c.value===1?(r(),d("div",re,[e[18]||(e[18]=u("h3",{class:"step-title"},"设置水印",-1)),t(f),t(m,{title:"水印内容",class:"setting-card"},{default:l(()=>[t(N,{layout:"vertical"},{default:l(()=>[t(i,{label:"水印文字"},{default:l(()=>[t(k,{value:s.watermark.text,"onUpdate:value":e[0]||(e[0]=a=>s.watermark.text=a),placeholder:"请输入水印文字",size:"large"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(m,{title:"水印样式",class:"setting-card"},{default:l(()=>[t(N,{layout:"vertical"},{default:l(()=>[t(h,{gutter:[16,16]},{default:l(()=>[t(_,{span:8},{default:l(()=>[t(i,{label:"字体"},{default:l(()=>[t(U,{value:s.watermark.fontName,"onUpdate:value":e[1]||(e[1]=a=>s.watermark.fontName=a),style:{width:"100%"}},{default:l(()=>[t(v,{value:"Arial"},{default:l(()=>[...e[11]||(e[11]=[p("Arial",-1)])]),_:1}),t(v,{value:"SimSun"},{default:l(()=>[...e[12]||(e[12]=[p("宋体",-1)])]),_:1}),t(v,{value:"SimHei"},{default:l(()=>[...e[13]||(e[13]=[p("黑体",-1)])]),_:1}),t(v,{value:"KaiTi"},{default:l(()=>[...e[14]||(e[14]=[p("楷体",-1)])]),_:1}),t(v,{value:"Microsoft YaHei"},{default:l(()=>[...e[15]||(e[15]=[p("微软雅黑",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(_,{span:8},{default:l(()=>[t(i,{label:"字体大小"},{default:l(()=>[t(H,{value:s.watermark.fontSize,"onUpdate:value":e[2]||(e[2]=a=>s.watermark.fontSize=a),min:8,max:120,step:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(_,{span:8},{default:l(()=>[t(i,{label:"旋转角度"},{default:l(()=>[t(C,{value:s.watermark.rotation,"onUpdate:value":e[3]||(e[3]=a=>s.watermark.rotation=a),min:-180,max:180,step:1},null,8,["value"]),u("div",ie,x(s.watermark.rotation)+"°",1)]),_:1})]),_:1})]),_:1}),t(h,{gutter:[16,16]},{default:l(()=>[t(_,{span:8},{default:l(()=>[t(i,{label:"透明度"},{default:l(()=>[t(C,{value:s.watermark.opacity,"onUpdate:value":e[4]||(e[4]=a=>s.watermark.opacity=a),min:0,max:1,step:.05},null,8,["value"]),u("div",ue,x((s.watermark.opacity*100).toFixed(0))+"%",1)]),_:1})]),_:1}),t(_,{span:8},{default:l(()=>[t(i,{label:"文字颜色"},{default:l(()=>[u("div",de,[Z(u("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=a=>s.watermark.color=a),class:"color-picker"},null,512),[[ee,s.watermark.color]]),u("span",pe,x(s.watermark.color),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(m,{title:"工作表选择",class:"setting-card"},{default:l(()=>[t(N,{layout:"vertical"},{default:l(()=>[t(i,{label:"选择工作表"},{default:l(()=>[t(U,{value:s.sheetNames,"onUpdate:value":e[6]||(e[6]=a=>s.sheetNames=a),mode:"multiple",placeholder:"选择要处理的工作表，默认处理所有工作表",style:{width:"100%"}},{default:l(()=>[t(v,{value:"*"},{default:l(()=>[...e[16]||(e[16]=[p("所有工作表",-1)])]),_:1}),(r(!0),d(T,null,$(B.value,a=>(r(),P(v,{key:a,value:a},{default:l(()=>[p(x(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(F,{type:"primary",onClick:z},{default:l(()=>[...e[17]||(e[17]=[p("获取工作表列表",-1)])]),_:1})]),_:1})]),_:1})])):c.value===2?(r(),d("div",ce,[e[19]||(e[19]=u("h3",{class:"step-title"},"设置其它选项",-1)),t(f),e[20]||(e[20]=u("p",{class:"placeholder-text"},"此步骤暂无配置项",-1))])):c.value===3?(r(),d("div",fe,[e[21]||(e[21]=u("h3",{class:"step-title"},"设置输出目录",-1)),t(f),e[22]||(e[22]=u("p",{class:"placeholder-text"},"处理完成后将自动下载文件",-1))])):c.value===4?(r(),d("div",me,[e[23]||(e[23]=u("h3",{class:"step-title"},"开始处理",-1)),t(f),t(m,{title:"处理日志",class:"log-card"},{default:l(()=>[u("div",ve,[(r(!0),d(T,null,$(y.value,(a,q)=>(r(),d("div",{key:q,class:"log-item"},x(a),1))),128))])]),_:1}),u("div",_e,[t(F,{type:"primary",size:"large",icon:"play-circle",onClick:D,disabled:S.value},{icon:l(()=>[S.value?(r(),P(K,{key:0})):(r(),P(te(se),{key:1}))]),default:l(()=>[p(" "+x(S.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):X("",!0),t(Y,{open:w.value,"onUpdate:open":e[9]||(e[9]=a=>w.value=a),title:"处理结果",onOk:e[10]||(e[10]=a=>w.value=!1)},{default:l(()=>[A.value.success?(r(),d("div",ye,[t(R,{status:"success",title:"处理成功","sub-title":"所有文件已成功处理完成"},{extra:l(()=>[t(F,{type:"primary",onClick:e[7]||(e[7]=a=>w.value=!1)},{default:l(()=>[...e[24]||(e[24]=[p(" 确定 ",-1)])]),_:1})]),_:1})])):(r(),d("div",ke,[t(R,{status:"error",title:"处理失败","sub-title":A.value.error||"处理过程中发生错误"},{extra:l(()=>[t(F,{type:"primary",onClick:e[8]||(e[8]=a=>w.value=!1)},{default:l(()=>[...e[25]||(e[25]=[p(" 确定 ",-1)])]),_:1})]),_:1},8,["sub-title"])]))]),_:1},8,["open"])])}}},Pe=G(be,[["__scopeId","data-v-1d33444b"]]);export{Pe as default};
