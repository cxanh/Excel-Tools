import{_ as V,u as E,r as b,a as z,o as D,b as r,c as v,d as u,e,f as q,g as _,w as l,F as G,j as H,t as S,i as F,h as B,k as J}from"./index-tMO3H4K7.js";import{P as K}from"./PluginTemplate-Bk8KtKqf.js";import{r as Q}from"./py-lgh_vU0b.js";import{g as W}from"./plugin-DiTjGwyF.js";import{P as X}from"./PlayCircleOutlined-1DyGFteB.js";const Y={class:"plugin-container"},Z={key:0,class:"step-content"},ee={key:1,class:"step-content"},te={key:2,class:"step-content"},le={key:3,class:"step-content"},se={key:4,class:"step-content"},ae={class:"log-container"},oe={class:"start-process-container"},ne={key:0,class:"success-result"},re={key:1,class:"error-result"},ue="修改 Excel 文件属性",pe=4,ie={__name:"index",setup(de){E();const x=b(null),d=b(0),k=b(!1),f=b([]),U=b({success:!1,error:null}),g=b(!1),a=z({properties:{title:"",author:"",subject:"",description:"",keywords:"",category:"",status:"",company:"",manager:""}}),C=async n=>{console.log("添加文件:",n)},N=()=>{console.log("从文件夹导入")},$=n=>{console.log("更多操作:",n)},j=()=>{d.value<pe&&d.value++},A=()=>{d.value>0&&d.value--},L=n=>{console.log("删除文件:",n)},T=async()=>{if(!(!x.value||x.value.files.length===0)){k.value=!0,f.value=["开始处理文件..."];try{const n=await W("update-file-properties");if(!n){f.value.push("获取Python脚本失败");return}const t=x.value.files;for(let m=0;m<t.length;m++){const o=t[m];f.value.push(`正在处理文件：${o.name}`);const p=await o.file.arrayBuffer(),i=new Uint8Array(p),c=await Q(n,{type:"single",file:i,fileName:o.name,settings:a});if(f.value.push(`${o.name} 处理完成！`),f.value.push(...c.logs),c.success&&c.buffer){const P=new Blob([c.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=URL.createObjectURL(P),y=document.createElement("a");y.href=w,y.download=`${o.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,y.click(),URL.revokeObjectURL(w)}}f.value.push("所有文件处理完成！"),U.value={success:!0,error:null},g.value=!0}catch(n){f.value.push(`处理错误: ${n.message}`),U.value={success:!1,error:n.message},g.value=!0}finally{k.value=!1}}};return D(()=>{console.log("插件初始化")}),(n,t)=>{const m=r("a-divider"),o=r("a-input"),p=r("a-form-item"),i=r("a-col"),c=r("a-row"),P=r("a-textarea"),w=r("a-form"),y=r("a-card"),I=r("a-spin"),h=r("a-button"),R=r("a-result"),M=r("a-modal");return u(),v("div",Y,[e(K,{ref_key:"pluginTemplate",ref:x,"plugin-title":ue,"current-step":d.value,onAddFile:C,onImportFolder:N,onMoreAction:$,onNextStep:j,onPrevStep:A,onRemoveFile:L},null,8,["current-step"]),d.value===0?(u(),v("div",Z)):d.value===1?(u(),v("div",ee,[t[13]||(t[13]=_("h3",{class:"step-title"},"设置文件属性",-1)),e(m),e(y,{title:"文件属性设置",class:"setting-card"},{default:l(()=>[e(w,{layout:"vertical"},{default:l(()=>[e(c,{gutter:[16,16]},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(p,{label:"标题"},{default:l(()=>[e(o,{value:a.properties.title,"onUpdate:value":t[0]||(t[0]=s=>a.properties.title=s),placeholder:"输入文件标题"},null,8,["value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(p,{label:"作者"},{default:l(()=>[e(o,{value:a.properties.author,"onUpdate:value":t[1]||(t[1]=s=>a.properties.author=s),placeholder:"输入作者名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:[16,16]},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(p,{label:"主题"},{default:l(()=>[e(o,{value:a.properties.subject,"onUpdate:value":t[2]||(t[2]=s=>a.properties.subject=s),placeholder:"输入文件主题"},null,8,["value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(p,{label:"分类"},{default:l(()=>[e(o,{value:a.properties.category,"onUpdate:value":t[3]||(t[3]=s=>a.properties.category=s),placeholder:"输入文件分类"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:[16,16]},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(p,{label:"关键词"},{default:l(()=>[e(o,{value:a.properties.keywords,"onUpdate:value":t[4]||(t[4]=s=>a.properties.keywords=s),placeholder:"输入关键词，多个关键词用分号分隔"},null,8,["value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(p,{label:"状态"},{default:l(()=>[e(o,{value:a.properties.status,"onUpdate:value":t[5]||(t[5]=s=>a.properties.status=s),placeholder:"输入文件状态"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:[16,16]},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(p,{label:"公司"},{default:l(()=>[e(o,{value:a.properties.company,"onUpdate:value":t[6]||(t[6]=s=>a.properties.company=s),placeholder:"输入公司名称"},null,8,["value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(p,{label:"经理"},{default:l(()=>[e(o,{value:a.properties.manager,"onUpdate:value":t[7]||(t[7]=s=>a.properties.manager=s),placeholder:"输入经理名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:[16,16]},{default:l(()=>[e(i,{span:24},{default:l(()=>[e(p,{label:"描述"},{default:l(()=>[e(P,{value:a.properties.description,"onUpdate:value":t[8]||(t[8]=s=>a.properties.description=s),placeholder:"输入文件描述",rows:4},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):d.value===2?(u(),v("div",te,[t[14]||(t[14]=_("h3",{class:"step-title"},"设置其它选项",-1)),e(m),t[15]||(t[15]=_("p",{class:"placeholder-text"},"此步骤暂无配置项",-1))])):d.value===3?(u(),v("div",le,[t[16]||(t[16]=_("h3",{class:"step-title"},"设置输出目录",-1)),e(m),t[17]||(t[17]=_("p",{class:"placeholder-text"},"处理完成后将自动下载文件",-1))])):d.value===4?(u(),v("div",se,[t[18]||(t[18]=_("h3",{class:"step-title"},"开始处理",-1)),e(m),e(y,{title:"处理日志",class:"log-card"},{default:l(()=>[_("div",ae,[(u(!0),v(G,null,H(f.value,(s,O)=>(u(),v("div",{key:O,class:"log-item"},S(s),1))),128))])]),_:1}),_("div",oe,[e(h,{type:"primary",size:"large",icon:"play-circle",onClick:T,disabled:k.value},{icon:l(()=>[k.value?(u(),B(I,{key:0})):(u(),B(J(X),{key:1}))]),default:l(()=>[F(" "+S(k.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):q("",!0),e(M,{open:g.value,"onUpdate:open":t[11]||(t[11]=s=>g.value=s),title:"处理结果",onOk:t[12]||(t[12]=s=>g.value=!1)},{default:l(()=>[U.value.success?(u(),v("div",ne,[e(R,{status:"success",title:"处理成功","sub-title":"所有文件已成功处理完成"},{extra:l(()=>[e(h,{type:"primary",onClick:t[9]||(t[9]=s=>g.value=!1)},{default:l(()=>[...t[19]||(t[19]=[F(" 确定 ",-1)])]),_:1})]),_:1})])):(u(),v("div",re,[e(R,{status:"error",title:"处理失败","sub-title":U.value.error||"处理过程中发生错误"},{extra:l(()=>[e(h,{type:"primary",onClick:t[10]||(t[10]=s=>g.value=!1)},{default:l(()=>[...t[20]||(t[20]=[F(" 确定 ",-1)])]),_:1})]),_:1},8,["sub-title"])]))]),_:1},8,["open"])])}}},ge=V(ie,[["__scopeId","data-v-6ac462e3"]]);export{ge as default};
