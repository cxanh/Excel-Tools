import{_ as ee,u as te,r as _,a as le,o as se,b as n,c as r,d as o,e as t,f as M,g as i,w as l,i as c,F as B,j as F,h as T,t as $,k as ae}from"./index-ArcfRATZ.js";import{P as oe}from"./PluginTemplate-CSzU_o8L.js";import{r as O}from"./py-Dmvp32T8.js";import{g as ne}from"./plugin-DiTjGwyF.js";import{P as re}from"./PlayCircleOutlined-69VyeNye.js";const ue={class:"plugin-container"},ie={key:0,class:"step-content"},ce={key:1,class:"step-content"},de={class:"rules-list"},pe={class:"rule-actions"},fe={class:"preview-section"},me={key:0,class:"sheets-list"},ve={key:2,class:"step-content"},_e={key:3,class:"step-content"},ye={key:4,class:"step-content"},ge={class:"log-container"},ke={class:"start-process-container"},he={key:0,class:"success-result"},be={key:1,class:"error-result"},xe="重命名 Excel 工作表",we=4,Re={__name:"index",setup(Ne){te();const y=_(null),d=_(0),N=_(!1),m=_([]),S=_({success:!1,error:null}),g=_(!1),P=_([]),x=_(["0"]),k=le({renameRules:[{enabled:!0,matchType:"exact",oldName:"Sheet1",newName:"新工作表1"}]}),V=()=>{k.renameRules.push({enabled:!0,matchType:"exact",oldName:"",newName:""}),x.value=[String(k.renameRules.length-1)]},j=a=>{k.renameRules.splice(a,1),x.value.length>0&&parseInt(x.value[0])>=k.renameRules.length&&(x.value=[String(Math.max(0,k.renameRules.length-1))])},E=async()=>{if(!(!y.value||y.value.files.length===0))try{const a=y.value.files[0],e=await a.file.arrayBuffer(),p=new Uint8Array(e),h=await O(`
import io
from openpyxl import load_workbook

def process(input_data):
    file = input_data["file"]
    wb = load_workbook(io.BytesIO(file))
    return {
        'success': True,
        'sheetNames': wb.sheetnames
    }
`,{type:"single",file:p,fileName:a.name,settings:{}});h.success&&h.sheetNames&&(P.value=h.sheetNames)}catch(a){console.error("获取工作表列表失败:",a)}},K=async a=>{console.log("添加文件:",a)},z=()=>{console.log("从文件夹导入")},D=a=>{console.log("更多操作:",a)},q=()=>{d.value<we&&d.value++},G=()=>{d.value>0&&d.value--},H=a=>{console.log("删除文件:",a)},J=async()=>{if(!(!y.value||y.value.files.length===0)){N.value=!0,m.value=["开始处理文件..."];try{const a=await ne("rename-sheets");if(!a){m.value.push("获取Python脚本失败");return}const e=y.value.files;for(let p=0;p<e.length;p++){const u=e[p];m.value.push(`正在处理文件：${u.name}`);const h=await u.file.arrayBuffer(),w=new Uint8Array(h),f=await O(a,{type:"single",file:w,fileName:u.name,settings:k});if(m.value.push(`${u.name} 处理完成！`),m.value.push(...f.logs),f.success&&f.buffer){const b=new Blob([f.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=URL.createObjectURL(b),R=document.createElement("a");R.href=C,R.download=`${u.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,R.click(),URL.revokeObjectURL(C)}}m.value.push("所有文件处理完成！"),S.value={success:!0,error:null},g.value=!0}catch(a){m.value.push(`处理错误: ${a.message}`),S.value={success:!1,error:a.message},g.value=!0}finally{N.value=!1}}};return se(()=>{console.log("插件初始化")}),(a,e)=>{const p=n("a-divider"),u=n("a-button"),h=n("a-checkbox"),w=n("a-form-item"),f=n("a-col"),b=n("a-select-option"),C=n("a-select"),R=n("a-row"),A=n("a-input"),Q=n("a-form"),W=n("a-collapse-panel"),X=n("a-collapse"),I=n("a-card"),Y=n("a-spin"),L=n("a-result"),Z=n("a-modal");return o(),r("div",ue,[t(oe,{ref_key:"pluginTemplate",ref:y,"plugin-title":xe,"current-step":d.value,onAddFile:K,onImportFolder:z,onMoreAction:D,onNextStep:q,onPrevStep:G,onRemoveFile:H},null,8,["current-step"]),d.value===0?(o(),r("div",ie)):d.value===1?(o(),r("div",ce,[e[15]||(e[15]=i("h3",{class:"step-title"},"设置重命名规则",-1)),t(p),t(I,{title:"工作表重命名规则",class:"setting-card"},{default:l(()=>[t(u,{type:"primary",onClick:V,icon:"plus"},{default:l(()=>[...e[5]||(e[5]=[c(" 添加重命名规则 ",-1)])]),_:1}),i("div",de,[t(X,{"active-key":x.value,"onUpdate:activeKey":e[0]||(e[0]=s=>x.value=s)},{default:l(()=>[(o(!0),r(B,null,F(k.renameRules,(s,U)=>(o(),T(W,{key:U,header:`规则 ${U+1}`},{default:l(()=>[t(Q,{layout:"vertical",model:s},{default:l(()=>[t(R,{gutter:[16,16]},{default:l(()=>[t(f,{span:8},{default:l(()=>[t(w,{label:"启用规则"},{default:l(()=>[t(h,{checked:s.enabled,"onUpdate:checked":v=>s.enabled=v},{default:l(()=>[...e[6]||(e[6]=[c("启用",-1)])]),_:1},8,["checked","onUpdate:checked"])]),_:2},1024)]),_:2},1024),t(f,{span:16},{default:l(()=>[t(w,{label:"匹配方式"},{default:l(()=>[t(C,{value:s.matchType,"onUpdate:value":v=>s.matchType=v,style:{width:"100%"}},{default:l(()=>[t(b,{value:"exact"},{default:l(()=>[...e[7]||(e[7]=[c("精确匹配",-1)])]),_:1}),t(b,{value:"contains"},{default:l(()=>[...e[8]||(e[8]=[c("包含匹配",-1)])]),_:1}),t(b,{value:"prefix"},{default:l(()=>[...e[9]||(e[9]=[c("前缀匹配",-1)])]),_:1}),t(b,{value:"suffix"},{default:l(()=>[...e[10]||(e[10]=[c("后缀匹配",-1)])]),_:1}),t(b,{value:"regex"},{default:l(()=>[...e[11]||(e[11]=[c("正则表达式",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(R,{gutter:[16,16]},{default:l(()=>[t(f,{span:12},{default:l(()=>[t(w,{label:"原工作表名"},{default:l(()=>[t(A,{value:s.oldName,"onUpdate:value":v=>s.oldName=v,placeholder:"输入原工作表名或匹配模式"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(f,{span:12},{default:l(()=>[t(w,{label:"新工作表名"},{default:l(()=>[t(A,{value:s.newName,"onUpdate:value":v=>s.newName=v,placeholder:"输入新工作表名"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),i("div",pe,[t(u,{type:"default",onClick:v=>j(U),danger:""},{default:l(()=>[...e[12]||(e[12]=[c(" 删除规则 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["model"])]),_:2},1032,["header"]))),128))]),_:1},8,["active-key"])]),i("div",fe,[t(u,{type:"primary",onClick:E},{default:l(()=>[...e[13]||(e[13]=[c("获取工作表列表",-1)])]),_:1}),P.value.length>0?(o(),r("div",me,[e[14]||(e[14]=i("h4",null,"工作表列表：",-1)),i("ul",null,[(o(!0),r(B,null,F(P.value,s=>(o(),r("li",{key:s},$(s),1))),128))])])):M("",!0)])]),_:1})])):d.value===2?(o(),r("div",ve,[e[16]||(e[16]=i("h3",{class:"step-title"},"设置其它选项",-1)),t(p),e[17]||(e[17]=i("p",{class:"placeholder-text"},"此步骤暂无配置项",-1))])):d.value===3?(o(),r("div",_e,[e[18]||(e[18]=i("h3",{class:"step-title"},"设置输出目录",-1)),t(p),e[19]||(e[19]=i("p",{class:"placeholder-text"},"处理完成后将自动下载文件",-1))])):d.value===4?(o(),r("div",ye,[e[20]||(e[20]=i("h3",{class:"step-title"},"开始处理",-1)),t(p),t(I,{title:"处理日志",class:"log-card"},{default:l(()=>[i("div",ge,[(o(!0),r(B,null,F(m.value,(s,U)=>(o(),r("div",{key:U,class:"log-item"},$(s),1))),128))])]),_:1}),i("div",ke,[t(u,{type:"primary",size:"large",icon:"play-circle",onClick:J,disabled:N.value},{icon:l(()=>[N.value?(o(),T(Y,{key:0})):(o(),T(ae(re),{key:1}))]),default:l(()=>[c(" "+$(N.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):M("",!0),t(Z,{open:g.value,"onUpdate:open":e[3]||(e[3]=s=>g.value=s),title:"处理结果",onOk:e[4]||(e[4]=s=>g.value=!1)},{default:l(()=>[S.value.success?(o(),r("div",he,[t(L,{status:"success",title:"处理成功","sub-title":"所有文件已成功处理完成"},{extra:l(()=>[t(u,{type:"primary",onClick:e[1]||(e[1]=s=>g.value=!1)},{default:l(()=>[...e[21]||(e[21]=[c(" 确定 ",-1)])]),_:1})]),_:1})])):(o(),r("div",be,[t(L,{status:"error",title:"处理失败","sub-title":S.value.error||"处理过程中发生错误"},{extra:l(()=>[t(u,{type:"primary",onClick:e[2]||(e[2]=s=>g.value=!1)},{default:l(()=>[...e[22]||(e[22]=[c(" 确定 ",-1)])]),_:1})]),_:1},8,["sub-title"])]))]),_:1},8,["open"])])}}},Fe=ee(Re,[["__scopeId","data-v-9bc4830a"]]);export{Fe as default};
