import{P as X}from"./PluginTemplate-Bk8KtKqf.js";import{r as Y}from"./py-lgh_vU0b.js";import{_ as Z,r as g,b as s,c as _,d,e as t,g as i,f as p,h as T,w as l,t as v,i as f}from"./index-tMO3H4K7.js";const ee={class:"delete-pictures"},te={style:{display:"none"}},le={key:0,class:"step-content"},ae={class:"ant-upload-drag-icon"},ne={key:0,style:{"margin-top":"16px"}},se={key:1,class:"step-content"},oe={key:2,class:"size-conditions"},ue={key:2,class:"step-content"},ie={class:"settings-summary"},re={key:0},de={key:1},pe={key:0},ce={key:1},ve={key:4,style:{margin:"16px 0"}},me={__name:"index",setup(_e){const B=g(null),m=g(0),n=g([]),I=g(!1),y=g(0),o=g([]),U=g(null),a=g({sheetOption:"all",specificSheets:"",deleteRange:["shapes"],keepConditions:[],sizeThreshold:{width:100,height:100}}),E=async()=>(await fetch("/plugins/delete-pictures/worker.py")).text(),L=()=>{U.value&&U.value.click()},V=()=>{o.value.push("从文件夹导入功能开发中...")},M=r=>{switch(r){case"paste":o.value.push("从剪贴板读取功能开发中...");break;case"clear":n.value=[];break}},j=async()=>{if(m.value===0)m.value=1,o.value.push("进入上传文件步骤...");else if(m.value===1){if(n.length===0){o.value.push("请先上传文件");return}m.value=2,o.value.push("进入设置步骤...")}else m.value===2?(m.value=3,o.value.push("进入预览和确认步骤...")):m.value===3&&await q()},A=r=>{n.value.splice(r,1)},D=r=>{const e=Array.from(r.target.files);e.length>0&&(n.value=[...n.value,...e]),r.target.value=""},J=r=>(n.value.push(r),!1),q=async()=>{if(n.length!==0){I.value=!0,o.value=["开始处理文件..."],y.value=10;try{const r=await E();y.value=30,o.value.push(`处理文件数量: ${n.length} 个`),o.value.push(`设置参数: ${JSON.stringify(a.value)}`);for(let e=0;e<n.length;e++){const x=n.value[e],b=e+1;o.value.push(`开始处理文件 ${b}/${n.length}: ${x.name}`);const S=new FileReader,w=await new Promise(C=>{S.onload=c=>C(c.target.result),S.readAsArrayBuffer(x)});y.value=40+Math.round(e/n.length*40);const z={type:"single",file:new Uint8Array(w),fileName:x.name,settings:a.value},h=await Y(r,z);if(h.success){if(o.value.push(`文件 ${b}/${n.length} 处理成功`),o.value.push(`删除了 ${h.deletedCount} 个图片`),h.buffer){const C=new Blob([h.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=URL.createObjectURL(C),k=document.createElement("a");k.href=c,k.download=`处理后_${x.name}`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(c),o.value.push(`文件已下载: 处理后_${x.name}`)}}else o.value.push(`文件 ${b}/${n.length} 处理失败: ${h.error}`)}y.value=100,o.value.push("所有文件处理完成！")}catch(r){o.value.push(`处理错误: ${r.message}`),console.error("Processing error:",r)}finally{I.value=!1}}};return(r,e)=>{const x=s("a-icon"),b=s("a-upload-dragger"),S=s("a-button"),w=s("a-list-item"),z=s("a-list"),h=s("a-radio"),C=s("a-radio-group"),c=s("a-form-item"),k=s("a-input"),$=s("a-checkbox"),N=s("a-checkbox-group"),O=s("a-input-number"),P=s("a-col"),G=s("a-row"),H=s("a-form"),K=s("a-alert"),F=s("a-descriptions-item"),Q=s("a-descriptions"),W=s("a-progress");return d(),_("div",ee,[t(X,{"plugin-title":"删除图片","info-message":"批量删除 Excel 文档中的图片，可以删除指定工作表或整个工作簿中的图片","current-step":m.value,onAddFile:L,onImportFolder:V,onMoreAction:M,onNextStep:j,onRemoveFile:A,ref_key:"pluginTemplate",ref:B},null,8,["current-step"]),i("div",te,[i("input",{ref_key:"fileInput",ref:U,type:"file",accept:".xlsx,.xls",multiple:"",onChange:D},null,544)]),m.value===1?(d(),_("div",le,[e[9]||(e[9]=i("h3",null,"上传Excel文件",-1)),t(b,{name:"file",multiple:!0,"show-upload-list":!1,accept:".xlsx,.xls","before-upload":J},{default:l(()=>[i("p",ae,[t(x,{type:"file-excel",style:{"font-size":"48px",color:"#52c41a"}})]),e[6]||(e[6]=i("p",{class:"ant-upload-text"},"点击或拖拽Excel文件到此处上传",-1)),e[7]||(e[7]=i("p",{class:"ant-upload-hint"},"支持 .xlsx, .xls 格式文件",-1))]),_:1}),n.value.length>0?(d(),_("div",ne,[i("h4",null,"已上传文件 ("+v(n.value.length)+")",1),t(z,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small"},{renderItem:l(({item:u,index:R})=>[t(w,null,{default:l(()=>[i("span",null,v(R+1)+". "+v(u.name),1),t(S,{type:"link",danger:"",size:"small",onClick:fe=>A(R)},{default:l(()=>[...e[8]||(e[8]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data-source"])])):p("",!0)])):p("",!0),m.value===2?(d(),_("div",se,[e[17]||(e[17]=i("h3",null,"删除图片设置",-1)),t(H,{layout:"vertical"},{default:l(()=>[t(c,{label:"工作表选择"},{default:l(()=>[t(C,{value:a.value.sheetOption,"onUpdate:value":e[0]||(e[0]=u=>a.value.sheetOption=u)},{default:l(()=>[t(h,{value:"all"},{default:l(()=>[...e[10]||(e[10]=[f("删除所有工作表中的图片",-1)])]),_:1}),t(h,{value:"specific"},{default:l(()=>[...e[11]||(e[11]=[f("只删除指定工作表中的图片",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.sheetOption==="specific"?(d(),T(c,{key:0,label:"指定工作表名称（多个用逗号分隔）"},{default:l(()=>[t(k,{value:a.value.specificSheets,"onUpdate:value":e[1]||(e[1]=u=>a.value.specificSheets=u),placeholder:"例如：Sheet1,Sheet2",style:{"max-width":"400px"}},null,8,["value"]),e[12]||(e[12]=i("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 不区分大小写，支持部分匹配（例如：Sheet* 匹配所有以 Sheet 开头的工作表） ",-1))]),_:1})):p("",!0),t(c,{label:"删除范围"},{default:l(()=>[t(N,{value:a.value.deleteRange,"onUpdate:value":e[2]||(e[2]=u=>a.value.deleteRange=u)},{default:l(()=>[t($,{value:"shapes"},{default:l(()=>[...e[13]||(e[13]=[f("删除所有形状（包含图片、图表、文本框等）",-1)])]),_:1}),t($,{value:"comments"},{default:l(()=>[...e[14]||(e[14]=[f("删除批注中的图片",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.deleteRange.includes("shapes")?(d(),T(c,{key:1,label:"保留条件"},{default:l(()=>[t(N,{value:a.value.keepConditions,"onUpdate:value":e[3]||(e[3]=u=>a.value.keepConditions=u)},{default:l(()=>[t($,{value:"small"},{default:l(()=>[...e[15]||(e[15]=[f("保留小于指定尺寸的图片（尺寸可配置）",-1)])]),_:1}),t($,{value:"large"},{default:l(()=>[...e[16]||(e[16]=[f("保留大于指定尺寸的图片（尺寸可配置）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):p("",!0),a.value.keepConditions.length>0?(d(),_("div",oe,[t(c,{label:"尺寸阈值（像素）"},{default:l(()=>[t(G,{gutter:16},{default:l(()=>[t(P,{span:12},{default:l(()=>[t(c,{label:"宽度","no-colon":""},{default:l(()=>[t(O,{value:a.value.sizeThreshold.width,"onUpdate:value":e[4]||(e[4]=u=>a.value.sizeThreshold.width=u),min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(P,{span:12},{default:l(()=>[t(c,{label:"高度","no-colon":""},{default:l(()=>[t(O,{value:a.value.sizeThreshold.height,"onUpdate:value":e[5]||(e[5]=u=>a.value.sizeThreshold.height=u),min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})])):p("",!0)]),_:1})])):p("",!0),m.value===3?(d(),_("div",ue,[e[19]||(e[19]=i("h3",null,"预览和确认",-1)),t(K,{message:"处理前预览",description:"以下是您选择的文件和设置，点击开始处理后将执行图片删除操作",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),i("div",ie,[i("h4",null,"文件列表 ("+v(n.value.length)+")",1),t(z,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small",style:{"margin-bottom":"20px"}},{renderItem:l(({item:u,index:R})=>[t(w,null,{default:l(()=>[i("span",null,v(R+1)+". "+v(u.name),1)]),_:2},1024)]),_:1},8,["data-source"]),e[18]||(e[18]=i("h4",null,"处理设置",-1)),t(Q,{bordered:"",column:"{1}",size:"small"},{default:l(()=>[t(F,{label:"工作表选择"},{default:l(()=>[f(v(a.value.sheetOption==="all"?"所有工作表":`指定工作表: ${a.value.specificSheets}`),1)]),_:1}),t(F,{label:"删除范围"},{default:l(()=>[a.value.deleteRange.includes("shapes")?(d(),_("span",re,"形状（图片、图表等）")):p("",!0),a.value.deleteRange.includes("comments")?(d(),_("span",de,"，批注图片")):p("",!0)]),_:1}),a.value.keepConditions.length>0?(d(),T(F,{key:0,label:"保留条件"},{default:l(()=>[a.value.keepConditions.includes("small")?(d(),_("div",pe," 保留小于 "+v(a.value.sizeThreshold.width)+"x"+v(a.value.sizeThreshold.height)+" 像素的图片 ",1)):p("",!0),a.value.keepConditions.includes("large")?(d(),_("div",ce," 保留大于 "+v(a.value.sizeThreshold.width)+"x"+v(a.value.sizeThreshold.height)+" 像素的图片 ",1)):p("",!0)]),_:1})):p("",!0)]),_:1})])])):p("",!0),y.value>0&&y.value<100?(d(),T(W,{key:3,percent:y.value,style:{margin:"16px 0"}},null,8,["percent"])):p("",!0),o.value.length>0?(d(),_("div",ve,[e[20]||(e[20]=i("h3",null,"处理日志",-1)),t(z,{bordered:"","data-source":o.value,size:"small"},{renderItem:l(({item:u})=>[t(w,null,{default:l(()=>[f(v(u),1)]),_:2},1024)]),_:1},8,["data-source"])])):p("",!0)])}}},xe=Z(me,[["__scopeId","data-v-c8519a9d"]]);export{xe as default};
