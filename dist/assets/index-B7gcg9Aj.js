import{_ as pe,u as ce,r as x,a as f,c as m,o as p,b as a,d as u,e as g,f as R,w as s,g as i,t as c,F as I,i as P,n as me}from"./index-B5FopeIw.js";import{P as fe,r as ge}from"./py-CjQq9lry.js";const ye={class:"replace-content"},ke={style:{display:"none"}},xe={key:0,class:"step-content"},he={class:"replacement-rules"},_e={class:"rule-item"},be={class:"rule-index"},we={class:"rule-content"},Ue={key:1,class:"step-content"},Oe={key:2,class:"step-content"},$e={key:0,style:{"margin-top":"12px"}},Ce={key:0,style:{"margin-left":"12px",color:"#666"}},Se={key:3,class:"step-content"},Te={class:"processing-summary"},Re={class:"settings-summary"},Le={class:"rule-summary"},Me={key:5,class:"step-content step-result"},De={class:"success-banner"},Fe={class:"success-info"},Ie={class:"logs-container"},Ne={class:"logs-content"},Ee={class:"processing-results"},Pe={class:"result-item"},Ke={class:"result-value"},Ae={class:"result-table-container"},Be={key:2,class:"file-path"},ze={class:"result-actions"},je={key:6,style:{margin:"16px 0"}},He={__name:"index",setup(Ve){ce();const N=x(null),r=x(0),y=x([]),_=x([{findText:"",replaceText:"",matchMode:"normal"}]),M=x(!1),w=x(0),n=x([]),K=x(null),$=x([]),D=x(0),A=x(["1"]),B=x(["result","details"]),H=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"处理的文件名",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"替换次数",dataIndex:"replacements",key:"replacements",width:120},{title:"处理耗时 (秒)",dataIndex:"time",key:"time",width:120,customRender:()=>"0.09"},{title:"处理后的路径",dataIndex:"downloadName",key:"path",width:200},{title:"操作",dataIndex:"action",key:"action",width:100,fixed:"right"}],t=x({caseSensitive:!1,matchEntireCell:!1,ignoreHiddenCells:!0,sheetOption:"all",selectedSheets:"",rangeOption:"all",customRange:"",enableDetailedLogs:!0,backupOriginal:!1,outputLocation:"same",customOutputDir:"",filenameMode:"append",filenameSuffix:"_处理后"}),V=async()=>(await fetch("/plugins/replace-content/worker.py")).text(),q=()=>{var o;(o=K.value)==null||o.click()},J=()=>{n.value.push("从文件夹导入功能开发中...")},G=o=>{switch(o){case"paste":n.value.push("从剪贴板读取功能开发中...");break;case"clear":y.value=[];break}},Q=async()=>{if(r.value===0){if(y.value.length===0){n.value.push("请先添加需要处理的Excel文件");return}r.value=1,n.value.push("进入设置处理规则步骤...")}else if(r.value===1){if(_.value.length===0||_.value.some(o=>!o.findText)){n.value.push("请确保所有替换规则都已填写完整");return}r.value=2,n.value.push("进入设置其他选项步骤...")}else if(r.value===2)r.value=3,n.value.push("进入设置输出目录步骤...");else if(r.value===3){if(t.value.outputLocation==="custom"&&!t.value.customOutputDir){n.value.push('请选择输出目录或切换为"与源文件相同目录"');return}r.value=4,n.value.push("进入开始处理步骤...")}else r.value===4&&(r.value=5,n.value.push("进入处理结果步骤..."))},z=()=>{r.value===1?(r.value=0,n.value.push("返回文件选择步骤...")):r.value===2?(r.value=1,n.value.push("返回设置处理规则步骤...")):r.value===3?(r.value=2,n.value.push("返回设置其他选项步骤...")):r.value===4?(r.value=3,n.value.push("返回设置输出目录步骤...")):r.value===5&&(r.value=4,n.value.push("返回处理步骤..."))},W=o=>{y.value=y.value.filter(e=>e.key!==o)},X=o=>{const e=Array.from(o.target.files);e.length>0&&(e.forEach((d,h)=>{const v={key:`${d.name}-${Date.now()}-${h}`,index:y.value.length+h+1,name:d.name,path:d.name,extension:d.name.split(".").pop(),createTime:new Date(d.lastModified).toLocaleString(),modifyTime:new Date(d.lastModified).toLocaleString(),file:d};y.value.push(v)}),o.target.value="",me(()=>{N.value&&(N.value.files=y.value)}))},Y=()=>{_.value.push({findText:"",replaceText:"",matchMode:"normal"})},Z=o=>{_.value.length>1?_.value.splice(o,1):n.value.push("至少需要保留一条替换规则")},ee=()=>{const o=[];return t.caseSensitive&&o.push("区分大小写"),t.matchEntireCell&&o.push("匹配整个单元格"),t.ignoreHiddenCells&&o.push("忽略隐藏单元格"),o.length>0?o.join(", "):"默认"},te=()=>({all:"处理所有工作表",active:"只处理当前工作表",selected:`指定工作表：${t.selectedSheets}`})[t.sheetOption]||"处理所有工作表",le=()=>t.rangeOption==="custom"?`自定义范围：${t.customRange}`:{all:"整个工作表",data:"仅数据区域"}[t.rangeOption]||"整个工作表",ae=()=>t.outputLocation==="same"?"与源文件相同目录":t.customOutputDir||"未选择输出目录",se=()=>{const o="C:\\ExcelFiles\\Output";t.customOutputDir=o,n.value.push(`已选择输出目录：${o}`)},ue=async()=>{if(y.value.length!==0){M.value=!0,n.value=["开始处理文件..."],w.value=10,$.value=[],D.value=0;try{const o=await V();w.value=30,n.value.push(`替换规则数量：${_.value.length}`),_.value.forEach((e,d)=>{n.value.push(`规则 ${d+1}: 查找"${e.findText}" → 替换为"${e.replaceText||"（删除）"}" (${e.matchMode==="regex"?"正则":"普通"})`)}),n.value.push(`高级设置：${JSON.stringify(t)}`);for(let e=0;e<y.value.length;e++){const d=y.value[e];n.value.push(`正在处理文件：${d.name}`);const h={file:d.file,replacementRules:_.value,settings:t.value},v=await ge(o,h);w.value=30+Math.round((e+1)/y.value.length*50),n.value.push(`${d.name} 处理完成！`),n.value.push(...v.logs);let L=0;v.statistics&&(L=v.statistics.totalReplacements||0,D.value+=L,n.value.push("文件处理统计:"),n.value.push(`  - 工作表数: ${v.statistics.totalSheets}`),n.value.push(`  - 处理单元格数: ${v.statistics.totalCells}`),n.value.push(`  - 替换次数: ${v.statistics.totalReplacements}`),n.value.push(`  - 有效规则数: ${v.statistics.validRules}`));let U=null,O=d.name;if(v.success&&v.buffer){const F=new Blob([v.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});if(U=URL.createObjectURL(F),t.value.filenameMode==="append"){const[C,S]=O.split(".");O=`${C}${t.value.filenameSuffix}.${S}`}else if(t.value.filenameMode==="custom"&&t.value.customFilename){const C=O.split(".").pop();O=`${t.value.customFilename}.${C}`}}else n.value.push(`警告: 无法处理 ${d.name}，可能处理失败`);$.value.push({key:d.key,index:e+1,name:d.name,originalName:d.name,downloadName:O,downloadUrl:U,status:v.success?"success":"error",replacements:L,error:v.error||null})}n.value.push("所有文件处理完成！"),n.value.push(`总替换次数：${D.value} 次`),w.value=100}catch(o){n.value.push(`错误：${o.message}`),console.error("Processing error:",o)}finally{M.value=!1}}},ne=o=>{if(!o.downloadUrl){n.value.push(`无法下载文件 ${o.name}：没有有效的下载链接`);return}const e=document.createElement("a");e.href=o.downloadUrl,e.download=o.downloadName,e.click(),n.value.push(`正在下载文件：${o.downloadName}`)},oe=()=>{$.value.forEach(o=>{o.downloadUrl&&URL.revokeObjectURL(o.downloadUrl)}),r.value=0,M.value=!1,w.value=0,n.value=[],$.value=[],D.value=0,n.value.push("准备重新处理文件...")};return(o,e)=>{const d=f("a-button"),h=f("a-input"),v=f("a-form-item"),L=f("a-radio-button"),U=f("a-radio-group"),O=f("a-list-item"),F=f("a-list"),C=f("a-form"),S=f("a-checkbox"),b=f("a-radio"),ie=f("a-progress"),E=f("a-collapse-panel"),j=f("a-collapse"),re=f("a-tag"),de=f("a-table"),ve=f("a-icon");return p(),m("div",ye,[a(fe,{"plugin-title":"按规则修改内容","info-message":"用于批量在 Excel 文档中查找并替换/删除指定内容，支持多种匹配规则","current-step":r.value,onAddFile:q,onImportFolder:J,onMoreAction:G,onNextStep:Q,onPrevStep:z,onRemoveFile:W,ref_key:"pluginTemplate",ref:N},null,8,["current-step"]),u("div",ke,[u("input",{ref_key:"fileInput",ref:K,type:"file",accept:".xlsx,.xls",multiple:"",onChange:X},null,544)]),r.value===1?(p(),m("div",xe,[e[19]||(e[19]=u("h3",null,"替换规则设置",-1)),a(C,{layout:"vertical"},{default:s(()=>[u("div",he,[a(d,{type:"primary",icon:"plus",onClick:Y,style:{"margin-bottom":"16px"}},{default:s(()=>[...e[15]||(e[15]=[i(" 添加替换规则 ",-1)])]),_:1}),a(F,{"data-source":_.value.value,bordered:"",size:"small"},{renderItem:s(({item:l,index:k})=>[a(O,null,{default:s(()=>[u("div",_e,[u("div",be,c(k+1),1),u("div",we,[a(v,{label:"查找内容",required:""},{default:s(()=>[a(h,{value:l.findText,"onUpdate:value":T=>l.findText=T,placeholder:"请输入要查找的内容",style:{"margin-right":"8px",width:"200px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(v,{label:"替换为",required:""},{default:s(()=>[a(h,{value:l.replaceText,"onUpdate:value":T=>l.replaceText=T,placeholder:"请输入替换后的内容（留空表示删除）",style:{"margin-right":"8px",width:"200px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(v,{label:"匹配模式"},{default:s(()=>[a(U,{value:l.matchMode,"onUpdate:value":T=>l.matchMode=T,"button-style":"solid"},{default:s(()=>[a(L,{value:"normal"},{default:s(()=>[...e[16]||(e[16]=[i("普通",-1)])]),_:1}),a(L,{value:"regex"},{default:s(()=>[...e[17]||(e[17]=[i("正则表达式",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024)]),a(d,{type:"text",danger:"",onClick:T=>Z(k)},{default:s(()=>[...e[18]||(e[18]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:1},8,["data-source"])])]),_:1})])):g("",!0),r.value===2?(p(),m("div",Ue,[e[31]||(e[31]=u("h3",null,"高级设置",-1)),a(C,{layout:"vertical"},{default:s(()=>[a(v,{label:"匹配选项"},{default:s(()=>[a(S,{checked:t.value.caseSensitive,"onUpdate:checked":e[0]||(e[0]=l=>t.value.caseSensitive=l)},{default:s(()=>[...e[20]||(e[20]=[i("区分大小写",-1)])]),_:1},8,["checked"]),a(S,{checked:t.value.matchEntireCell,"onUpdate:checked":e[1]||(e[1]=l=>t.value.matchEntireCell=l)},{default:s(()=>[...e[21]||(e[21]=[i("匹配整个单元格",-1)])]),_:1},8,["checked"]),a(S,{checked:t.value.ignoreHiddenCells,"onUpdate:checked":e[2]||(e[2]=l=>t.value.ignoreHiddenCells=l)},{default:s(()=>[...e[22]||(e[22]=[i("忽略隐藏单元格",-1)])]),_:1},8,["checked"])]),_:1}),a(v,{label:"工作表选项"},{default:s(()=>[a(U,{value:t.value.sheetOption,"onUpdate:value":e[3]||(e[3]=l=>t.value.sheetOption=l)},{default:s(()=>[a(b,{value:"all"},{default:s(()=>[...e[23]||(e[23]=[i("处理所有工作表",-1)])]),_:1}),a(b,{value:"active"},{default:s(()=>[...e[24]||(e[24]=[i("只处理当前工作表",-1)])]),_:1}),a(b,{value:"selected"},{default:s(()=>[...e[25]||(e[25]=[i("指定工作表（用逗号分隔）",-1)])]),_:1})]),_:1},8,["value"]),t.value.value.sheetOption==="selected"?(p(),R(h,{key:0,value:t.value.selectedSheets,"onUpdate:value":e[4]||(e[4]=l=>t.value.selectedSheets=l),placeholder:"请输入工作表名称，用逗号分隔",style:{"margin-top":"12px"}},null,8,["value"])):g("",!0)]),_:1}),a(v,{label:"处理范围"},{default:s(()=>[a(U,{value:t.value.rangeOption,"onUpdate:value":e[5]||(e[5]=l=>t.value.rangeOption=l)},{default:s(()=>[a(b,{value:"all"},{default:s(()=>[...e[26]||(e[26]=[i("整个工作表",-1)])]),_:1}),a(b,{value:"data"},{default:s(()=>[...e[27]||(e[27]=[i("仅数据区域",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[28]||(e[28]=[i("自定义范围",-1)])]),_:1})]),_:1},8,["value"]),t.value.value.rangeOption==="custom"?(p(),R(h,{key:0,value:t.value.customRange,"onUpdate:value":e[6]||(e[6]=l=>t.value.customRange=l),placeholder:"请输入单元格范围（例如：A1:D100）",style:{"margin-top":"12px"}},null,8,["value"])):g("",!0)]),_:1}),a(v,{label:"其他选项"},{default:s(()=>[a(S,{checked:t.value.enableDetailedLogs,"onUpdate:checked":e[7]||(e[7]=l=>t.value.enableDetailedLogs=l)},{default:s(()=>[...e[29]||(e[29]=[i("启用详细日志",-1)])]),_:1},8,["checked"]),a(S,{checked:t.value.backupOriginal,"onUpdate:checked":e[8]||(e[8]=l=>t.value.backupOriginal=l)},{default:s(()=>[...e[30]||(e[30]=[i("创建源文件备份",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})])):g("",!0),r.value===3?(p(),m("div",Oe,[e[37]||(e[37]=u("h3",null,"输出目录设置",-1)),a(C,{layout:"vertical"},{default:s(()=>[a(v,{label:"输出目录"},{default:s(()=>[a(U,{value:t.value.outputLocation,"onUpdate:value":e[9]||(e[9]=l=>t.value.outputLocation=l)},{default:s(()=>[a(b,{value:"same"},{default:s(()=>[...e[32]||(e[32]=[i("与源文件相同目录",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[33]||(e[33]=[i("指定输出目录",-1)])]),_:1})]),_:1},8,["value"]),t.value.value.outputLocation==="custom"?(p(),m("div",$e,[a(d,{type:"primary",onClick:se},{default:s(()=>[...e[34]||(e[34]=[i("选择输出目录",-1)])]),_:1}),t.value.value.customOutputDir?(p(),m("span",Ce,c(t.value.value.customOutputDir),1)):g("",!0)])):g("",!0)]),_:1}),a(v,{label:"文件名设置"},{default:s(()=>[a(U,{value:t.value.filenameMode,"onUpdate:value":e[10]||(e[10]=l=>t.value.filenameMode=l)},{default:s(()=>[a(b,{value:"append"},{default:s(()=>[...e[35]||(e[35]=[i("在原文件名后添加后缀",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[36]||(e[36]=[i("自定义文件名",-1)])]),_:1})]),_:1},8,["value"]),t.value.value.filenameMode==="append"?(p(),R(h,{key:0,value:t.value.filenameSuffix,"onUpdate:value":e[11]||(e[11]=l=>t.value.filenameSuffix=l),placeholder:"请输入文件名后缀（如：_处理后）",style:{"margin-top":"12px"}},null,8,["value"])):g("",!0),t.value.value.filenameMode==="custom"?(p(),R(h,{key:1,value:t.value.customFilename,"onUpdate:value":e[12]||(e[12]=l=>t.value.customFilename=l),placeholder:"请输入自定义文件名（不包含扩展名）",style:{"margin-top":"12px"}},null,8,["value"])):g("",!0)]),_:1})]),_:1})])):g("",!0),r.value===4?(p(),m("div",Se,[e[46]||(e[46]=u("h3",null,"处理确认",-1)),u("div",Te,[u("p",null,[e[38]||(e[38]=i("即将处理 ",-1)),u("strong",null,c(y.value.value.length),1),e[39]||(e[39]=i(" 个文件：",-1))]),u("ul",null,[(p(!0),m(I,null,P(y.value.value,l=>(p(),m("li",{key:l.key},c(l.name),1))),128))]),u("div",Re,[e[44]||(e[44]=u("h4",null,"替换规则：",-1)),u("ul",Le,[(p(!0),m(I,null,P(_.value.value,(l,k)=>(p(),m("li",{key:k},c(k+1)+'. 查找: "'+c(l.findText)+'" → 替换为: "'+c(l.replaceText||"（删除）")+'" ('+c(l.matchMode==="regex"?"正则":"普通")+") ",1))),128))]),e[45]||(e[45]=u("h4",null,"高级设置：",-1)),u("p",null,[e[40]||(e[40]=u("strong",null,"匹配选项：",-1)),i(c(ee()),1)]),u("p",null,[e[41]||(e[41]=u("strong",null,"工作表选项：",-1)),i(c(te()),1)]),u("p",null,[e[42]||(e[42]=u("strong",null,"处理范围：",-1)),i(c(le()),1)]),u("p",null,[e[43]||(e[43]=u("strong",null,"输出位置：",-1)),i(c(ae()),1)])]),a(d,{type:"primary",size:"large",onClick:ue,disabled:M.value.value},{default:s(()=>[i(c(M.value.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):g("",!0),w.value>0&&w.value<100?(p(),R(ie,{key:4,percent:w.value,style:{margin:"16px 0"}},null,8,["percent"])):g("",!0),r.value===5?(p(),m("div",Me,[u("div",De,[e[48]||(e[48]=u("div",{class:"success-icon"},[u("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none"},[u("circle",{cx:"32",cy:"32",r:"32",fill:"#f0f9eb"}),u("path",{d:"M20 32L28 40L44 24",stroke:"#52c41a","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),u("div",Fe,[e[47]||(e[47]=u("h2",null,"处理完成",-1)),u("p",null,"从 "+c(y.value.value.length)+" 项任务中，耗时约 0 秒",1),u("p",null,"成功 "+c($.value.value.filter(l=>l.status==="success").length)+" 项，失败 "+c($.value.value.filter(l=>l.status==="error").length)+" 项",1)])]),u("div",Ie,[a(j,{activeKey:A.value,"onUpdate:activeKey":e[13]||(e[13]=l=>A.value=l),ghost:""},{default:s(()=>[a(E,{key:"1",header:"查看详细日志","show-arrow":!1},{default:s(()=>[u("div",Ne,[(p(!0),m(I,null,P(n.value.value,(l,k)=>(p(),m("div",{key:k,class:"log-item"},c(l),1))),128))])]),_:1})]),_:1},8,["activeKey"])]),a(j,{activeKey:B.value,"onUpdate:activeKey":e[14]||(e[14]=l=>B.value=l),ghost:"",style:{"margin-top":"16px"}},{default:s(()=>[a(E,{key:"result",header:"处理结果",style:{"margin-bottom":"12px"}},{default:s(()=>[u("div",Ee,[u("div",Pe,[e[49]||(e[49]=u("span",{class:"result-label"},"输出目录：",-1)),u("span",Ke,c(t.value.value.outputLocation==="same"?"与源文件相同目录":t.value.value.customOutputDir||"未设置"),1)]),e[50]||(e[50]=u("div",{class:"result-item"},[u("span",{class:"result-label"},"规则名称："),u("span",{class:"result-value"},"替换规则")],-1))])]),_:1}),a(E,{key:"details",header:"处理结果",style:{"margin-bottom":"12px"}},{default:s(()=>[u("div",Ae,[a(de,{columns:H,"data-source":$.value.value,pagination:!1,bordered:"",size:"small",scroll:{x:800}},{bodyCell:s(({column:l,record:k})=>[l.key==="status"?(p(),R(re,{key:0,color:k.status==="success"?"green":"red",style:{margin:"0"}},{default:s(()=>[i(c(k.status==="success"?"处理成功":"处理失败"),1)]),_:2},1032,["color"])):l.key==="action"?(p(),m(I,{key:1},[k.status==="success"&&k.downloadUrl?(p(),R(d,{key:0,type:"link",size:"small",onClick:T=>ne(k),style:{padding:"0",color:"#165dff"}},{default:s(()=>[...e[51]||(e[51]=[i(" 下载 ",-1)])]),_:1},8,["onClick"])):g("",!0)],64)):l.key==="path"?(p(),m("span",Be,c(k.downloadName),1)):g("",!0)]),_:1},8,["data-source"])])]),_:1})]),_:1},8,["activeKey"]),u("div",ze,[a(d,{type:"default",onClick:z},{default:s(()=>[a(ve,{type:"left"}),e[52]||(e[52]=i(" 上一步 ",-1))]),_:1}),a(d,{type:"primary",onClick:oe},{default:s(()=>[...e[53]||(e[53]=[i(" 直接处理 ",-1)])]),_:1})])])):g("",!0),r.value!==5&&n.value.value.length>0?(p(),m("div",je,[e[54]||(e[54]=u("h3",null,"处理日志",-1)),a(F,{bordered:"","data-source":n.value.value,size:"small"},{renderItem:s(({item:l})=>[a(O,null,{default:s(()=>[i(c(l),1)]),_:2},1024)]),_:1},8,["data-source"])])):g("",!0)])}}},Ge=pe(He,[["__scopeId","data-v-f118840c"]]);export{Ge as default};
