import{_ as fe,u as ge,r as _,b as f,c,d as p,e as a,g as n,f as y,h as L,w as s,i,t as m,F as E,j as A,s as ye}from"./index-ArcfRATZ.js";import{P as ke}from"./PluginTemplate-CSzU_o8L.js";import{r as he}from"./py-Dmvp32T8.js";const xe={class:"replace-content"},_e={style:{display:"none"}},be={key:0,class:"step-content"},we={class:"replacement-rules"},Ue={class:"rule-item"},Oe={class:"rule-index"},$e={class:"rule-content"},Ce={key:1,class:"step-content"},Se={key:2,class:"step-content"},Te={key:0,style:{"margin-top":"12px"}},Le={key:0,style:{"margin-left":"12px",color:"#666"}},Re={key:3,class:"step-content"},Me={class:"processing-summary"},De={class:"settings-summary"},Fe={class:"rule-summary"},Ie={key:5,class:"step-content step-result"},Ne={class:"success-banner"},Ee={class:"success-info"},Pe={class:"logs-container"},Ae={class:"logs-content"},Be={class:"processing-results"},Ke={class:"result-item"},je={class:"result-value"},ze={class:"result-table-container"},He={key:2,class:"file-path"},Ve={class:"result-actions"},qe={key:6,style:{margin:"16px 0"}},Je={__name:"index",setup(Ge){ge();const $=_(null),r=_(0),k=_([]),U=_([{findText:"",replaceText:"",matchMode:"normal"}]),D=_(!1),O=_(0),u=_([]),B=_(null),C=_([]),N=_(0),K=_(["1"]),j=_(["result","details"]),Q=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"处理的文件名",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"替换次数",dataIndex:"replacements",key:"replacements",width:120},{title:"处理耗时 (秒)",dataIndex:"time",key:"time",width:120,customRender:()=>"0.09"},{title:"处理后的路径",dataIndex:"downloadName",key:"path",width:200},{title:"操作",dataIndex:"action",key:"action",width:100,fixed:"right"}],t=_({caseSensitive:!1,matchEntireCell:!1,ignoreHiddenCells:!0,sheetOption:"all",selectedSheets:"",rangeOption:"all",customRange:"",enableDetailedLogs:!0,backupOriginal:!1,outputLocation:"same",customOutputDir:"",filenameMode:"append",filenameSuffix:"_处理后"}),W=async()=>(await fetch("/plugins/replace-content/worker.py")).text(),X=()=>{var o;(o=B.value)==null||o.click()},Y=()=>{u.value.push("从文件夹导入功能开发中...")},Z=o=>{switch(o){case"paste":u.value.push("从剪贴板读取功能开发中...");break;case"clear":k.value=[];break}},ee=async()=>{if(r.value===0){if(k.value.length===0){u.value.push("请先添加需要处理的Excel文件");return}r.value=1,u.value.push("进入设置处理规则步骤...")}else if(r.value===1){if(U.value.length===0||U.value.some(o=>!o.findText)){u.value.push("请确保所有替换规则都已填写完整");return}r.value=2,u.value.push("进入设置其他选项步骤...")}else if(r.value===2)r.value=3,u.value.push("进入设置输出目录步骤...");else if(r.value===3){if(t.outputLocation==="custom"&&!t.customOutputDir){u.value.push('请选择输出目录或切换为"与源文件相同目录"');return}r.value=4,u.value.push("进入开始处理步骤...")}else r.value===4&&(await H(),r.value=5,u.value.push("进入处理结果步骤..."))},z=()=>{r.value===1?(r.value=0,u.value.push("返回文件选择步骤...")):r.value===2?(r.value=1,u.value.push("返回设置处理规则步骤...")):r.value===3?(r.value=2,u.value.push("返回设置其他选项步骤...")):r.value===4?(r.value=3,u.value.push("返回设置输出目录步骤...")):r.value===5&&(r.value=4,u.value.push("返回处理步骤..."))},te=o=>{k.value=k.value.filter(e=>e.key!==o)},le=o=>{const e=Array.from(o.target.files);e.length>0&&(e.forEach((d,v)=>{const x={key:`${d.name}-${Date.now()}-${v}`,index:k.value.length+v+1,name:d.name,path:d.name,extension:d.name.split(".").pop(),createTime:new Date(d.lastModified).toLocaleString(),modifyTime:new Date(d.lastModified).toLocaleString(),file:d};k.value.push(x)}),o.target.value="",ye(()=>{$.value&&($.value.files=k.value)}))},ae=()=>{U.value.push({findText:"",replaceText:"",matchMode:"normal"})},se=o=>{U.value.length>1?U.value.splice(o,1):u.value.push("至少需要保留一条替换规则")},ne=()=>{const o=[];return t.caseSensitive&&o.push("区分大小写"),t.matchEntireCell&&o.push("匹配整个单元格"),t.ignoreHiddenCells&&o.push("忽略隐藏单元格"),o.length>0?o.join(", "):"默认"},ue=()=>({all:"处理所有工作表",active:"只处理当前工作表",selected:`指定工作表：${t.selectedSheets}`})[t.sheetOption]||"处理所有工作表",oe=()=>t.rangeOption==="custom"?`自定义范围：${t.customRange}`:{all:"整个工作表",data:"仅数据区域"}[t.rangeOption]||"整个工作表",ie=()=>t.outputLocation==="same"?"与源文件相同目录":t.customOutputDir||"未选择输出目录",re=()=>{const o="C:\\ExcelFiles\\Output";t.customOutputDir=o,u.value.push(`已选择输出目录：${o}`)},H=async()=>{var o;if(k.value.length!==0){D.value=!0,u.value=["开始处理文件..."],O.value=10,C.value=[],N.value=0;try{$.value&&($.value.pyodideLoading=!0);const e=await W();O.value=30,u.value.push(`替换规则数量：${U.value.length}`),U.value.forEach((d,v)=>{u.value.push(`规则 ${v+1}: 查找"${d.findText}" → 替换为"${d.replaceText||"（删除）"}" (${d.matchMode==="regex"?"正则":"普通"})`)}),u.value.push(`高级设置：${JSON.stringify(t)}`);for(let d=0;d<k.value.length;d++){const v=k.value[d];u.value.push(`正在处理文件：${v.name}`);const x=await v.file.arrayBuffer(),S={type:"single",file:new Uint8Array(x),fileName:v.name,settings:{...t,replacementRules:U.value}},g=await he(e,S);O.value=30+Math.round((d+1)/k.value.length*50),u.value.push(`${v.name} 处理完成！`),u.value.push(...g.logs);let R=0;(o=g.details)!=null&&o.statistics&&(R=g.details.statistics.totalReplacements||0,N.value+=R,u.value.push("文件处理统计:"),u.value.push(`  - 工作表数: ${g.details.statistics.totalSheets}`),u.value.push(`  - 处理单元格数: ${g.details.statistics.totalCells}`),u.value.push(`  - 替换次数: ${g.details.statistics.totalReplacements}`),u.value.push(`  - 有效规则数: ${g.details.statistics.validRules}`));let M=null,w=v.name;if(g.success&&g.buffer){const b=new Blob([g.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});if(M=URL.createObjectURL(b),t.filenameMode==="append"){const[F,I]=w.split(".");w=`${F}${t.filenameSuffix}.${I}`}else if(t.filenameMode==="custom"&&t.customFilename){const F=w.split(".").pop();w=`${t.customFilename}.${F}`}}else u.value.push(`警告: 无法处理 ${v.name}，可能处理失败`);C.value.push({key:v.key,index:d+1,name:v.name,originalName:v.name,downloadName:w,downloadUrl:M,status:g.success?"success":"error",replacements:R,error:g.error||null})}u.value.push("所有文件处理完成！"),u.value.push(`总替换次数：${N.value} 次`),O.value=100}catch(e){u.value.push(`错误：${e.message}`),console.error("Processing error:",e)}finally{D.value=!1,$.value&&($.value.pyodideLoading=!1)}}},de=o=>{if(!o.downloadUrl){u.value.push(`无法下载文件 ${o.name}：没有有效的下载链接`);return}const e=document.createElement("a");e.href=o.downloadUrl,e.download=o.downloadName,e.click(),u.value.push(`正在下载文件：${o.downloadName}`)},pe=()=>{C.value.forEach(o=>{o.downloadUrl&&URL.revokeObjectURL(o.downloadUrl)}),r.value=0,D.value=!1,O.value=0,u.value=[],C.value=[],N.value=0,u.value.push("准备重新处理文件...")};return(o,e)=>{var q,J,G;const d=f("a-button"),v=f("a-input"),x=f("a-form-item"),P=f("a-radio-button"),S=f("a-radio-group"),g=f("a-list-item"),R=f("a-list"),M=f("a-form"),w=f("a-checkbox"),b=f("a-radio"),F=f("a-progress"),I=f("a-collapse-panel"),V=f("a-collapse"),ve=f("a-tag"),me=f("a-table"),ce=f("a-icon");return p(),c("div",xe,[a(ke,{"plugin-title":"按规则修改内容","info-message":"用于批量在 Excel 文档中查找并替换/删除指定内容，支持多种匹配规则","current-step":r.value,onAddFile:X,onImportFolder:Y,onMoreAction:Z,onNextStep:ee,onPrevStep:z,onRemoveFile:te,ref_key:"pluginTemplate",ref:$},null,8,["current-step"]),n("div",_e,[n("input",{ref_key:"fileInput",ref:B,type:"file",accept:".xlsx,.xls",multiple:"",onChange:le},null,544)]),r.value===1?(p(),c("div",be,[e[19]||(e[19]=n("h3",null,"替换规则设置",-1)),a(M,{layout:"vertical"},{default:s(()=>[n("div",we,[a(d,{type:"primary",icon:"plus",onClick:ae,style:{"margin-bottom":"16px"}},{default:s(()=>[...e[15]||(e[15]=[i(" 添加替换规则 ",-1)])]),_:1}),a(R,{"data-source":U.value||[],bordered:"",size:"small"},{renderItem:s(({item:l,index:h})=>[a(g,null,{default:s(()=>[n("div",Ue,[n("div",Oe,m(h+1),1),n("div",$e,[a(x,{label:"查找内容",required:""},{default:s(()=>[a(v,{value:l.findText,"onUpdate:value":T=>l.findText=T,placeholder:"请输入要查找的内容",style:{"margin-right":"8px",width:"200px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(x,{label:"替换为",required:""},{default:s(()=>[a(v,{value:l.replaceText,"onUpdate:value":T=>l.replaceText=T,placeholder:"请输入替换后的内容（留空表示删除）",style:{"margin-right":"8px",width:"200px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(x,{label:"匹配模式"},{default:s(()=>[a(S,{value:l.matchMode,"onUpdate:value":T=>l.matchMode=T,"button-style":"solid"},{default:s(()=>[a(P,{value:"normal"},{default:s(()=>[...e[16]||(e[16]=[i("普通",-1)])]),_:1}),a(P,{value:"regex"},{default:s(()=>[...e[17]||(e[17]=[i("正则表达式",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024)]),a(d,{type:"text",danger:"",onClick:T=>se(h)},{default:s(()=>[...e[18]||(e[18]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:1},8,["data-source"])])]),_:1})])):y("",!0),r.value===2?(p(),c("div",Ce,[e[31]||(e[31]=n("h3",null,"高级设置",-1)),a(M,{layout:"vertical"},{default:s(()=>[a(x,{label:"匹配选项"},{default:s(()=>[a(w,{checked:t.value.caseSensitive,"onUpdate:checked":e[0]||(e[0]=l=>t.value.caseSensitive=l)},{default:s(()=>[...e[20]||(e[20]=[i("区分大小写",-1)])]),_:1},8,["checked"]),a(w,{checked:t.value.matchEntireCell,"onUpdate:checked":e[1]||(e[1]=l=>t.value.matchEntireCell=l)},{default:s(()=>[...e[21]||(e[21]=[i("匹配整个单元格",-1)])]),_:1},8,["checked"]),a(w,{checked:t.value.ignoreHiddenCells,"onUpdate:checked":e[2]||(e[2]=l=>t.value.ignoreHiddenCells=l)},{default:s(()=>[...e[22]||(e[22]=[i("忽略隐藏单元格",-1)])]),_:1},8,["checked"])]),_:1}),a(x,{label:"工作表选项"},{default:s(()=>[a(S,{value:t.value.sheetOption,"onUpdate:value":e[3]||(e[3]=l=>t.value.sheetOption=l)},{default:s(()=>[a(b,{value:"all"},{default:s(()=>[...e[23]||(e[23]=[i("处理所有工作表",-1)])]),_:1}),a(b,{value:"active"},{default:s(()=>[...e[24]||(e[24]=[i("只处理当前工作表",-1)])]),_:1}),a(b,{value:"selected"},{default:s(()=>[...e[25]||(e[25]=[i("指定工作表（用逗号分隔）",-1)])]),_:1})]),_:1},8,["value"]),t.value.sheetOption==="selected"?(p(),L(v,{key:0,value:t.value.selectedSheets,"onUpdate:value":e[4]||(e[4]=l=>t.value.selectedSheets=l),placeholder:"请输入工作表名称，用逗号分隔",style:{"margin-top":"12px"}},null,8,["value"])):y("",!0)]),_:1}),a(x,{label:"处理范围"},{default:s(()=>[a(S,{value:t.value.rangeOption,"onUpdate:value":e[5]||(e[5]=l=>t.value.rangeOption=l)},{default:s(()=>[a(b,{value:"all"},{default:s(()=>[...e[26]||(e[26]=[i("整个工作表",-1)])]),_:1}),a(b,{value:"data"},{default:s(()=>[...e[27]||(e[27]=[i("仅数据区域",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[28]||(e[28]=[i("自定义范围",-1)])]),_:1})]),_:1},8,["value"]),t.value.rangeOption==="custom"?(p(),L(v,{key:0,value:t.value.customRange,"onUpdate:value":e[6]||(e[6]=l=>t.value.customRange=l),placeholder:"请输入单元格范围（例如：A1:D100）",style:{"margin-top":"12px"}},null,8,["value"])):y("",!0)]),_:1}),a(x,{label:"其他选项"},{default:s(()=>[a(w,{checked:t.value.enableDetailedLogs,"onUpdate:checked":e[7]||(e[7]=l=>t.value.enableDetailedLogs=l)},{default:s(()=>[...e[29]||(e[29]=[i("启用详细日志",-1)])]),_:1},8,["checked"]),a(w,{checked:t.value.backupOriginal,"onUpdate:checked":e[8]||(e[8]=l=>t.value.backupOriginal=l)},{default:s(()=>[...e[30]||(e[30]=[i("创建源文件备份",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})])):y("",!0),r.value===3?(p(),c("div",Se,[e[37]||(e[37]=n("h3",null,"输出目录设置",-1)),a(M,{layout:"vertical"},{default:s(()=>[a(x,{label:"输出位置"},{default:s(()=>[a(S,{value:t.value.outputLocation,"onUpdate:value":e[9]||(e[9]=l=>t.value.outputLocation=l)},{default:s(()=>[a(b,{value:"same"},{default:s(()=>[...e[32]||(e[32]=[i("与源文件相同目录",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[33]||(e[33]=[i("自定义目录",-1)])]),_:1})]),_:1},8,["value"]),t.value.outputLocation==="custom"?(p(),c("div",Te,[a(d,{type:"default",onClick:re},{default:s(()=>[...e[34]||(e[34]=[i(" 选择输出目录 ",-1)])]),_:1}),t.value.customOutputDir?(p(),c("span",Le,m(t.value.customOutputDir),1)):y("",!0)])):y("",!0)]),_:1}),a(x,{label:"文件名设置"},{default:s(()=>[a(S,{value:t.value.filenameMode,"onUpdate:value":e[10]||(e[10]=l=>t.value.filenameMode=l)},{default:s(()=>[a(b,{value:"append"},{default:s(()=>[...e[35]||(e[35]=[i("在原文件名后添加后缀",-1)])]),_:1}),a(b,{value:"custom"},{default:s(()=>[...e[36]||(e[36]=[i("使用自定义文件名",-1)])]),_:1})]),_:1},8,["value"]),t.value.filenameMode==="append"?(p(),L(v,{key:0,value:t.value.filenameSuffix,"onUpdate:value":e[11]||(e[11]=l=>t.value.filenameSuffix=l),placeholder:"请输入后缀（例如：_处理后）",style:{"margin-top":"12px"}},null,8,["value"])):y("",!0),t.value.filenameMode==="custom"?(p(),L(v,{key:1,value:t.value.customFilename,"onUpdate:value":e[12]||(e[12]=l=>t.value.customFilename=l),placeholder:"请输入自定义文件名（不包含扩展名）",style:{"margin-top":"12px"}},null,8,["value"])):y("",!0)]),_:1})]),_:1})])):y("",!0),r.value===4?(p(),c("div",Re,[e[46]||(e[46]=n("h3",null,"处理确认",-1)),n("div",Me,[n("p",null,[e[38]||(e[38]=i(" 即将处理 ",-1)),n("strong",null,m((k.value||[]).length),1),e[39]||(e[39]=i(" 个文件： ",-1))]),n("ul",null,[(p(!0),c(E,null,A(k.value||[],l=>(p(),c("li",{key:l.key},m(l.name),1))),128))]),n("div",De,[e[44]||(e[44]=n("h4",null,"替换规则：",-1)),n("ul",Fe,[(p(!0),c(E,null,A(U.value||[],(l,h)=>(p(),c("li",{key:h},m(h+1)+'. 查找: "'+m(l.findText)+'" → 替换为: "'+m(l.replaceText||"（删除）")+'" ('+m(l.matchMode==="regex"?"正则":"普通")+") ",1))),128))]),e[45]||(e[45]=n("h4",null,"高级设置：",-1)),n("p",null,[e[40]||(e[40]=n("strong",null,"匹配选项：",-1)),i(m(ne()),1)]),n("p",null,[e[41]||(e[41]=n("strong",null,"工作表选项：",-1)),i(m(ue()),1)]),n("p",null,[e[42]||(e[42]=n("strong",null,"处理范围：",-1)),i(m(oe()),1)]),n("p",null,[e[43]||(e[43]=n("strong",null,"输出位置：",-1)),i(m(ie()),1)])]),a(d,{type:"primary",size:"large",onClick:H,disabled:D.value.value},{default:s(()=>[i(m(D.value.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):y("",!0),O.value>0&&O.value<100?(p(),L(F,{key:4,percent:O.value,style:{margin:"16px 0"}},null,8,["percent"])):y("",!0),r.value===5?(p(),c("div",Ie,[n("div",Ne,[e[48]||(e[48]=n("div",{class:"success-icon"},[n("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none"},[n("circle",{cx:"32",cy:"32",r:"32",fill:"#f0f9eb"}),n("path",{d:"M20 32L28 40L44 24",stroke:"#52c41a","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),n("div",Ee,[e[47]||(e[47]=n("h2",null,"处理完成",-1)),n("p",null,"从 "+m(((q=k.value)==null?void 0:q.length)||0)+" 项任务中，耗时约 0 秒",1),n("p",null," 成功 "+m((((J=C.value)==null?void 0:J.filter(l=>l.status==="success"))||[]).length)+" 项， 失败 "+m((((G=C.value)==null?void 0:G.filter(l=>l.status==="error"))||[]).length)+" 项 ",1)])]),n("div",Pe,[a(V,{activeKey:K.value,"onUpdate:activeKey":e[13]||(e[13]=l=>K.value=l),ghost:""},{default:s(()=>[a(I,{key:"1",header:"查看详细日志","show-arrow":!1},{default:s(()=>[n("div",Ae,[(p(!0),c(E,null,A(u.value,(l,h)=>(p(),c("div",{key:h,class:"log-item"},m(l),1))),128))])]),_:1})]),_:1},8,["activeKey"])]),a(V,{activeKey:j.value,"onUpdate:activeKey":e[14]||(e[14]=l=>j.value=l),ghost:"",style:{"margin-top":"16px"}},{default:s(()=>[a(I,{key:"result",header:"处理结果",style:{"margin-bottom":"12px"}},{default:s(()=>[n("div",Be,[n("div",Ke,[e[49]||(e[49]=n("span",{class:"result-label"},"输出目录：",-1)),n("span",je,m(t.value.outputLocation==="same"?"与源文件相同目录":t.value.customOutputDir||"未设置"),1)]),e[50]||(e[50]=n("div",{class:"result-item"},[n("span",{class:"result-label"},"规则名称："),n("span",{class:"result-value"},"替换规则")],-1))])]),_:1}),a(I,{key:"details",header:"处理结果",style:{"margin-bottom":"12px"}},{default:s(()=>[n("div",ze,[a(me,{columns:Q,"data-source":C.value||[],pagination:!1,bordered:"",size:"small",scroll:{x:800}},{bodyCell:s(({column:l,record:h})=>[l.key==="status"?(p(),L(ve,{key:0,color:h.status==="success"?"green":"red",style:{margin:"0"}},{default:s(()=>[i(m(h.status==="success"?"处理成功":"处理失败"),1)]),_:2},1032,["color"])):l.key==="action"?(p(),c(E,{key:1},[h.status==="success"&&h.downloadUrl?(p(),L(d,{key:0,type:"link",size:"small",onClick:T=>de(h),style:{padding:"0",color:"#165dff"}},{default:s(()=>[...e[51]||(e[51]=[i(" 下载 ",-1)])]),_:1},8,["onClick"])):y("",!0)],64)):l.key==="path"?(p(),c("span",He,m(h.downloadName),1)):y("",!0)]),_:1},8,["data-source"])])]),_:1})]),_:1},8,["activeKey"]),n("div",Ve,[a(d,{type:"default",onClick:z},{default:s(()=>[a(ce,{type:"left"}),e[52]||(e[52]=i(" 上一步 ",-1))]),_:1}),a(d,{type:"primary",onClick:pe},{default:s(()=>[...e[53]||(e[53]=[i(" 直接处理 ",-1)])]),_:1})])])):y("",!0),r.value!==5&&u.value.length>0?(p(),c("div",qe,[e[54]||(e[54]=n("h3",null,"处理日志",-1)),a(R,{bordered:"","data-source":u.value,size:"small"},{renderItem:s(({item:l})=>[a(g,null,{default:s(()=>[i(m(l),1)]),_:2},1024)]),_:1},8,["data-source"])])):y("",!0)])}}},Ye=fe(Je,[["__scopeId","data-v-11cff323"]]);export{Ye as default};
