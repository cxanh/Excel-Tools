import{P as Z,r as ee}from"./py-CjQq9lry.js";import{_ as te,r as _,a as p,c,o as r,b as l,d as o,e as v,f as D,w as a,j as le,g as n,t as y,F as ae,i as ue,n as ne}from"./index-B5FopeIw.js";const oe={class:"replace-picture"},se={style:{display:"none"}},ie={key:0,class:"step-content"},re={class:"image-upload-section"},de={key:0,style:{padding:"24px","text-align":"center"}},pe={key:0,style:{"margin-top":"16px"}},ve={key:1,class:"step-content"},me={key:0,class:"custom-size"},fe={key:2,class:"step-content"},ge={key:0,style:{"margin-top":"12px"}},ce={key:0,style:{"margin-left":"12px",color:"#666"}},ye={key:3,class:"step-content"},xe={class:"processing-summary"},_e={class:"settings-summary"},ke={key:5,style:{margin:"16px 0"}},be={__name:"index",setup(Se){const h=_(null),m=_(0),f=_([]),S=_(null),O=_(""),z=_(!1),w=_(0),i=_([]),I=_(null),t=_({replaceMode:"all",imageSize:"original",customWidth:0,customHeight:0,imagePosition:"original",sheetOption:"all",selectedSheets:"",ignoreHiddenSheets:!0,enableDetailedLogs:!0,outputLocation:"same",customOutputDir:"",filenameMode:"append",filenameSuffix:"_处理后",customFilename:""}),R=()=>({all:"替换所有图片",first:"只替换第一张图片"})[t.value.replaceMode]||"替换所有图片",A=()=>t.value.imageSize==="custom"?`自定义尺寸：${t.value.customWidth}x${t.value.customHeight}`:{original:"保持原图尺寸",fit:"自适应填充"}[t.value.imageSize]||"保持原图尺寸",C=()=>({original:"保持原位置",center:"居中放置"})[t.value.imagePosition]||"保持原位置",N=()=>({all:"处理所有工作表",active:"只处理当前工作表",selected:`指定工作表：${t.value.selectedSheets}`})[t.value.sheetOption]||"处理所有工作表",B=()=>t.value.outputLocation==="same"?"与源文件相同目录":t.value.customOutputDir||"未选择输出目录",H=()=>{i.value.push("选择输出目录功能开发中...")},E=async()=>(await fetch("/plugins/replace-picture/worker.py")).text(),V=()=>{var s;(s=I.value)==null||s.click()},W=()=>{i.value.push("从文件夹导入功能开发中...")},j=s=>{switch(s){case"paste":i.value.push("从剪贴板读取功能开发中...");break;case"clear":f.value=[];break}},J=async()=>{if(m.value===0){if(f.value.length===0){i.value.push("请先添加需要处理的Excel文件");return}m.value=1,i.value.push("进入设置处理规则步骤...")}else if(m.value===1){if(!S.value){i.value.push("请先选择替换图片");return}m.value=2,i.value.push("进入设置其他选项步骤...")}else m.value===2?(m.value=3,i.value.push("进入设置输出目录步骤...")):m.value===3&&(m.value=4,await $())},q=s=>{f.value=f.value.filter(e=>e.key!==s)},G=s=>{const e=Array.from(s.target.files);e.length>0&&(e.forEach((g,U)=>{const x={key:`${g.name}-${Date.now()}-${U}`,index:f.value.length+U+1,name:g.name,path:g.name,extension:g.name.split(".").pop(),createTime:new Date(g.lastModified).toLocaleString(),modifyTime:new Date(g.lastModified).toLocaleString(),file:g};f.value.push(x)}),s.target.value="",ne(()=>{h.value&&(h.value.files=f.value)}))},K=s=>{S.value=s;const e=new FileReader;return e.onload=g=>{O.value=g.target.result},e.readAsDataURL(s),!1},$=async()=>{if(!(f.value.length===0||!S.value)){z.value=!0,i.value=["开始处理文件..."],w.value=10;try{const s=await E();w.value=30;const e=new FileReader,g=await new Promise(x=>{e.onload=F=>x(F.target.result),e.readAsArrayBuffer(S.value)}),U=new Uint8Array(g);for(let x=0;x<f.value.length;x++){const F=f.value[x];i.value.push(`正在处理文件：${F.name}`),i.value.push(`设置参数：${JSON.stringify(t.value)}`),i.value.push(`替换图片：${S.value.name}`);const d={excelFile:F.file,replaceImage:U,imageFileName:S.value.name,settings:t.value},k=await ee(s,d);w.value=30+Math.round((x+1)/f.value.length*50),i.value.push(`${F.name} 处理完成！`),i.value.push(...k.logs);const b=new Blob([k.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),M=URL.createObjectURL(b),L=document.createElement("a");L.href=M,L.download=`${F.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,L.click(),URL.revokeObjectURL(M)}i.value.push("所有文件处理完成！"),w.value=100}catch(s){i.value.push(`错误：${s.message}`),console.error("Processing error:",s)}finally{z.value=!1}}};return(s,e)=>{const g=p("a-icon"),U=p("a-button"),x=p("a-upload"),F=p("a-tag"),d=p("a-radio"),k=p("a-radio-group"),b=p("a-form-item"),M=p("a-input-number"),L=p("a-input"),P=p("a-checkbox"),T=p("a-form"),Q=p("a-progress"),X=p("a-list-item"),Y=p("a-list");return r(),c("div",oe,[l(Z,{"plugin-title":"替换图片","info-message":"批量替换 Excel 文件中的图片，统一文档风格","current-step":m.value,onAddFile:V,onImportFolder:W,onMoreAction:j,onNextStep:J,onRemoveFile:q,ref_key:"pluginTemplate",ref:h},null,8,["current-step"]),o("div",se,[o("input",{ref_key:"fileInput",ref:I,type:"file",accept:".xlsx,.xls",multiple:"",onChange:G},null,544)]),m.value===1?(r(),c("div",ie,[e[15]||(e[15]=o("h3",null,"选择替换图片",-1)),o("div",re,[l(x,{"show-upload-list":!1,"before-upload":K,accept:"image/*"},{default:a(()=>[o("div",{class:"image-upload",style:le({backgroundImage:O.value?`url(${O.value})`:"none"})},[O.value?v("",!0):(r(),c("div",de,[l(g,{type:"picture",style:{"font-size":"48px",color:"#165dff"}}),e[14]||(e[14]=o("p",{style:{margin:"16px 0"}},"点击上传替换图片",-1)),l(U,{type:"primary"},{default:a(()=>[...e[13]||(e[13]=[n("选择图片",-1)])]),_:1})]))],4)]),_:1}),S.value?(r(),c("div",pe,[l(F,{color:"green"},{default:a(()=>[n(y(S.value.name),1)]),_:1})])):v("",!0)])])):v("",!0),m.value===2?(r(),c("div",ve,[e[28]||(e[28]=o("h3",null,"图片替换设置",-1)),l(T,{layout:"vertical"},{default:a(()=>[l(b,{label:"替换方式"},{default:a(()=>[l(k,{value:t.value.replaceMode,"onUpdate:value":e[0]||(e[0]=u=>t.value.replaceMode=u)},{default:a(()=>[l(d,{value:"all"},{default:a(()=>[...e[16]||(e[16]=[n("替换所有图片",-1)])]),_:1}),l(d,{value:"first"},{default:a(()=>[...e[17]||(e[17]=[n("只替换第一张图片",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(b,{label:"图片尺寸"},{default:a(()=>[l(k,{value:t.value.imageSize,"onUpdate:value":e[1]||(e[1]=u=>t.value.imageSize=u)},{default:a(()=>[l(d,{value:"original"},{default:a(()=>[...e[18]||(e[18]=[n("保持原图尺寸",-1)])]),_:1}),l(d,{value:"fit"},{default:a(()=>[...e[19]||(e[19]=[n("自适应填充",-1)])]),_:1}),l(d,{value:"custom"},{default:a(()=>[...e[20]||(e[20]=[n("自定义尺寸",-1)])]),_:1})]),_:1},8,["value"]),t.value.imageSize==="custom"?(r(),c("div",me,[l(M,{value:t.value.customWidth,"onUpdate:value":e[2]||(e[2]=u=>t.value.customWidth=u),placeholder:"宽度（像素）",style:{"margin-right":"12px","margin-top":"12px"}},null,8,["value"]),l(M,{value:t.value.customHeight,"onUpdate:value":e[3]||(e[3]=u=>t.value.customHeight=u),placeholder:"高度（像素）",style:{"margin-top":"12px"}},null,8,["value"])])):v("",!0)]),_:1}),l(b,{label:"图片位置"},{default:a(()=>[l(k,{value:t.value.imagePosition,"onUpdate:value":e[4]||(e[4]=u=>t.value.imagePosition=u)},{default:a(()=>[l(d,{value:"original"},{default:a(()=>[...e[21]||(e[21]=[n("保持原位置",-1)])]),_:1}),l(d,{value:"center"},{default:a(()=>[...e[22]||(e[22]=[n("居中放置",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(b,{label:"工作表选项"},{default:a(()=>[l(k,{value:t.value.sheetOption,"onUpdate:value":e[5]||(e[5]=u=>t.value.sheetOption=u)},{default:a(()=>[l(d,{value:"all"},{default:a(()=>[...e[23]||(e[23]=[n("处理所有工作表",-1)])]),_:1}),l(d,{value:"active"},{default:a(()=>[...e[24]||(e[24]=[n("只处理当前工作表",-1)])]),_:1}),l(d,{value:"selected"},{default:a(()=>[...e[25]||(e[25]=[n("指定工作表（用逗号分隔）",-1)])]),_:1})]),_:1},8,["value"]),t.value.sheetOption==="selected"?(r(),D(L,{key:0,value:t.value.selectedSheets,"onUpdate:value":e[6]||(e[6]=u=>t.value.selectedSheets=u),placeholder:"请输入工作表名称，用逗号分隔",style:{"margin-top":"12px"}},null,8,["value"])):v("",!0)]),_:1}),l(b,{label:"处理选项"},{default:a(()=>[l(P,{checked:t.value.ignoreHiddenSheets,"onUpdate:checked":e[7]||(e[7]=u=>t.value.ignoreHiddenSheets=u)},{default:a(()=>[...e[26]||(e[26]=[n("忽略隐藏工作表",-1)])]),_:1},8,["checked"]),l(P,{checked:t.value.enableDetailedLogs,"onUpdate:checked":e[8]||(e[8]=u=>t.value.enableDetailedLogs=u)},{default:a(()=>[...e[27]||(e[27]=[n("启用详细日志",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})])):v("",!0),m.value===3?(r(),c("div",fe,[e[34]||(e[34]=o("h3",null,"输出目录设置",-1)),l(T,{layout:"vertical"},{default:a(()=>[l(b,{label:"输出位置"},{default:a(()=>[l(k,{value:t.value.outputLocation,"onUpdate:value":e[9]||(e[9]=u=>t.value.outputLocation=u)},{default:a(()=>[l(d,{value:"same"},{default:a(()=>[...e[29]||(e[29]=[n("与源文件相同目录",-1)])]),_:1}),l(d,{value:"custom"},{default:a(()=>[...e[30]||(e[30]=[n("自定义目录",-1)])]),_:1})]),_:1},8,["value"]),t.value.outputLocation==="custom"?(r(),c("div",ge,[l(U,{type:"default",onClick:H},{default:a(()=>[...e[31]||(e[31]=[n(" 选择输出目录 ",-1)])]),_:1}),t.value.customOutputDir?(r(),c("span",ce,y(t.value.customOutputDir),1)):v("",!0)])):v("",!0)]),_:1}),l(b,{label:"文件名设置"},{default:a(()=>[l(k,{value:t.value.filenameMode,"onUpdate:value":e[10]||(e[10]=u=>t.value.filenameMode=u)},{default:a(()=>[l(d,{value:"append"},{default:a(()=>[...e[32]||(e[32]=[n("在原文件名后添加后缀",-1)])]),_:1}),l(d,{value:"custom"},{default:a(()=>[...e[33]||(e[33]=[n("使用自定义文件名",-1)])]),_:1})]),_:1},8,["value"]),t.value.filenameMode==="append"?(r(),D(L,{key:0,value:t.value.filenameSuffix,"onUpdate:value":e[11]||(e[11]=u=>t.value.filenameSuffix=u),placeholder:"请输入后缀（例如：_处理后）",style:{"margin-top":"12px"}},null,8,["value"])):v("",!0),t.value.filenameMode==="custom"?(r(),D(L,{key:1,value:t.value.customFilename,"onUpdate:value":e[12]||(e[12]=u=>t.value.customFilename=u),placeholder:"请输入自定义文件名（不包含扩展名）",style:{"margin-top":"12px"}},null,8,["value"])):v("",!0)]),_:1})]),_:1})])):v("",!0),m.value===4?(r(),c("div",ye,[e[43]||(e[43]=o("h3",null,"处理确认",-1)),o("div",xe,[o("p",null,[e[35]||(e[35]=n(" 即将处理 ",-1)),o("strong",null,y(f.value.value.length),1),e[36]||(e[36]=n(" 个文件： ",-1))]),o("ul",null,[(r(!0),c(ae,null,ue(f.value.value,u=>(r(),c("li",{key:u.key},y(u.name),1))),128))]),o("div",_e,[e[42]||(e[42]=o("h4",null,"处理设置：",-1)),o("p",null,[e[37]||(e[37]=o("strong",null,"替换方式：",-1)),n(y(R()),1)]),o("p",null,[e[38]||(e[38]=o("strong",null,"图片尺寸：",-1)),n(y(A()),1)]),o("p",null,[e[39]||(e[39]=o("strong",null,"图片位置：",-1)),n(y(C()),1)]),o("p",null,[e[40]||(e[40]=o("strong",null,"工作表选项：",-1)),n(y(N()),1)]),o("p",null,[e[41]||(e[41]=o("strong",null,"输出位置：",-1)),n(y(B()),1)])]),l(U,{type:"primary",size:"large",onClick:$,disabled:z.value.value},{default:a(()=>[n(y(z.value.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):v("",!0),w.value>0&&w.value<100?(r(),D(Q,{key:4,percent:w.value,style:{margin:"16px 0"}},null,8,["percent"])):v("",!0),i.value.length>0?(r(),c("div",ke,[e[44]||(e[44]=o("h3",null,"处理日志",-1)),l(Y,{bordered:"","data-source":i.value,size:"small"},{renderItem:a(({item:u})=>[l(X,null,{default:a(()=>[n(y(u),1)]),_:2},1024)]),_:1},8,["data-source"])])):v("",!0)])}}},we=te(be,[["__scopeId","data-v-e70c1762"]]);export{we as default};
