import{P as z}from"./PluginTemplate-Bk8KtKqf.js";import{r as J}from"./py-lgh_vU0b.js";import{_ as q,r as _,b as g,c as k,d as f,e as l,g as a,f as b,h as D,w as u,i as s,t as c,F as G,j as K,s as Q}from"./index-tMO3H4K7.js";const W={class:"merge-excel"},X={style:{display:"none"}},Y={key:0,class:"step-content"},Z={key:1,class:"step-content"},ee={key:0,style:{"margin-top":"12px"}},te={key:0,style:{"margin-left":"12px",color:"#666"}},le={key:2,class:"step-content"},ae={class:"processing-summary"},ue={class:"settings-summary"},se={key:4,style:{margin:"16px 0"}},oe={__name:"index",setup(ne){const O=_(null),m=_(0),p=_([]),h=_(!1),x=_(0),i=_([]),S=_(null),t=_({mergeMode:"append",outputFileName:"合并结果.xlsx",includeHeaders:!0,skipEmptyRows:!0,sheetOption:"all",selectedSheets:"",enableDetailedLogs:!0,outputLocation:"same",customOutputDir:"",filenameMode:"custom"}),E=()=>({append:"追加到同一工作表",separate:"保留原工作表"})[t.value.mergeMode]||"追加到同一工作表",M=()=>({all:"处理所有工作表",active:"只处理当前工作表",selected:`指定工作表：${t.value.selectedSheets}`})[t.value.sheetOption]||"处理所有工作表",N=()=>t.value.outputLocation==="same"?"与源文件相同目录":t.value.customOutputDir||"未选择输出目录",R=()=>{i.value.push("选择输出目录功能开发中...")},T=async()=>(await fetch("/plugins/merge-excel/worker.py")).text(),A=()=>{var r;(r=S.value)==null||r.click()},C=()=>{i.value.push("从文件夹导入功能开发中...")},I=r=>{switch(r){case"paste":i.value.push("从剪贴板读取功能开发中...");break;case"clear":p.value=[];break}},P=async()=>{if(m.value===0){if(p.value.length===0){i.value.push("请先添加需要合并的Excel文件");return}m.value=1,i.value.push("进入设置处理规则步骤...")}else m.value===1?(m.value=2,i.value.push("进入设置其他选项步骤...")):m.value===2?(m.value=3,i.value.push("进入设置输出目录步骤...")):m.value===3&&(m.value=4,await U())},$=r=>{p.value=p.value.filter(e=>e.key!==r)},B=r=>{const e=Array.from(r.target.files);e.length>0&&(e.forEach((o,d)=>{const v={key:`${o.name}-${Date.now()}-${d}`,index:p.value.length+d+1,name:o.name,path:o.name,extension:o.name.split(".").pop(),createTime:new Date(o.lastModified).toLocaleString(),modifyTime:new Date(o.lastModified).toLocaleString(),file:o};p.value.push(v)}),r.target.value="",Q(()=>{O.value&&(O.value.files=p.value)}))},U=async()=>{if(p.value.length!==0){h.value=!0,i.value=["开始处理文件..."],x.value=10;try{const r=await T();x.value=30;const e={};for(let d=0;d<p.value.length;d++){const v=p.value[d],y=new FileReader,w=await new Promise(F=>{y.onload=L=>F(L.target.result),y.readAsArrayBuffer(v.file)});e[v.name]=new Uint8Array(w),x.value=30+Math.round((d+1)/p.value.length*20)}i.value.push("开始合并Excel文件..."),i.value.push(`设置参数：${JSON.stringify(t.value)}`);const o=await J(r,{type:"multiple",files:e,settings:t.value});if(x.value=80,o.success){i.value.push("文件合并完成！"),i.value.push(...o.logs);const d=new Blob([o.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=URL.createObjectURL(d),y=document.createElement("a");y.href=v,y.download=t.outputFileName||"合并结果.xlsx",y.click(),URL.revokeObjectURL(v)}else i.value.push(`合并失败：${o.error}`);x.value=100}catch(r){i.value.push(`错误：${r.message}`),console.error("Processing error:",r)}finally{h.value=!1}}};return(r,e)=>{const o=g("a-radio"),d=g("a-radio-group"),v=g("a-form-item"),y=g("a-input"),w=g("a-checkbox"),F=g("a-form"),L=g("a-button"),H=g("a-progress"),V=g("a-list-item"),j=g("a-list");return f(),k("div",W,[l(z,{"plugin-title":"合并Excel文件","info-message":"批量合并多个Excel文件的内容到一个文件中，支持相同格式的Excel文件合并","current-step":m.value,onAddFile:A,onImportFolder:C,onMoreAction:I,onNextStep:P,onRemoveFile:$,ref_key:"pluginTemplate",ref:O},null,8,["current-step"]),a("div",X,[a("input",{ref_key:"fileInput",ref:S,type:"file",accept:".xlsx,.xls",multiple:"",onChange:B},null,544)]),m.value===1?(f(),k("div",Y,[e[16]||(e[16]=a("h3",null,"合并设置",-1)),l(F,{layout:"vertical"},{default:u(()=>[l(v,{label:"合并方式"},{default:u(()=>[l(d,{value:t.value.mergeMode,"onUpdate:value":e[0]||(e[0]=n=>t.value.mergeMode=n)},{default:u(()=>[l(o,{value:"append"},{default:u(()=>[...e[8]||(e[8]=[s("追加到同一工作表",-1)])]),_:1}),l(o,{value:"separate"},{default:u(()=>[...e[9]||(e[9]=[s("保留原工作表",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{label:"输出文件名称"},{default:u(()=>[l(y,{value:t.value.outputFileName,"onUpdate:value":e[1]||(e[1]=n=>t.value.outputFileName=n),placeholder:"请输入合并后的文件名"},null,8,["value"])]),_:1}),l(v,{label:"工作表选项"},{default:u(()=>[l(d,{value:t.value.sheetOption,"onUpdate:value":e[2]||(e[2]=n=>t.value.sheetOption=n)},{default:u(()=>[l(o,{value:"all"},{default:u(()=>[...e[10]||(e[10]=[s("处理所有工作表",-1)])]),_:1}),l(o,{value:"active"},{default:u(()=>[...e[11]||(e[11]=[s("只处理当前工作表",-1)])]),_:1}),l(o,{value:"selected"},{default:u(()=>[...e[12]||(e[12]=[s("指定工作表（用逗号分隔）",-1)])]),_:1})]),_:1},8,["value"]),t.value.sheetOption==="selected"?(f(),D(y,{key:0,value:t.value.selectedSheets,"onUpdate:value":e[3]||(e[3]=n=>t.value.selectedSheets=n),placeholder:"请输入工作表名称，用逗号分隔",style:{"margin-top":"12px"}},null,8,["value"])):b("",!0)]),_:1}),l(v,{label:"合并选项"},{default:u(()=>[l(w,{checked:t.value.includeHeaders,"onUpdate:checked":e[4]||(e[4]=n=>t.value.includeHeaders=n)},{default:u(()=>[...e[13]||(e[13]=[s("包含表头（仅追加模式有效）",-1)])]),_:1},8,["checked"]),l(w,{checked:t.value.skipEmptyRows,"onUpdate:checked":e[5]||(e[5]=n=>t.value.skipEmptyRows=n)},{default:u(()=>[...e[14]||(e[14]=[s("跳过空行",-1)])]),_:1},8,["checked"]),l(w,{checked:t.value.enableDetailedLogs,"onUpdate:checked":e[6]||(e[6]=n=>t.value.enableDetailedLogs=n)},{default:u(()=>[...e[15]||(e[15]=[s("启用详细日志",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})])):b("",!0),m.value===2?(f(),k("div",Z,[e[20]||(e[20]=a("h3",null,"输出目录设置",-1)),l(F,{layout:"vertical"},{default:u(()=>[l(v,{label:"输出位置"},{default:u(()=>[l(d,{value:t.value.outputLocation,"onUpdate:value":e[7]||(e[7]=n=>t.value.outputLocation=n)},{default:u(()=>[l(o,{value:"same"},{default:u(()=>[...e[17]||(e[17]=[s("与源文件相同目录",-1)])]),_:1}),l(o,{value:"custom"},{default:u(()=>[...e[18]||(e[18]=[s("自定义目录",-1)])]),_:1})]),_:1},8,["value"]),t.value.outputLocation==="custom"?(f(),k("div",ee,[l(L,{type:"default",onClick:R},{default:u(()=>[...e[19]||(e[19]=[s(" 选择输出目录 ",-1)])]),_:1}),t.value.customOutputDir?(f(),k("span",te,c(t.value.customOutputDir),1)):b("",!0)])):b("",!0)]),_:1})]),_:1})])):b("",!0),m.value===3?(f(),k("div",le,[e[30]||(e[30]=a("h3",null,"处理确认",-1)),a("div",ae,[a("p",null,[e[21]||(e[21]=s(" 即将合并 ",-1)),a("strong",null,c(p.value.value.length),1),e[22]||(e[22]=s(" 个文件： ",-1))]),a("ul",null,[(f(!0),k(G,null,K(p.value.value,n=>(f(),k("li",{key:n.key},c(n.name),1))),128))]),a("div",ue,[e[29]||(e[29]=a("h4",null,"处理设置：",-1)),a("p",null,[e[23]||(e[23]=a("strong",null,"合并方式：",-1)),s(c(E()),1)]),a("p",null,[e[24]||(e[24]=a("strong",null,"输出文件名：",-1)),s(c(t.value.outputFileName),1)]),a("p",null,[e[25]||(e[25]=a("strong",null,"工作表选项：",-1)),s(c(M()),1)]),a("p",null,[e[26]||(e[26]=a("strong",null,"包含表头：",-1)),s(c(t.value.includeHeaders?"是":"否"),1)]),a("p",null,[e[27]||(e[27]=a("strong",null,"跳过空行：",-1)),s(c(t.value.skipEmptyRows?"是":"否"),1)]),a("p",null,[e[28]||(e[28]=a("strong",null,"输出位置：",-1)),s(c(N()),1)])]),l(L,{type:"primary",size:"large",onClick:U,disabled:h.value.value},{default:u(()=>[s(c(h.value.value?"处理中...":"开始合并"),1)]),_:1},8,["disabled"])])])):b("",!0),x.value>0&&x.value<100?(f(),D(H,{key:3,percent:x.value,style:{margin:"16px 0"}},null,8,["percent"])):b("",!0),i.value.length>0?(f(),k("div",se,[e[31]||(e[31]=a("h3",null,"处理日志",-1)),l(j,{bordered:"","data-source":i.value,size:"small"},{renderItem:u(({item:n})=>[l(V,null,{default:u(()=>[s(c(n),1)]),_:2},1024)]),_:1},8,["data-source"])])):b("",!0)])}}},de=q(oe,[["__scopeId","data-v-cd9af01c"]]);export{de as default};
