import{P as D}from"./PluginTemplate-Bk8KtKqf.js";import{r as k}from"./py-lgh_vU0b.js";import{g as P}from"./plugin-DiTjGwyF.js";import{_ as L,r as m,m as I,b as i,h as _,d as c,w as o,g as w,e as a,f as T,c as h,i as v,F,j as q,t as z}from"./index-tMO3H4K7.js";const G={class:"plugin-content"},H={class:"settings-section"},J={__name:"index",setup(K){const y=m(1),s=m(null),p=m("by_row"),b=m(""),x=m([]),g=m("by_index"),u=m({rowsPerFile:1e3,columnIndex:1,columnName:""});I(()=>{var l;return(l=s.value)==null?void 0:l.files},async l=>{l&&l.length>0&&await E(l[0])},{deep:!0}),I(p,l=>{l==="by_row"?u.value.rowsPerFile=1e3:l==="by_column"&&(u.value.columnIndex=1,u.value.columnName="",g.value="by_index")});const E=async l=>{try{if(!await P("split-excel"))return;const t=await k(`
import io
import openpyxl

def process(data):
    file_content = data['file']
    wb = openpyxl.load_workbook(io.BytesIO(file_content), read_only=True)
    return {
        'success': True,
        'sheetNames': wb.sheetnames,
        'activeSheet': wb.active.title
    }
    `,{type:"single",file:l.file,fileName:l.name,settings:{}});t.success&&(x.value=t.sheetNames||[],b.value=t.activeSheet||"")}catch(e){console.error("获取工作表名称失败:",e),x.value=[]}},U=async()=>{const l=s.value.files;if(l.length===0)return;const e=await P("split-excel");if(e)for(const r of l)try{const t=await k(e,{type:"single",file:r.file,fileName:r.name,settings:{splitMode:p.value,sheetName:b.value,splitOptions:u.value}});if(t.success)if(t.results&&t.results.length>0)for(const f of t.results)s.value.handleFileProcessed({...r,name:f.file_name,mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{...t,buffer:f.buffer});else s.value.handleFileProcessed(r,t);else s.value.handleFileError(r,t.error||"拆分失败")}catch(t){s.value.handleFileError(r,t.message||"拆分失败")}},A=async()=>{y.value===1&&await U(),y.value++},B=l=>{s.value.addFiles(l)},M=()=>{s.value.importFromFolder()},V=()=>{s.value.showMoreActions()},C=()=>{y.value--},O=l=>{s.value.removeFile(l)};return(l,e)=>{const r=i("a-alert"),t=i("a-select-option"),f=i("a-select"),d=i("a-form-item"),N=i("a-input-number"),S=i("a-radio"),R=i("a-radio-group"),j=i("a-input");return c(),_(D,{"plugin-title":"Excel 拆分成多个文件","info-message":"将一个Excel文件根据指定条件拆分成多个Excel文件","current-step":y.value,onAddFile:B,onImportFolder:M,onMoreAction:V,onNextStep:A,onPrevStep:C,onRemoveFile:O,ref_key:"pluginTemplate",ref:s},{default:o(()=>[w("div",G,[a(r,{message:"拆分说明",description:"支持三种拆分模式：按行数拆分、按列值拆分、按工作表拆分。按工作表拆分将为每个工作表生成一个新文件。",type:"info","show-icon":"",class:"mb-4"}),w("div",H,[e[11]||(e[11]=w("h3",{class:"section-title"},"拆分设置",-1)),a(d,{label:"拆分模式"},{default:o(()=>[a(f,{value:p.value,"onUpdate:value":e[0]||(e[0]=n=>p.value=n),placeholder:"请选择拆分模式"},{default:o(()=>[a(t,{value:"by_row"},{default:o(()=>[...e[6]||(e[6]=[v("按行数拆分",-1)])]),_:1}),a(t,{value:"by_column"},{default:o(()=>[...e[7]||(e[7]=[v("按列值拆分",-1)])]),_:1}),a(t,{value:"by_sheet"},{default:o(()=>[...e[8]||(e[8]=[v("按工作表拆分",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),p.value!=="by_sheet"?(c(),_(d,{key:0,label:"工作表"},{default:o(()=>[a(f,{value:b.value,"onUpdate:value":e[1]||(e[1]=n=>b.value=n),placeholder:"自动选择活动工作表"},{default:o(()=>[(c(!0),h(F,null,q(x.value,n=>(c(),_(t,{key:n,value:n},{default:o(()=>[v(z(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):T("",!0),p.value==="by_row"?(c(),h(F,{key:1},[a(d,{label:"每文件行数"},{default:o(()=>[a(N,{value:u.value.rowsPerFile,"onUpdate:value":e[2]||(e[2]=n=>u.value.rowsPerFile=n),min:1,max:1e5,placeholder:"请输入每文件行数"},null,8,["value"])]),_:1}),a(r,{message:"注意",description:"建议每文件行数不超过10000行，以保证处理速度和稳定性。",type:"warning","show-icon":"",class:"mt-2 mb-2"})],64)):p.value==="by_column"?(c(),h(F,{key:2},[a(d,{label:"拆分列"},{default:o(()=>[a(R,{value:g.value,"onUpdate:value":e[3]||(e[3]=n=>g.value=n),class:"mr-4"},{default:o(()=>[a(S,{value:"by_index"},{default:o(()=>[...e[9]||(e[9]=[v("按列索引",-1)])]),_:1}),a(S,{value:"by_name"},{default:o(()=>[...e[10]||(e[10]=[v("按列名",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),g.value==="by_index"?(c(),_(d,{key:0,label:"列索引"},{default:o(()=>[a(N,{value:u.value.columnIndex,"onUpdate:value":e[4]||(e[4]=n=>u.value.columnIndex=n),min:1,max:1e3,placeholder:"请输入列索引"},null,8,["value"])]),_:1})):(c(),_(d,{key:1,label:"列名"},{default:o(()=>[a(j,{value:u.value.columnName,"onUpdate:value":e[5]||(e[5]=n=>u.value.columnName=n),placeholder:"请输入列名"},null,8,["value"])]),_:1})),a(r,{message:"提示",description:"拆分将基于所选列的唯一值进行，每个唯一值生成一个新文件。",type:"info","show-icon":"",class:"mt-2 mb-2"})],64)):T("",!0)])])]),_:1},8,["current-step"])}}},Z=L(J,[["__scopeId","data-v-3595333a"]]);export{Z as default};
