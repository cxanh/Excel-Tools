import{P as X,r as Y}from"./py-CjQq9lry.js";import{_ as Z,r as x,a as i,c as g,o as f,b as l,d as r,e as c,f as I,w as t,t as _,g as o}from"./index-B5FopeIw.js";const ee={class:"url-to-image"},le={style:{display:"none"}},te={key:0,class:"step-content"},ae={class:"ant-upload-drag-icon"},ne={key:0,style:{"margin-top":"16px"}},oe={key:1,class:"step-content"},se={key:2,class:"step-content"},ue={class:"settings-summary"},ie={key:0},pe={key:1},re={key:2},de={key:3},ve={key:4,style:{margin:"16px 0"}},fe={__name:"index",setup(ce){const E=x(null),m=x(0),s=x([]),A=x(!1),b=x(0),u=x([]),F=x(null),a=x({sheetOption:"all",specificSheets:"",pathOption:"all",specificColumns:"",positionOption:"replace",sizeOption:"fitCell",customSize:{width:300,height:200},advancedOptions:["resizeCell","ignoreInvalid"]}),R=async()=>(await fetch("/plugins/url-to-image/worker.py")).text(),L=()=>{F.value&&F.value.click()},T=()=>{u.value.push("从文件夹导入功能开发中...")},V=d=>{switch(d){case"paste":u.value.push("从剪贴板读取功能开发中...");break;case"clear":s.value=[];break}},M=async()=>{if(m.value===0)m.value=1,u.value.push("进入上传文件步骤...");else if(m.value===1){if(s.length===0){u.value.push("请先上传文件");return}m.value=2,u.value.push("进入设置步骤...")}else m.value===2?(m.value=3,u.value.push("进入预览和确认步骤...")):m.value===3&&await J()},P=d=>{s.value.splice(d,1)},j=d=>{const e=Array.from(d.target.files);e.length>0&&(s.value=[...s.value,...e]),d.target.value=""},D=d=>(s.value.push(d),!1),J=async()=>{if(s.length!==0){A.value=!0,u.value=["开始处理文件..."],b.value=10;try{const d=await R();b.value=30,u.value.push(`处理文件数量: ${s.length} 个`),u.value.push(`设置参数: ${JSON.stringify(a.value)}`);for(let e=0;e<s.length;e++){const k=s.value[e],O=e+1;u.value.push(`开始处理文件 ${O}/${s.length}: ${k.name}`);const S=new FileReader,w=await new Promise(h=>{S.onload=v=>h(v.target.result),S.readAsArrayBuffer(k)});b.value=40+Math.round(e/s.length*40);const z={file:new Uint8Array(w),fileName:k.name,settings:a.value},p=await Y(d,z);if(p.success){if(u.value.push(`文件 ${O}/${s.length} 处理成功`),u.value.push(`转换了 ${p.convertedCount} 个图片路径`),u.value.push(`处理了 ${p.processedCells} 个单元格`),p.buffer){const h=new Blob([p.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=URL.createObjectURL(h),y=document.createElement("a");y.href=v,y.download=`处理后_${k.name}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(v),u.value.push(`文件已下载: 处理后_${k.name}`)}}else u.value.push(`文件 ${O}/${s.length} 处理失败: ${p.error}`)}b.value=100,u.value.push("所有文件处理完成！")}catch(d){u.value.push(`处理错误: ${d.message}`),console.error("Processing error:",d)}finally{A.value=!1}}};return(d,e)=>{const k=i("a-icon"),O=i("a-upload-dragger"),S=i("a-button"),w=i("a-list-item"),z=i("a-list"),p=i("a-radio"),h=i("a-radio-group"),v=i("a-form-item"),y=i("a-input"),N=i("a-input-number"),B=i("a-col"),q=i("a-row"),$=i("a-checkbox"),G=i("a-checkbox-group"),H=i("a-form"),K=i("a-alert"),C=i("a-descriptions-item"),Q=i("a-descriptions"),W=i("a-progress");return f(),g("div",ee,[l(X,{"plugin-title":"Excel中图片地址转为图片","info-message":"将Excel单元格里的本地路径批量还原成嵌入图片","current-step":m.value,onAddFile:L,onImportFolder:T,onMoreAction:V,onNextStep:M,onRemoveFile:P,ref_key:"pluginTemplate",ref:E},null,8,["current-step"]),r("div",le,[r("input",{ref_key:"fileInput",ref:F,type:"file",accept:".xlsx,.xls",multiple:"",onChange:j},null,544)]),m.value===1?(f(),g("div",te,[e[12]||(e[12]=r("h3",null,"上传Excel文件",-1)),l(O,{name:"file",multiple:!0,"show-upload-list":!1,accept:".xlsx,.xls","before-upload":D},{default:t(()=>[r("p",ae,[l(k,{type:"file-excel",style:{"font-size":"48px",color:"#52c41a"}})]),e[9]||(e[9]=r("p",{class:"ant-upload-text"},"点击或拖拽Excel文件到此处上传",-1)),e[10]||(e[10]=r("p",{class:"ant-upload-hint"},"支持 .xlsx, .xls 格式文件",-1))]),_:1}),s.value.length>0?(f(),g("div",ne,[r("h4",null,"已上传文件 ("+_(s.value.length)+")",1),l(z,{bordered:"","data-source":s.value,pagination:{pageSize:5},size:"small"},{renderItem:t(({item:n,index:U})=>[l(w,null,{default:t(()=>[r("span",null,_(U+1)+". "+_(n.name),1),l(S,{type:"link",danger:"",size:"small",onClick:me=>P(U)},{default:t(()=>[...e[11]||(e[11]=[o(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data-source"])])):c("",!0)])):c("",!0),m.value===2?(f(),g("div",oe,[e[29]||(e[29]=r("h3",null,"图片嵌入设置",-1)),l(H,{layout:"vertical"},{default:t(()=>[l(v,{label:"工作表选择"},{default:t(()=>[l(h,{value:a.value.sheetOption,"onUpdate:value":e[0]||(e[0]=n=>a.value.sheetOption=n)},{default:t(()=>[l(p,{value:"all"},{default:t(()=>[...e[13]||(e[13]=[o("处理所有工作表",-1)])]),_:1}),l(p,{value:"specific"},{default:t(()=>[...e[14]||(e[14]=[o("只处理指定工作表",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.sheetOption==="specific"?(f(),I(v,{key:0,label:"指定工作表名称（多个用逗号分隔）"},{default:t(()=>[l(y,{value:a.value.specificSheets,"onUpdate:value":e[1]||(e[1]=n=>a.value.specificSheets=n),placeholder:"例如：Sheet1,Sheet2",style:{"max-width":"400px"}},null,8,["value"]),e[15]||(e[15]=r("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 不区分大小写，支持部分匹配（例如：Sheet* 匹配所有以 Sheet 开头的工作表） ",-1))]),_:1})):c("",!0),l(v,{label:"图片路径识别"},{default:t(()=>[l(h,{value:a.value.pathOption,"onUpdate:value":e[2]||(e[2]=n=>a.value.pathOption=n)},{default:t(()=>[l(p,{value:"all"},{default:t(()=>[...e[16]||(e[16]=[o("检查所有单元格",-1)])]),_:1}),l(p,{value:"specific"},{default:t(()=>[...e[17]||(e[17]=[o("只检查指定列",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.pathOption==="specific"?(f(),I(v,{key:1,label:"指定列（多个用逗号分隔）"},{default:t(()=>[l(y,{value:a.value.specificColumns,"onUpdate:value":e[3]||(e[3]=n=>a.value.specificColumns=n),placeholder:"例如：A,C,E 或 图片路径列",style:{"max-width":"400px"}},null,8,["value"]),e[18]||(e[18]=r("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 支持列字母(A,B,C)或列名称(图片路径,图片地址等) ",-1))]),_:1})):c("",!0),l(v,{label:"图片位置"},{default:t(()=>[l(h,{value:a.value.positionOption,"onUpdate:value":e[4]||(e[4]=n=>a.value.positionOption=n)},{default:t(()=>[l(p,{value:"replace"},{default:t(()=>[...e[19]||(e[19]=[o("替换原单元格内容",-1)])]),_:1}),l(p,{value:"insert"},{default:t(()=>[...e[20]||(e[20]=[o("插入到单元格上方",-1)])]),_:1}),l(p,{value:"right"},{default:t(()=>[...e[21]||(e[21]=[o("插入到单元格右侧",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{label:"图片大小"},{default:t(()=>[l(h,{value:a.value.sizeOption,"onUpdate:value":e[5]||(e[5]=n=>a.value.sizeOption=n)},{default:t(()=>[l(p,{value:"original"},{default:t(()=>[...e[22]||(e[22]=[o("保持原始大小",-1)])]),_:1}),l(p,{value:"fitCell"},{default:t(()=>[...e[23]||(e[23]=[o("适应单元格大小",-1)])]),_:1}),l(p,{value:"custom"},{default:t(()=>[...e[24]||(e[24]=[o("自定义大小",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.sizeOption==="custom"?(f(),I(v,{key:2},{default:t(()=>[l(q,{gutter:16},{default:t(()=>[l(B,{span:12},{default:t(()=>[l(v,{label:"宽度 (像素)","no-colon":""},{default:t(()=>[l(N,{value:a.value.customSize.width,"onUpdate:value":e[6]||(e[6]=n=>a.value.customSize.width=n),min:10,max:2e3,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),l(B,{span:12},{default:t(()=>[l(v,{label:"高度 (像素)","no-colon":""},{default:t(()=>[l(N,{value:a.value.customSize.height,"onUpdate:value":e[7]||(e[7]=n=>a.value.customSize.height=n),min:10,max:2e3,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):c("",!0),l(v,{label:"高级选项"},{default:t(()=>[l(G,{value:a.value.advancedOptions,"onUpdate:value":e[8]||(e[8]=n=>a.value.advancedOptions=n)},{default:t(()=>[l($,{value:"keepPath"},{default:t(()=>[...e[25]||(e[25]=[o("保留原路径文本",-1)])]),_:1}),l($,{value:"resizeCell"},{default:t(()=>[...e[26]||(e[26]=[o("自动调整单元格大小",-1)])]),_:1}),l($,{value:"ignoreInvalid"},{default:t(()=>[...e[27]||(e[27]=[o("忽略无效路径",-1)])]),_:1}),l($,{value:"recursive"},{default:t(()=>[...e[28]||(e[28]=[o("递归检查子目录",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])):c("",!0),m.value===3?(f(),g("div",se,[e[31]||(e[31]=r("h3",null,"预览和确认",-1)),l(K,{message:"处理前预览",description:"以下是您选择的文件和设置，点击开始处理后将执行图片地址转换操作",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),r("div",ue,[r("h4",null,"文件列表 ("+_(s.value.length)+")",1),l(z,{bordered:"","data-source":s.value,pagination:{pageSize:5},size:"small",style:{"margin-bottom":"20px"}},{renderItem:t(({item:n,index:U})=>[l(w,null,{default:t(()=>[r("span",null,_(U+1)+". "+_(n.name),1)]),_:2},1024)]),_:1},8,["data-source"]),e[30]||(e[30]=r("h4",null,"处理设置",-1)),l(Q,{bordered:"",column:"{1}",size:"small"},{default:t(()=>[l(C,{label:"工作表选择"},{default:t(()=>[o(_(a.value.sheetOption==="all"?"所有工作表":`指定工作表: ${a.value.specificSheets}`),1)]),_:1}),l(C,{label:"图片路径识别"},{default:t(()=>[o(_(a.value.pathOption==="all"?"检查所有单元格":`检查指定列: ${a.value.specificColumns}`),1)]),_:1}),l(C,{label:"图片位置"},{default:t(()=>[o(_(a.value.positionOption==="replace"?"替换原单元格":a.value.positionOption==="insert"?"插入到单元格上方":"插入到单元格右侧"),1)]),_:1}),l(C,{label:"图片大小"},{default:t(()=>[o(_(a.value.sizeOption==="original"?"保持原始大小":a.value.sizeOption==="fitCell"?"适应单元格大小":`自定义大小: ${a.value.customSize.width}x${a.value.customSize.height} 像素`),1)]),_:1}),l(C,{label:"高级选项"},{default:t(()=>[a.value.advancedOptions.includes("keepPath")?(f(),g("span",ie,"保留原路径")):c("",!0),a.value.advancedOptions.includes("resizeCell")?(f(),g("span",pe,"，自动调整单元格")):c("",!0),a.value.advancedOptions.includes("ignoreInvalid")?(f(),g("span",re,"，忽略无效路径")):c("",!0),a.value.advancedOptions.includes("recursive")?(f(),g("span",de,"，递归检查目录")):c("",!0)]),_:1})]),_:1})])])):c("",!0),b.value>0&&b.value<100?(f(),I(W,{key:3,percent:b.value,style:{margin:"16px 0"}},null,8,["percent"])):c("",!0),u.value.length>0?(f(),g("div",ve,[e[32]||(e[32]=r("h3",null,"处理日志",-1)),l(z,{bordered:"","data-source":u.value,size:"small"},{renderItem:t(({item:n})=>[l(w,null,{default:t(()=>[o(_(n),1)]),_:2},1024)]),_:1},8,["data-source"])])):c("",!0)])}}},he=Z(fe,[["__scopeId","data-v-fbe7cad1"]]);export{he as default};
