import{r as M}from"./py-Dmvp32T8.js";import{e as t,I as pe,_ as ve,r as i,n as fe,b as u,c as h,d as p,g as v,h as C,f as j,w as l,i as r,k as A,F as I,j as P,t as U,D as me,p as _e,q as O}from"./index-ArcfRATZ.js";import{P as ye}from"./PlayCircleOutlined-69VyeNye.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function W(y){for(var m=1;m<arguments.length;m++){var d=arguments[m]!=null?Object(arguments[m]):{},b=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(d).filter(function(x){return Object.getOwnPropertyDescriptor(d,x).enumerable}))),b.forEach(function(x){ge(y,x,d[x])})}return y}function ge(y,m,d){return m in y?Object.defineProperty(y,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):y[m]=d,y}var J=function(m,d){var b=W({},m,d.attrs);return t(pe,W({},b,{icon:be}),null)};J.displayName="UploadOutlined";J.inheritAttrs=!1;const we={class:"extract-content-plugin"},xe={class:"upload-area"},ke={class:"config-section"},he={class:"config-section"},Oe={key:0,class:"config-section"},Ce={key:1,class:"config-section"},je={key:2,class:"config-section"},Ue={class:"action-section"},Se={class:"result-header"},Be={class:"result-content"},Ee={__name:"index",setup(y){const m=i([]),d=i(null),b=i(!1),x=i([]),T=i([]),D=i([]),g=i("columns"),E=i([]),V=i(0),$=i(-1),q=i(0),z=i("eq"),R=i(""),F=i(!1),w=i(null),X=n=>{const e=n.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||n.type==="application/vnd.ms-excel",o=n.size/1024/1024<10;return e?(o||O.error("文件大小不能超过 10MB！"),!1):(O.error("请上传 Excel 文件！"),!1)},Y=async n=>{const e=n.file;b.value=!0;try{const o=await e.arrayBuffer(),c=new Uint8Array(o);d.value={name:e.name,data:c},await Z(c),O.success("文件上传成功！")}catch(o){O.error("文件上传失败："+o.message)}finally{b.value=!1}},Z=async n=>{try{const e=await fetch("/@plugins/extract-content/worker.py").then(s=>s.text()),o=`
import sys
import os
from openpyxl import load_workbook
from io import BytesIO

file_data = bytes.fromhex('${Array.from(n).map(s=>s.toString(16).padStart(2,"0")).join("")}')
workbook = load_workbook(filename=BytesIO(file_data))
print(','.join(workbook.sheetnames))
    `,c=await M(o,{type:"other",data:{}});if(x.value=c.logs[c.logs.length-2].split(","),x.value.length>0){const s=`
import sys
import os
from openpyxl import load_workbook
from io import BytesIO

file_data = bytes.fromhex('${Array.from(n).map(f=>f.toString(16).padStart(2,"0")).join("")}')
workbook = load_workbook(filename=BytesIO(file_data))
sheet = workbook[workbook.sheetnames[0]]
header = []
for col in range(1, sheet.max_column + 1):
    cell_value = sheet.cell(row=1, column=col).value
    header.append(cell_value or f'列{col}')
print(','.join(header))
      `,k=await M(s,{type:"other",data:{}}),S=k.logs[k.logs.length-2].split(",");D.value=S.map((f,_)=>({index:_,name:f}))}}catch(e){throw console.error("解析文件失败：",e),e}},H=fe(()=>d.value?g.value==="columns"?E.value.length>0:g.value==="rows"?V.value>=0:g.value==="condition"?R.value!=="":!1:!1),ee=async()=>{if(!H.value){O.warning("请完成提取配置！");return}F.value=!0;try{const n={extractType:g.value,sheetNames:T.value,columns:E.value,startRow:V.value,endRow:$.value,conditionColumn:q.value,conditionType:z.value,conditionValue:R.value},e=await fetch("/@plugins/extract-content/worker.py").then(c=>c.text()),o=await M(e,{type:"single",file:d.value.data,fileName:d.value.name,settings:n});o.success?(w.value=o.data.data,L.value=Object.keys(o.data.data)[0]||"",O.success("提取完成！")):O.error("提取失败："+o.error)}catch(n){console.error("提取失败：",n),O.error("提取失败："+n.message)}finally{F.value=!1}},te=n=>{const e=w.value[n];return!e||e.length===0?[]:e[0].map((c,s)=>({title:c,dataIndex:s.toString(),key:s.toString()}))},le=({key:n})=>{w.value&&(n==="csv"?ae():n==="json"&&oe())},ae=()=>{const n=L.value,e=w.value[n];if(!e||e.length===0)return;const o=e.map(S=>S.map(f=>`"${f||""}"`).join(",")).join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),k=URL.createObjectURL(c);s.setAttribute("href",k),s.setAttribute("download",`${n}_extract_result.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},oe=()=>{const n=JSON.stringify(w.value,null,2),e=new Blob([n],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),c=URL.createObjectURL(e);o.setAttribute("href",c),o.setAttribute("download","extract_result.json"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},L=i("");return(n,e)=>{const o=u("a-button"),c=u("a-upload"),s=u("a-card"),k=u("a-radio-button"),S=u("a-radio-group"),f=u("a-form-item"),_=u("a-select-option"),N=u("a-select"),K=u("a-input-number"),B=u("a-col"),G=u("a-row"),ne=u("a-input"),Q=u("a-menu-item"),se=u("a-menu"),ue=u("a-dropdown"),re=u("a-table"),ie=u("a-tab-pane"),de=u("a-tabs"),ce=u("a-spin");return p(),h("div",we,[e[30]||(e[30]=v("div",{class:"plugin-header"},[v("h2",null,"提取 Excel 中的指定内容"),v("p",null,"从Excel文档中提取指定内容，支持按列、按行或按条件提取")],-1)),t(s,{title:"上传文件",class:"upload-card"},{default:l(()=>[v("div",xe,[t(c,{"file-list":m.value,"onUpdate:fileList":e[0]||(e[0]=a=>m.value=a),"before-upload":X,"custom-request":Y,"show-upload-list":!0,accept:".xlsx,.xls"},{default:l(()=>[t(o,{type:"primary"},{default:l(()=>[t(A(J)),e[10]||(e[10]=r(" 选择 Excel 文件 ",-1))]),_:1}),e[11]||(e[11]=v("div",{class:"upload-hint"},"支持 .xlsx, .xls 格式文件",-1))]),_:1},8,["file-list"])])]),_:1}),d.value?(p(),C(s,{key:0,title:"提取配置",class:"config-card"},{default:l(()=>[v("div",ke,[t(f,{label:"提取类型"},{default:l(()=>[t(S,{value:g.value,"onUpdate:value":e[1]||(e[1]=a=>g.value=a),"button-style":"solid"},{default:l(()=>[t(k,{value:"columns"},{default:l(()=>[...e[12]||(e[12]=[r("按列提取",-1)])]),_:1}),t(k,{value:"rows"},{default:l(()=>[...e[13]||(e[13]=[r("按行提取",-1)])]),_:1}),t(k,{value:"condition"},{default:l(()=>[...e[14]||(e[14]=[r("按条件提取",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),v("div",he,[t(f,{label:"选择工作表"},{default:l(()=>[t(N,{value:T.value,"onUpdate:value":e[2]||(e[2]=a=>T.value=a),mode:"multiple",placeholder:"选择要处理的工作表",style:{width:"100%"}},{default:l(()=>[(p(!0),h(I,null,P(x.value,a=>(p(),C(_,{key:a,value:a},{default:l(()=>[r(U(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e[15]||(e[15]=v("div",{class:"hint-text"},"留空则处理所有工作表",-1))]),_:1})]),g.value==="columns"?(p(),h("div",Oe,[t(f,{label:"选择列"},{default:l(()=>[t(N,{value:E.value,"onUpdate:value":e[3]||(e[3]=a=>E.value=a),mode:"multiple",placeholder:"选择要提取的列",style:{width:"100%"}},{default:l(()=>[(p(!0),h(I,null,P(D.value,a=>(p(),C(_,{key:a.index,value:a.index},{default:l(()=>[r(U(a.name)+" ("+U(a.index+1)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e[16]||(e[16]=v("div",{class:"hint-text"},"例如：0 表示第一列，1 表示第二列",-1))]),_:1})])):j("",!0),g.value==="rows"?(p(),h("div",Ce,[t(G,{gutter:16},{default:l(()=>[t(B,{span:12},{default:l(()=>[t(f,{label:"开始行"},{default:l(()=>[t(K,{value:V.value,"onUpdate:value":e[4]||(e[4]=a=>V.value=a),min:0,placeholder:"从第1行开始",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(B,{span:12},{default:l(()=>[t(f,{label:"结束行"},{default:l(()=>[t(K,{value:$.value,"onUpdate:value":e[5]||(e[5]=a=>$.value=a),min:-1,placeholder:"-1 表示到末尾",style:{width:"100%"}},null,8,["value"]),e[17]||(e[17]=v("div",{class:"hint-text"},"输入 -1 表示提取到文件末尾",-1))]),_:1})]),_:1})]),_:1})])):j("",!0),g.value==="condition"?(p(),h("div",je,[t(G,{gutter:16},{default:l(()=>[t(B,{span:8},{default:l(()=>[t(f,{label:"条件列"},{default:l(()=>[t(N,{value:q.value,"onUpdate:value":e[6]||(e[6]=a=>q.value=a),placeholder:"选择条件列",style:{width:"100%"}},{default:l(()=>[(p(!0),h(I,null,P(D.value,a=>(p(),C(_,{key:a.index,value:a.index},{default:l(()=>[r(U(a.name)+" ("+U(a.index+1)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(B,{span:8},{default:l(()=>[t(f,{label:"条件类型"},{default:l(()=>[t(N,{value:z.value,"onUpdate:value":e[7]||(e[7]=a=>z.value=a),placeholder:"选择条件类型",style:{width:"100%"}},{default:l(()=>[t(_,{value:"eq"},{default:l(()=>[...e[18]||(e[18]=[r("等于",-1)])]),_:1}),t(_,{value:"ne"},{default:l(()=>[...e[19]||(e[19]=[r("不等于",-1)])]),_:1}),t(_,{value:"gt"},{default:l(()=>[...e[20]||(e[20]=[r("大于",-1)])]),_:1}),t(_,{value:"lt"},{default:l(()=>[...e[21]||(e[21]=[r("小于",-1)])]),_:1}),t(_,{value:"ge"},{default:l(()=>[...e[22]||(e[22]=[r("大于等于",-1)])]),_:1}),t(_,{value:"le"},{default:l(()=>[...e[23]||(e[23]=[r("小于等于",-1)])]),_:1}),t(_,{value:"contains"},{default:l(()=>[...e[24]||(e[24]=[r("包含",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(B,{span:8},{default:l(()=>[t(f,{label:"条件值"},{default:l(()=>[t(ne,{value:R.value,"onUpdate:value":e[8]||(e[8]=a=>R.value=a),placeholder:"输入条件值",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})])):j("",!0),v("div",Ue,[t(o,{type:"primary",loading:F.value,onClick:ee,disabled:!H.value},{default:l(()=>[t(A(ye)),e[25]||(e[25]=r(" 开始提取 ",-1))]),_:1},8,["loading","disabled"])])]),_:1})):j("",!0),w.value?(p(),C(s,{key:1,title:"提取结果",class:"result-card"},{default:l(()=>[v("div",Se,[v("span",null,"提取完成，共处理 "+U(Object.keys(w.value).length)+" 个工作表",1),t(ue,null,{overlay:l(()=>[t(se,{onClick:le},{default:l(()=>[t(Q,{key:"csv"},{default:l(()=>[...e[27]||(e[27]=[r("导出为 CSV",-1)])]),_:1}),t(Q,{key:"json"},{default:l(()=>[...e[28]||(e[28]=[r("导出为 JSON",-1)])]),_:1})]),_:1})]),default:l(()=>[t(o,{type:"default"},{default:l(()=>[t(A(me)),e[26]||(e[26]=r(" 下载结果 ",-1)),t(A(_e))]),_:1})]),_:1})]),v("div",Be,[t(de,{activeKey:L.value,"onUpdate:activeKey":e[9]||(e[9]=a=>L.value=a),type:"card"},{default:l(()=>[(p(!0),h(I,null,P(Object.keys(w.value),a=>(p(),C(ie,{key:a,tab:a},{default:l(()=>[t(re,{columns:te(a),"data-source":w.value[a].slice(1),pagination:{pageSize:10},bordered:""},null,8,["columns","data-source"])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])])]),_:1})):j("",!0),b.value?(p(),C(ce,{key:2,tip:"正在处理..."},{default:l(()=>[...e[29]||(e[29]=[v("div",{class:"loading-placeholder"},null,-1)])]),_:1})):j("",!0)])}}},Ne=ve(Ee,[["__scopeId","data-v-033df611"]]);export{Ne as default};
