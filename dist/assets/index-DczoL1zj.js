import{P as K}from"./PluginTemplate-Bk8KtKqf.js";import{r as Q}from"./py-lgh_vU0b.js";import{_ as W,r as h,b as u,c as _,d as p,e as l,g as o,f,h as z,w as t,t as g,i as d}from"./index-tMO3H4K7.js";const X={class:"delete-formula"},Y={style:{display:"none"}},Z={key:0,class:"step-content"},ee={class:"ant-upload-drag-icon"},le={key:0,style:{"margin-top":"16px"}},te={key:1,class:"step-content"},ae={key:2,class:"step-content"},ne={class:"settings-summary"},se={key:0},oe={key:1},ue={key:2},re={key:4,style:{margin:"16px 0"}},ie={__name:"index",setup(pe){const N=h(null),c=h(0),n=h([]),A=h(!1),x=h(0),s=h([]),F=h(null),a=h({sheetOption:"all",specificSheets:"",processOptions:["formula","arrayFormula","blankCells"],rangeOption:"used",specificRange:""}),P=async()=>(await fetch("/plugins/delete-formula/worker.py")).text(),B=()=>{F.value&&F.value.click()},E=()=>{s.value.push("从文件夹导入功能开发中...")},L=r=>{switch(r){case"paste":s.value.push("从剪贴板读取功能开发中...");break;case"clear":n.value=[];break}},T=async()=>{if(c.value===0)c.value=1,s.value.push("进入上传文件步骤...");else if(c.value===1){if(n.length===0){s.value.push("请先上传文件");return}c.value=2,s.value.push("进入设置步骤...")}else c.value===2?(c.value=3,s.value.push("进入预览和确认步骤...")):c.value===3&&await j()},I=r=>{n.value.splice(r,1)},V=r=>{const e=Array.from(r.target.files);e.length>0&&(n.value=[...n.value,...e]),r.target.value=""},M=r=>(n.value.push(r),!1),j=async()=>{if(n.length!==0){A.value=!0,s.value=["开始处理文件..."],x.value=10;try{const r=await P();x.value=30,s.value.push(`处理文件数量: ${n.length} 个`),s.value.push(`设置参数: ${JSON.stringify(a.value)}`);for(let e=0;e<n.length;e++){const b=n.value[e],O=e+1;s.value.push(`开始处理文件 ${O}/${n.length}: ${b.name}`);const S=new FileReader,w=await new Promise(k=>{S.onload=m=>k(m.target.result),S.readAsArrayBuffer(b)});x.value=40+Math.round(e/n.length*40);const $={type:"single",file:new Uint8Array(w),fileName:b.name,settings:a.value},v=await Q(r,$);if(v.success){if(s.value.push(`文件 ${O}/${n.length} 处理成功`),s.value.push(`删除了 ${v.deletedCount} 个公式`),v.buffer){const k=new Blob([v.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=URL.createObjectURL(k),y=document.createElement("a");y.href=m,y.download=`处理后_${b.name}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(m),s.value.push(`文件已下载: 处理后_${b.name}`)}}else s.value.push(`文件 ${O}/${n.length} 处理失败: ${v.error}`)}x.value=100,s.value.push("所有文件处理完成！")}catch(r){s.value.push(`处理错误: ${r.message}`),console.error("Processing error:",r)}finally{A.value=!1}}};return(r,e)=>{const b=u("a-icon"),O=u("a-upload-dragger"),S=u("a-button"),w=u("a-list-item"),$=u("a-list"),v=u("a-radio"),k=u("a-radio-group"),m=u("a-form-item"),y=u("a-input"),R=u("a-checkbox"),D=u("a-checkbox-group"),J=u("a-form"),q=u("a-alert"),U=u("a-descriptions-item"),G=u("a-descriptions"),H=u("a-progress");return p(),_("div",X,[l(K,{"plugin-title":"删除Excel公式","info-message":"删除Excel中的公式，只保留计算后的值","current-step":c.value,onAddFile:B,onImportFolder:E,onMoreAction:L,onNextStep:T,onRemoveFile:I,ref_key:"pluginTemplate",ref:N},null,8,["current-step"]),o("div",Y,[o("input",{ref_key:"fileInput",ref:F,type:"file",accept:".xlsx,.xls",multiple:"",onChange:V},null,544)]),c.value===1?(p(),_("div",Z,[e[8]||(e[8]=o("h3",null,"上传Excel文件",-1)),l(O,{name:"file",multiple:!0,"show-upload-list":!1,accept:".xlsx,.xls","before-upload":M},{default:t(()=>[o("p",ee,[l(b,{type:"file-excel",style:{"font-size":"48px",color:"#52c41a"}})]),e[5]||(e[5]=o("p",{class:"ant-upload-text"},"点击或拖拽Excel文件到此处上传",-1)),e[6]||(e[6]=o("p",{class:"ant-upload-hint"},"支持 .xlsx, .xls 格式文件",-1))]),_:1}),n.value.length>0?(p(),_("div",le,[o("h4",null,"已上传文件 ("+g(n.value.length)+")",1),l($,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small"},{renderItem:t(({item:i,index:C})=>[l(w,null,{default:t(()=>[o("span",null,g(C+1)+". "+g(i.name),1),l(S,{type:"link",danger:"",size:"small",onClick:de=>I(C)},{default:t(()=>[...e[7]||(e[7]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data-source"])])):f("",!0)])):f("",!0),c.value===2?(p(),_("div",te,[e[19]||(e[19]=o("h3",null,"删除公式设置",-1)),l(J,{layout:"vertical"},{default:t(()=>[l(m,{label:"工作表选择"},{default:t(()=>[l(k,{value:a.value.sheetOption,"onUpdate:value":e[0]||(e[0]=i=>a.value.sheetOption=i)},{default:t(()=>[l(v,{value:"all"},{default:t(()=>[...e[9]||(e[9]=[d("处理所有工作表",-1)])]),_:1}),l(v,{value:"specific"},{default:t(()=>[...e[10]||(e[10]=[d("只处理指定工作表",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.sheetOption==="specific"?(p(),z(m,{key:0,label:"指定工作表名称（多个用逗号分隔）"},{default:t(()=>[l(y,{value:a.value.specificSheets,"onUpdate:value":e[1]||(e[1]=i=>a.value.specificSheets=i),placeholder:"例如：Sheet1,Sheet2",style:{"max-width":"400px"}},null,8,["value"]),e[11]||(e[11]=o("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 不区分大小写，支持部分匹配（例如：Sheet* 匹配所有以 Sheet 开头的工作表） ",-1))]),_:1})):f("",!0),l(m,{label:"处理选项"},{default:t(()=>[l(D,{value:a.value.processOptions,"onUpdate:value":e[2]||(e[2]=i=>a.value.processOptions=i)},{default:t(()=>[l(R,{value:"formula"},{default:t(()=>[...e[12]||(e[12]=[d("删除公式（保留计算值）",-1)])]),_:1}),l(R,{value:"arrayFormula"},{default:t(()=>[...e[13]||(e[13]=[d("删除数组公式（保留计算值）",-1)])]),_:1}),l(R,{value:"blankCells"},{default:t(()=>[...e[14]||(e[14]=[d("忽略空白单元格",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(m,{label:"数据区域"},{default:t(()=>[l(k,{value:a.value.rangeOption,"onUpdate:value":e[3]||(e[3]=i=>a.value.rangeOption=i)},{default:t(()=>[l(v,{value:"all"},{default:t(()=>[...e[15]||(e[15]=[d("处理整个工作表",-1)])]),_:1}),l(v,{value:"used"},{default:t(()=>[...e[16]||(e[16]=[d("只处理已使用区域",-1)])]),_:1}),l(v,{value:"specific"},{default:t(()=>[...e[17]||(e[17]=[d("处理指定区域",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.rangeOption==="specific"?(p(),z(m,{key:1,label:"指定区域范围"},{default:t(()=>[l(y,{value:a.value.specificRange,"onUpdate:value":e[4]||(e[4]=i=>a.value.specificRange=i),placeholder:"例如：A1:C10",style:{"max-width":"200px"}},null,8,["value"]),e[18]||(e[18]=o("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 支持单个区域或多个区域用逗号分隔 ",-1))]),_:1})):f("",!0)]),_:1})])):f("",!0),c.value===3?(p(),_("div",ae,[e[21]||(e[21]=o("h3",null,"预览和确认",-1)),l(q,{message:"处理前预览",description:"以下是您选择的文件和设置，点击开始处理后将执行公式删除操作",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),o("div",ne,[o("h4",null,"文件列表 ("+g(n.value.length)+")",1),l($,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small",style:{"margin-bottom":"20px"}},{renderItem:t(({item:i,index:C})=>[l(w,null,{default:t(()=>[o("span",null,g(C+1)+". "+g(i.name),1)]),_:2},1024)]),_:1},8,["data-source"]),e[20]||(e[20]=o("h4",null,"处理设置",-1)),l(G,{bordered:"",column:"{1}",size:"small"},{default:t(()=>[l(U,{label:"工作表选择"},{default:t(()=>[d(g(a.value.sheetOption==="all"?"所有工作表":`指定工作表: ${a.value.specificSheets}`),1)]),_:1}),l(U,{label:"处理选项"},{default:t(()=>[a.value.processOptions.includes("formula")?(p(),_("span",se,"公式")):f("",!0),a.value.processOptions.includes("arrayFormula")?(p(),_("span",oe,"，数组公式")):f("",!0),a.value.processOptions.includes("blankCells")?(p(),_("span",ue,"，忽略空白单元格")):f("",!0)]),_:1}),l(U,{label:"数据区域"},{default:t(()=>[d(g(a.value.rangeOption==="all"?"整个工作表":a.value.rangeOption==="used"?"已使用区域":`指定区域: ${a.value.specificRange}`),1)]),_:1})]),_:1})])])):f("",!0),x.value>0&&x.value<100?(p(),z(H,{key:3,percent:x.value,style:{margin:"16px 0"}},null,8,["percent"])):f("",!0),s.value.length>0?(p(),_("div",re,[e[22]||(e[22]=o("h3",null,"处理日志",-1)),l($,{bordered:"","data-source":s.value,size:"small"},{renderItem:t(({item:i})=>[l(w,null,{default:t(()=>[d(g(i),1)]),_:2},1024)]),_:1},8,["data-source"])])):f("",!0)])}}},me=W(ie,[["__scopeId","data-v-44c74a07"]]);export{me as default};
