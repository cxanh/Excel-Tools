import{P as K}from"./PluginTemplate-Bk8KtKqf.js";import{r as Q}from"./py-lgh_vU0b.js";import{_ as W,r as h,b as i,c as g,d as v,e as t,g as u,f as m,h as A,w as l,t as _,i as p}from"./index-tMO3H4K7.js";const X={class:"delete-duplicate-rows"},Y={style:{display:"none"}},Z={key:0,class:"step-content"},ee={class:"ant-upload-drag-icon"},te={key:0,style:{"margin-top":"16px"}},le={key:1,class:"step-content"},ae={key:2,class:"step-content"},ne={class:"settings-summary"},oe={key:0},se={key:1},ue={key:2},ie={key:4,style:{margin:"16px 0"}},re={__name:"index",setup(pe){const R=h(null),c=h(0),n=h([]),B=h(!1),x=h(0),o=h([]),F=h(null),a=h({sheetOption:"all",specificSheets:"",columnOption:"all",specificColumns:"",keepOption:"first",advancedOptions:["ignoreBlank","ignoreEmptyRows"]}),I=async()=>(await fetch("/plugins/delete-duplicate-rows/worker.py")).text(),N=()=>{F.value&&F.value.click()},P=()=>{o.value.push("从文件夹导入功能开发中...")},L=r=>{switch(r){case"paste":o.value.push("从剪贴板读取功能开发中...");break;case"clear":n.value=[];break}},T=async()=>{if(c.value===0)c.value=1,o.value.push("进入上传文件步骤...");else if(c.value===1){if(n.length===0){o.value.push("请先上传文件");return}c.value=2,o.value.push("进入设置步骤...")}else c.value===2?(c.value=3,o.value.push("进入预览和确认步骤...")):c.value===3&&await j()},E=r=>{n.value.splice(r,1)},V=r=>{const e=Array.from(r.target.files);e.length>0&&(n.value=[...n.value,...e]),r.target.value=""},M=r=>(n.value.push(r),!1),j=async()=>{if(n.length!==0){B.value=!0,o.value=["开始处理文件..."],x.value=10;try{const r=await I();x.value=30,o.value.push(`处理文件数量: ${n.length} 个`),o.value.push(`设置参数: ${JSON.stringify(a.value)}`);for(let e=0;e<n.length;e++){const k=n.value[e],w=e+1;o.value.push(`开始处理文件 ${w}/${n.length}: ${k.name}`);const S=new FileReader,O=await new Promise(b=>{S.onload=f=>b(f.target.result),S.readAsArrayBuffer(k)});x.value=40+Math.round(e/n.length*40);const C={type:"single",file:new Uint8Array(O),fileName:k.name,settings:a.value},d=await Q(r,C);if(d.success){if(o.value.push(`文件 ${w}/${n.length} 处理成功`),o.value.push(`删除了 ${d.deletedCount} 个重复行`),o.value.push(`保留了 ${d.keptCount} 行数据`),d.buffer){const b=new Blob([d.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=URL.createObjectURL(b),y=document.createElement("a");y.href=f,y.download=`处理后_${k.name}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(f),o.value.push(`文件已下载: 处理后_${k.name}`)}}else o.value.push(`文件 ${w}/${n.length} 处理失败: ${d.error}`)}x.value=100,o.value.push("所有文件处理完成！")}catch(r){o.value.push(`处理错误: ${r.message}`),console.error("Processing error:",r)}finally{B.value=!1}}};return(r,e)=>{const k=i("a-icon"),w=i("a-upload-dragger"),S=i("a-button"),O=i("a-list-item"),C=i("a-list"),d=i("a-radio"),b=i("a-radio-group"),f=i("a-form-item"),y=i("a-input"),z=i("a-checkbox"),D=i("a-checkbox-group"),J=i("a-form"),q=i("a-alert"),$=i("a-descriptions-item"),G=i("a-descriptions"),H=i("a-progress");return v(),g("div",X,[t(K,{"plugin-title":"删除Excel重复行","info-message":"删除Excel中的重复行数据","current-step":c.value,onAddFile:N,onImportFolder:P,onMoreAction:L,onNextStep:T,onRemoveFile:E,ref_key:"pluginTemplate",ref:R},null,8,["current-step"]),u("div",Y,[u("input",{ref_key:"fileInput",ref:F,type:"file",accept:".xlsx,.xls",multiple:"",onChange:V},null,544)]),c.value===1?(v(),g("div",Z,[e[9]||(e[9]=u("h3",null,"上传Excel文件",-1)),t(w,{name:"file",multiple:!0,"show-upload-list":!1,accept:".xlsx,.xls","before-upload":M},{default:l(()=>[u("p",ee,[t(k,{type:"file-excel",style:{"font-size":"48px",color:"#52c41a"}})]),e[6]||(e[6]=u("p",{class:"ant-upload-text"},"点击或拖拽Excel文件到此处上传",-1)),e[7]||(e[7]=u("p",{class:"ant-upload-hint"},"支持 .xlsx, .xls 格式文件",-1))]),_:1}),n.value.length>0?(v(),g("div",te,[u("h4",null,"已上传文件 ("+_(n.value.length)+")",1),t(C,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small"},{renderItem:l(({item:s,index:U})=>[t(O,null,{default:l(()=>[u("span",null,_(U+1)+". "+_(s.name),1),t(S,{type:"link",danger:"",size:"small",onClick:de=>E(U)},{default:l(()=>[...e[8]||(e[8]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data-source"])])):m("",!0)])):m("",!0),c.value===2?(v(),g("div",le,[e[21]||(e[21]=u("h3",null,"删除重复行设置",-1)),t(J,{layout:"vertical"},{default:l(()=>[t(f,{label:"工作表选择"},{default:l(()=>[t(b,{value:a.value.sheetOption,"onUpdate:value":e[0]||(e[0]=s=>a.value.sheetOption=s)},{default:l(()=>[t(d,{value:"all"},{default:l(()=>[...e[10]||(e[10]=[p("处理所有工作表",-1)])]),_:1}),t(d,{value:"specific"},{default:l(()=>[...e[11]||(e[11]=[p("只处理指定工作表",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.sheetOption==="specific"?(v(),A(f,{key:0,label:"指定工作表名称（多个用逗号分隔）"},{default:l(()=>[t(y,{value:a.value.specificSheets,"onUpdate:value":e[1]||(e[1]=s=>a.value.specificSheets=s),placeholder:"例如：Sheet1,Sheet2",style:{"max-width":"400px"}},null,8,["value"]),e[12]||(e[12]=u("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 不区分大小写，支持部分匹配（例如：Sheet* 匹配所有以 Sheet 开头的工作表） ",-1))]),_:1})):m("",!0),t(f,{label:"重复行检测条件"},{default:l(()=>[t(b,{value:a.value.columnOption,"onUpdate:value":e[2]||(e[2]=s=>a.value.columnOption=s)},{default:l(()=>[t(d,{value:"all"},{default:l(()=>[...e[13]||(e[13]=[p("基于所有列检测重复",-1)])]),_:1}),t(d,{value:"specific"},{default:l(()=>[...e[14]||(e[14]=[p("基于指定列检测重复",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a.value.columnOption==="specific"?(v(),A(f,{key:1,label:"指定列（多个用逗号分隔）"},{default:l(()=>[t(y,{value:a.value.specificColumns,"onUpdate:value":e[3]||(e[3]=s=>a.value.specificColumns=s),placeholder:"例如：A,C,E 或 列1,列3,列5",style:{"max-width":"400px"}},null,8,["value"]),e[15]||(e[15]=u("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 支持列字母(A,B,C)或列名称(姓名,年龄,性别) ",-1))]),_:1})):m("",!0),t(f,{label:"重复行处理"},{default:l(()=>[t(b,{value:a.value.keepOption,"onUpdate:value":e[4]||(e[4]=s=>a.value.keepOption=s)},{default:l(()=>[t(d,{value:"first"},{default:l(()=>[...e[16]||(e[16]=[p("保留第一个出现的行",-1)])]),_:1}),t(d,{value:"last"},{default:l(()=>[...e[17]||(e[17]=[p("保留最后一个出现的行",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(f,{label:"高级选项"},{default:l(()=>[t(D,{value:a.value.advancedOptions,"onUpdate:value":e[5]||(e[5]=s=>a.value.advancedOptions=s)},{default:l(()=>[t(z,{value:"caseSensitive"},{default:l(()=>[...e[18]||(e[18]=[p("区分大小写",-1)])]),_:1}),t(z,{value:"ignoreBlank"},{default:l(()=>[...e[19]||(e[19]=[p("忽略空白单元格",-1)])]),_:1}),t(z,{value:"ignoreEmptyRows"},{default:l(()=>[...e[20]||(e[20]=[p("忽略完全空白的行",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])):m("",!0),c.value===3?(v(),g("div",ae,[e[23]||(e[23]=u("h3",null,"预览和确认",-1)),t(q,{message:"处理前预览",description:"以下是您选择的文件和设置，点击开始处理后将执行重复行删除操作",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),u("div",ne,[u("h4",null,"文件列表 ("+_(n.value.length)+")",1),t(C,{bordered:"","data-source":n.value,pagination:{pageSize:5},size:"small",style:{"margin-bottom":"20px"}},{renderItem:l(({item:s,index:U})=>[t(O,null,{default:l(()=>[u("span",null,_(U+1)+". "+_(s.name),1)]),_:2},1024)]),_:1},8,["data-source"]),e[22]||(e[22]=u("h4",null,"处理设置",-1)),t(G,{bordered:"",column:"{1}",size:"small"},{default:l(()=>[t($,{label:"工作表选择"},{default:l(()=>[p(_(a.value.sheetOption==="all"?"所有工作表":`指定工作表: ${a.value.specificSheets}`),1)]),_:1}),t($,{label:"重复行检测"},{default:l(()=>[p(_(a.value.columnOption==="all"?"基于所有列":`基于指定列: ${a.value.specificColumns}`),1)]),_:1}),t($,{label:"重复行处理"},{default:l(()=>[p(_(a.value.keepOption==="first"?"保留第一个出现的行":"保留最后一个出现的行"),1)]),_:1}),t($,{label:"高级选项"},{default:l(()=>[a.value.advancedOptions.includes("caseSensitive")?(v(),g("span",oe,"区分大小写")):m("",!0),a.value.advancedOptions.includes("ignoreBlank")?(v(),g("span",se,"，忽略空白单元格")):m("",!0),a.value.advancedOptions.includes("ignoreEmptyRows")?(v(),g("span",ue,"，忽略完全空白的行")):m("",!0)]),_:1})]),_:1})])])):m("",!0),x.value>0&&x.value<100?(v(),A(H,{key:3,percent:x.value,style:{margin:"16px 0"}},null,8,["percent"])):m("",!0),o.value.length>0?(v(),g("div",ie,[e[24]||(e[24]=u("h3",null,"处理日志",-1)),t(C,{bordered:"","data-source":o.value,size:"small"},{renderItem:l(({item:s})=>[t(O,null,{default:l(()=>[p(_(s),1)]),_:2},1024)]),_:1},8,["data-source"])])):m("",!0)])}}},me=W(re,[["__scopeId","data-v-377193bb"]]);export{me as default};
