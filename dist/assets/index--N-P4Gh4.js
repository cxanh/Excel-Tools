import{_ as D,u as q,r as y,a as G,o as H,b as u,c as n,d as o,e as t,f as J,g as f,w as l,i as g,F as U,j as R,h as P,t as B,k as K}from"./index-tMO3H4K7.js";import{P as Q}from"./PluginTemplate-Bk8KtKqf.js";import{r as A}from"./py-lgh_vU0b.js";import{g as W}from"./plugin-DiTjGwyF.js";import{P as X}from"./PlayCircleOutlined-1DyGFteB.js";const Y={class:"plugin-container"},Z={key:0,class:"step-content"},ee={key:1,class:"step-content"},te={key:2,class:"step-content"},se={key:3,class:"step-content"},le={key:4,class:"step-content"},oe={class:"log-container"},ae={class:"start-process-container"},ne={key:0,class:"success-result"},re={key:1,class:"error-result"},ie="删除 Excel 页眉页脚",ue=4,ce={__name:"index",setup(pe){q();const m=y(null),r=y(0),k=y(!1),d=y([]),b=y({success:!1,error:null}),v=y(!1),C=y([]),w=G({sheetNames:["*"]}),$=async()=>{if(!(!m.value||m.value.files.length===0))try{const s=m.value.files[0],e=await s.file.arrayBuffer(),i=new Uint8Array(e),_=await A(`
import io
from openpyxl import load_workbook

def process(input_data):
    file = input_data["file"]
    wb = load_workbook(io.BytesIO(file))
    return {
        'success': True,
        'sheetNames': wb.sheetnames
    }
`,{type:"single",file:i,fileName:s.name,settings:{}});_.success&&_.sheetNames&&(C.value=_.sheetNames)}catch(s){console.error("获取工作表列表失败:",s)}},T=async s=>{console.log("添加文件:",s)},I=()=>{console.log("从文件夹导入")},L=s=>{console.log("更多操作:",s)},O=()=>{r.value<ue&&r.value++},M=()=>{r.value>0&&r.value--},V=s=>{console.log("删除文件:",s)},j=async()=>{if(!(!m.value||m.value.files.length===0)){k.value=!0,d.value=["开始处理文件..."];try{const s=await W("delete-header-footer");if(!s){d.value.push("获取Python脚本失败");return}const e=m.value.files;for(let i=0;i<e.length;i++){const c=e[i];d.value.push(`正在处理文件：${c.name}`);const _=await c.file.arrayBuffer(),N=new Uint8Array(_),p=await A(s,{type:"single",file:N,fileName:c.name,settings:w});if(d.value.push(`${c.name} 处理完成！`),d.value.push(...p.logs),p.success&&p.buffer){const S=new Blob([p.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=URL.createObjectURL(S),x=document.createElement("a");x.href=h,x.download=`${c.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,x.click(),URL.revokeObjectURL(h)}}d.value.push("所有文件处理完成！"),b.value={success:!0,error:null},v.value=!0}catch(s){d.value.push(`处理错误: ${s.message}`),b.value={success:!1,error:s.message},v.value=!0}finally{k.value=!1}}};return H(()=>{console.log("插件初始化")}),(s,e)=>{const i=u("a-divider"),c=u("a-select-option"),_=u("a-select"),N=u("a-form-item"),p=u("a-button"),S=u("a-form"),h=u("a-card"),x=u("a-spin"),F=u("a-result"),E=u("a-modal");return o(),n("div",Y,[t(Q,{ref_key:"pluginTemplate",ref:m,"plugin-title":ie,"current-step":r.value,onAddFile:T,onImportFolder:I,onMoreAction:L,onNextStep:O,onPrevStep:M,onRemoveFile:V},null,8,["current-step"]),r.value===0?(o(),n("div",Z)):r.value===1?(o(),n("div",ee,[e[7]||(e[7]=f("h3",{class:"step-title"},"设置删除选项",-1)),t(i),t(h,{title:"删除设置",class:"setting-card"},{default:l(()=>[t(S,{layout:"vertical"},{default:l(()=>[t(N,{label:"选择工作表"},{default:l(()=>[t(_,{value:w.sheetNames,"onUpdate:value":e[0]||(e[0]=a=>w.sheetNames=a),mode:"multiple",placeholder:"选择要处理的工作表，默认处理所有工作表",style:{width:"100%"}},{default:l(()=>[t(c,{value:"*"},{default:l(()=>[...e[5]||(e[5]=[g("所有工作表",-1)])]),_:1}),(o(!0),n(U,null,R(C.value,a=>(o(),P(c,{key:a,value:a},{default:l(()=>[g(B(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(p,{type:"primary",onClick:$},{default:l(()=>[...e[6]||(e[6]=[g("获取工作表列表",-1)])]),_:1})]),_:1})]),_:1})])):r.value===2?(o(),n("div",te,[e[8]||(e[8]=f("h3",{class:"step-title"},"设置其它选项",-1)),t(i),e[9]||(e[9]=f("p",{class:"placeholder-text"},"此步骤暂无配置项",-1))])):r.value===3?(o(),n("div",se,[e[10]||(e[10]=f("h3",{class:"step-title"},"设置输出目录",-1)),t(i),e[11]||(e[11]=f("p",{class:"placeholder-text"},"处理完成后将自动下载文件",-1))])):r.value===4?(o(),n("div",le,[e[12]||(e[12]=f("h3",{class:"step-title"},"开始处理",-1)),t(i),t(h,{title:"处理日志",class:"log-card"},{default:l(()=>[f("div",oe,[(o(!0),n(U,null,R(d.value,(a,z)=>(o(),n("div",{key:z,class:"log-item"},B(a),1))),128))])]),_:1}),f("div",ae,[t(p,{type:"primary",size:"large",icon:"play-circle",onClick:j,disabled:k.value},{icon:l(()=>[k.value?(o(),P(x,{key:0})):(o(),P(K(X),{key:1}))]),default:l(()=>[g(" "+B(k.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):J("",!0),t(E,{open:v.value,"onUpdate:open":e[3]||(e[3]=a=>v.value=a),title:"处理结果",onOk:e[4]||(e[4]=a=>v.value=!1)},{default:l(()=>[b.value.success?(o(),n("div",ne,[t(F,{status:"success",title:"处理成功","sub-title":"所有文件已成功处理完成"},{extra:l(()=>[t(p,{type:"primary",onClick:e[1]||(e[1]=a=>v.value=!1)},{default:l(()=>[...e[13]||(e[13]=[g(" 确定 ",-1)])]),_:1})]),_:1})])):(o(),n("div",re,[t(F,{status:"error",title:"处理失败","sub-title":b.value.error||"处理过程中发生错误"},{extra:l(()=>[t(p,{type:"primary",onClick:e[2]||(e[2]=a=>v.value=!1)},{default:l(()=>[...e[14]||(e[14]=[g(" 确定 ",-1)])]),_:1})]),_:1},8,["sub-title"])]))]),_:1},8,["open"])])}}},ye=D(ce,[["__scopeId","data-v-d5393ea3"]]);export{ye as default};
