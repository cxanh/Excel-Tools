import{_ as K,u as Q,r as k,a as W,o as X,b as r,c as d,d as n,e as t,f as P,g,w as l,h as U,i as y,F as T,j as $,t as B,k as Y}from"./index-ArcfRATZ.js";import{P as Z}from"./PluginTemplate-CSzU_o8L.js";import{r as I}from"./py-Dmvp32T8.js";import{g as ee}from"./plugin-DiTjGwyF.js";import{P as te}from"./PlayCircleOutlined-69VyeNye.js";const le={class:"plugin-container"},ae={key:0,class:"step-content"},se={key:1,class:"step-content"},oe={key:2,class:"step-content"},ne={key:3,class:"step-content"},re={key:4,class:"step-content"},ue={class:"log-container"},ie={class:"start-process-container"},de={key:0,class:"success-result"},pe={key:1,class:"error-result"},ce="添加/修改 Excel 页眉页脚",fe=4,ve={__name:"index",setup(me){Q();const h=k(null),p=k(0),w=k(!1),m=k([]),N=k({success:!1,error:null}),b=k(!1),F=k([]),s=W({header:{enabled:!0,left:"",center:"",right:""},footer:{enabled:!0,left:"",center:"",right:""},sheetNames:["*"]}),L=async()=>{if(!(!h.value||h.value.files.length===0))try{const o=h.value.files[0],e=await o.file.arrayBuffer(),c=new Uint8Array(e),u=await I(`
import io
from openpyxl import load_workbook

def process(input_data):
    file = input_data["file"]
    wb = load_workbook(io.BytesIO(file))
    return {
        'success': True,
        'sheetNames': wb.sheetnames
    }
`,{type:"single",file:c,fileName:o.name,settings:{}});u.success&&u.sheetNames&&(F.value=u.sheetNames)}catch(o){console.error("获取工作表列表失败:",o)}},O=async o=>{console.log("添加文件:",o)},M=()=>{console.log("从文件夹导入")},V=o=>{console.log("更多操作:",o)},j=()=>{p.value<fe&&p.value++},E=()=>{p.value>0&&p.value--},z=o=>{console.log("删除文件:",o)},D=async()=>{if(!(!h.value||h.value.files.length===0)){w.value=!0,m.value=["开始处理文件..."];try{const o=await ee("add-header-footer");if(!o){m.value.push("获取Python脚本失败");return}const e=h.value.files;for(let c=0;c<e.length;c++){const f=e[c];m.value.push(`正在处理文件：${f.name}`);const u=await f.file.arrayBuffer(),v=new Uint8Array(u),i=await I(o,{type:"single",file:v,fileName:f.name,settings:s});if(m.value.push(`${f.name} 处理完成！`),m.value.push(...i.logs),i.success&&i.buffer){const S=new Blob([i.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=URL.createObjectURL(S),_=document.createElement("a");_.href=x,_.download=`${f.name.replace(".xlsx","").replace(".xls","")}_处理后.xlsx`,_.click(),URL.revokeObjectURL(x)}}m.value.push("所有文件处理完成！"),N.value={success:!0,error:null},b.value=!0}catch(o){m.value.push(`处理错误: ${o.message}`),N.value={success:!1,error:o.message},b.value=!0}finally{w.value=!1}}};return X(()=>{console.log("插件初始化")}),(o,e)=>{const c=r("a-divider"),f=r("a-checkbox"),u=r("a-input"),v=r("a-form-item"),i=r("a-col"),S=r("a-row"),x=r("a-form"),_=r("a-card"),R=r("a-select-option"),q=r("a-select"),C=r("a-button"),G=r("a-spin"),A=r("a-result"),H=r("a-modal");return n(),d("div",le,[t(Z,{ref_key:"pluginTemplate",ref:h,"plugin-title":ce,"current-step":p.value,onAddFile:O,onImportFolder:M,onMoreAction:V,onNextStep:j,onPrevStep:E,onRemoveFile:z},null,8,["current-step"]),p.value===0?(n(),d("div",ae)):p.value===1?(n(),d("div",se,[e[17]||(e[17]=g("h3",{class:"step-title"},"设置页眉页脚",-1)),t(c),t(_,{title:"页眉设置",class:"setting-card"},{default:l(()=>[t(f,{checked:s.header.enabled,"onUpdate:checked":e[0]||(e[0]=a=>s.header.enabled=a)},{default:l(()=>[...e[13]||(e[13]=[y("启用页眉",-1)])]),_:1},8,["checked"]),s.header.enabled?(n(),U(x,{key:0,layout:"vertical"},{default:l(()=>[t(S,{gutter:[16,16]},{default:l(()=>[t(i,{span:8},{default:l(()=>[t(v,{label:"左页眉"},{default:l(()=>[t(u,{value:s.header.left,"onUpdate:value":e[1]||(e[1]=a=>s.header.left=a),placeholder:"左页眉内容"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:8},{default:l(()=>[t(v,{label:"中页眉"},{default:l(()=>[t(u,{value:s.header.center,"onUpdate:value":e[2]||(e[2]=a=>s.header.center=a),placeholder:"中页眉内容"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:8},{default:l(()=>[t(v,{label:"右页眉"},{default:l(()=>[t(u,{value:s.header.right,"onUpdate:value":e[3]||(e[3]=a=>s.header.right=a),placeholder:"右页眉内容"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1}),t(_,{title:"页脚设置",class:"setting-card",style:{marginTop:"20px"}},{default:l(()=>[t(f,{checked:s.footer.enabled,"onUpdate:checked":e[4]||(e[4]=a=>s.footer.enabled=a)},{default:l(()=>[...e[14]||(e[14]=[y("启用页脚",-1)])]),_:1},8,["checked"]),s.footer.enabled?(n(),U(x,{key:0,layout:"vertical"},{default:l(()=>[t(S,{gutter:[16,16]},{default:l(()=>[t(i,{span:8},{default:l(()=>[t(v,{label:"左页脚"},{default:l(()=>[t(u,{value:s.footer.left,"onUpdate:value":e[5]||(e[5]=a=>s.footer.left=a),placeholder:"左页脚内容"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:8},{default:l(()=>[t(v,{label:"中页脚"},{default:l(()=>[t(u,{value:s.footer.center,"onUpdate:value":e[6]||(e[6]=a=>s.footer.center=a),placeholder:"中页脚内容"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:8},{default:l(()=>[t(v,{label:"右页脚"},{default:l(()=>[t(u,{value:s.footer.right,"onUpdate:value":e[7]||(e[7]=a=>s.footer.right=a),placeholder:"右页脚内容"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1}),t(_,{title:"工作表选择",class:"setting-card",style:{marginTop:"20px"}},{default:l(()=>[t(x,{layout:"vertical"},{default:l(()=>[t(v,{label:"选择工作表"},{default:l(()=>[t(q,{value:s.sheetNames,"onUpdate:value":e[8]||(e[8]=a=>s.sheetNames=a),mode:"multiple",placeholder:"选择要处理的工作表，默认处理所有工作表",style:{width:"100%"},onChange:o.handleSheetSelect},{default:l(()=>[t(R,{value:"*"},{default:l(()=>[...e[15]||(e[15]=[y("所有工作表",-1)])]),_:1}),(n(!0),d(T,null,$(F.value,a=>(n(),U(R,{key:a,value:a},{default:l(()=>[y(B(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1}),t(C,{type:"primary",onClick:L},{default:l(()=>[...e[16]||(e[16]=[y("获取工作表列表",-1)])]),_:1})]),_:1})]),_:1})])):p.value===2?(n(),d("div",oe,[e[18]||(e[18]=g("h3",{class:"step-title"},"设置其它选项",-1)),t(c),e[19]||(e[19]=g("p",{class:"placeholder-text"},"此步骤暂无配置项",-1))])):p.value===3?(n(),d("div",ne,[e[20]||(e[20]=g("h3",{class:"step-title"},"设置输出目录",-1)),t(c),e[21]||(e[21]=g("p",{class:"placeholder-text"},"处理完成后将自动下载文件",-1))])):p.value===4?(n(),d("div",re,[e[22]||(e[22]=g("h3",{class:"step-title"},"开始处理",-1)),t(c),t(_,{title:"处理日志",class:"log-card"},{default:l(()=>[g("div",ue,[(n(!0),d(T,null,$(m.value,(a,J)=>(n(),d("div",{key:J,class:"log-item"},B(a),1))),128))])]),_:1}),g("div",ie,[t(C,{type:"primary",size:"large",icon:"play-circle",onClick:D,disabled:w.value},{icon:l(()=>[w.value?(n(),U(G,{key:0})):(n(),U(Y(te),{key:1}))]),default:l(()=>[y(" "+B(w.value?"处理中...":"开始处理"),1)]),_:1},8,["disabled"])])])):P("",!0),t(H,{open:b.value,"onUpdate:open":e[11]||(e[11]=a=>b.value=a),title:"处理结果",onOk:e[12]||(e[12]=a=>b.value=!1)},{default:l(()=>[N.value.success?(n(),d("div",de,[t(A,{status:"success",title:"处理成功","sub-title":"所有文件已成功处理完成"},{extra:l(()=>[t(C,{type:"primary",onClick:e[9]||(e[9]=a=>b.value=!1)},{default:l(()=>[...e[23]||(e[23]=[y(" 确定 ",-1)])]),_:1})]),_:1})])):(n(),d("div",pe,[t(A,{status:"error",title:"处理失败","sub-title":N.value.error||"处理过程中发生错误"},{extra:l(()=>[t(C,{type:"primary",onClick:e[10]||(e[10]=a=>b.value=!1)},{default:l(()=>[...e[24]||(e[24]=[y(" 确定 ",-1)])]),_:1})]),_:1},8,["sub-title"])]))]),_:1},8,["open"])])}}},ke=K(ve,[["__scopeId","data-v-d6515a11"]]);export{ke as default};
