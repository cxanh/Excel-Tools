# é›†æˆæ–°åŠŸèƒ½åˆ° App.vue æŒ‡å—

## æ­¥éª¤ 1ï¼šæ·»åŠ å¯¼å…¥è¯­å¥

åœ¨ `src/App.vue` çš„ `<script setup lang="ts">` éƒ¨åˆ†é¡¶éƒ¨æ·»åŠ ï¼š

```typescript
// æ–°å¢ç»„ä»¶å¯¼å…¥
import ConfirmDialog from './components/ConfirmDialog.vue'
import RecentFilesList from './components/RecentFilesList.vue'
import ErrorToast from './components/ErrorToast.vue'

// æ–°å¢ store å¯¼å…¥
import { useRecentFilesStore } from './stores/recentFilesStore'
```

## æ­¥éª¤ 2ï¼šåˆå§‹åŒ– Store

åœ¨ç°æœ‰çš„ store åˆå§‹åŒ–ä»£ç åæ·»åŠ ï¼š

```typescript
const fileStore = useFileStore()
const historyStore = useHistoryStore()
const settingsStore = useSettingsStore()
const recentFilesStore = useRecentFilesStore() // æ–°å¢
```

## æ­¥éª¤ 3ï¼šæ·»åŠ å¯¹è¯æ¡†çŠ¶æ€

åœ¨ç°æœ‰çš„ ref å®šä¹‰åæ·»åŠ ï¼š

```typescript
// ç¡®è®¤å¯¹è¯æ¡†çŠ¶æ€
const showConfirmDialog = ref(false)
const confirmDialogOptions = ref({
  type: 'warning' as 'warning' | 'danger' | 'info' | 'question',
  title: '',
  message: '',
  detail: '',
  onConfirm: () => {}
})

// é”™è¯¯æç¤ºçŠ¶æ€
const showErrorToast = ref(false)
const errorToastOptions = ref({
  type: 'error' as 'error' | 'warning' | 'success' | 'info',
  title: '',
  message: '',
  detail: ''
})
```

## æ­¥éª¤ 4ï¼šæ·»åŠ æ–°æ–¹æ³•

åœ¨ç°æœ‰æ–¹æ³•åæ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š

```typescript
/**
 * ä½¿ç”¨åŸç”Ÿæ–‡ä»¶å¯¹è¯æ¡†é€‰æ‹©æ–‡ä»¶
 */
async function selectFileWithDialog() {
  try {
    const result = await window.dialogAPI.openFile()
    if (!result.canceled && result.filePaths.length > 0) {
      const filePath = result.filePaths[0]
      fileStore.setFilePath(filePath)
      historyStore.addLog('info', `å·²é€‰æ‹©æ–‡ä»¶: ${filePath}`)
      
      // è‡ªåŠ¨åŠ è½½æ–‡ä»¶
      loadFile()
    }
  } catch (error) {
    console.error('æ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†å¤±è´¥:', error)
    showError('æ‰“å¼€å¤±è´¥', 'æ— æ³•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†')
  }
}

/**
 * å¤„ç†æœ€è¿‘æ–‡ä»¶é€‰æ‹©
 */
function handleRecentFileSelected(file: any) {
  fileStore.setFilePath(file.path)
  historyStore.addLog('info', `æ­£åœ¨æ‰“å¼€æœ€è¿‘æ–‡ä»¶: ${file.name}`)
  loadFile()
}

/**
 * æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
 */
function showConfirm(options: {
  type?: 'warning' | 'danger' | 'info' | 'question'
  title: string
  message: string
  detail?: string
  confirmText?: string
  cancelText?: string
}): Promise<boolean> {
  return new Promise((resolve) => {
    confirmDialogOptions.value = {
      type: options.type || 'warning',
      title: options.title,
      message: options.message,
      detail: options.detail || '',
      onConfirm: () => {
        showConfirmDialog.value = false
        resolve(true)
      }
    }
    showConfirmDialog.value = true
    
    // ç›‘å¬å–æ¶ˆäº‹ä»¶
    const cancelHandler = () => {
      resolve(false)
    }
    
    // æ³¨æ„ï¼šéœ€è¦åœ¨ ConfirmDialog ç»„ä»¶ä¸­å¤„ç†å–æ¶ˆäº‹ä»¶
  })
}

/**
 * æ˜¾ç¤ºé”™è¯¯æç¤º
 */
function showError(title: string, message: string, detail?: string) {
  errorToastOptions.value = {
    type: 'error',
    title,
    message,
    detail: detail || ''
  }
  showErrorToast.value = true
}

/**
 * æ˜¾ç¤ºæˆåŠŸæç¤º
 */
function showSuccess(title: string, message: string, detail?: string) {
  errorToastOptions.value = {
    type: 'success',
    title,
    message,
    detail: detail || ''
  }
  showErrorToast.value = true
}

/**
 * æ˜¾ç¤ºè­¦å‘Šæç¤º
 */
function showWarning(title: string, message: string, detail?: string) {
  errorToastOptions.value = {
    type: 'warning',
    title,
    message,
    detail: detail || ''
  }
  showErrorToast.value = true
}

/**
 * æ˜¾ç¤ºä¿¡æ¯æç¤º
 */
function showInfo(title: string, message: string, detail?: string) {
  errorToastOptions.value = {
    type: 'info',
    title,
    message,
    detail: detail || ''
  }
  showErrorToast.value = true
}
```

## æ­¥éª¤ 5ï¼šä¿®æ”¹ç°æœ‰æ–¹æ³•

### 5.1 ä¿®æ”¹ handlePythonMessage æ–¹æ³•

æ‰¾åˆ° `load_file` æˆåŠŸçš„å¤„ç†éƒ¨åˆ†ï¼Œæ·»åŠ æœ€è¿‘æ–‡ä»¶è®°å½•ï¼š

```typescript
if (message.action === 'load_file' && message.status === 'success') {
  fileStore.setLoadedFile(message.data)
  fileStore.setLoading(false)
  historyStore.addLog('success', `æ–‡ä»¶åŠ è½½æˆåŠŸ: ${message.data.file_name}`)
  
  // æ–°å¢ï¼šæ·»åŠ åˆ°æœ€è¿‘æ–‡ä»¶åˆ—è¡¨
  recentFilesStore.addRecentFile({
    path: message.data.file_path,
    name: message.data.file_name,
    lastOpened: Date.now(),
    size: message.data.file_size,
    format: message.data.file_format
  })
  
  // æ˜¾ç¤ºæˆåŠŸæç¤º
  showSuccess('åŠ è½½æˆåŠŸ', `æ–‡ä»¶ ${message.data.file_name} å·²æˆåŠŸåŠ è½½`)
}
```

### 5.2 ä¿®æ”¹ deleteSheet æ–¹æ³•ï¼ˆæ·»åŠ ç¡®è®¤ï¼‰

```typescript
async function deleteSheet() {
  if (!deleteSheetName.value) {
    showError('è¾“å…¥é”™è¯¯', 'è¯·è¾“å…¥è¦åˆ é™¤çš„å·¥ä½œè¡¨åç§°')
    return
  }
  
  // æ–°å¢ï¼šæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
  const confirmed = await showConfirm({
    type: 'danger',
    title: 'ç¡®è®¤åˆ é™¤å·¥ä½œè¡¨',
    message: `ç¡®å®šè¦åˆ é™¤å·¥ä½œè¡¨"${deleteSheetName.value}"å—ï¼Ÿ`,
    detail: 'æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œå·¥ä½œè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤',
    confirmText: 'åˆ é™¤',
    cancelText: 'å–æ¶ˆ'
  })
  
  if (!confirmed) {
    historyStore.addLog('info', 'å·²å–æ¶ˆåˆ é™¤æ“ä½œ')
    return
  }
  
  fileStore.setLoading(true)
  historyStore.addLog('info', `æ­£åœ¨åˆ é™¤å·¥ä½œè¡¨: ${deleteSheetName.value}`)
  
  window.pythonBridge.sendCommand({
    action: 'delete_sheet',
    params: {
      sheet_name: deleteSheetName.value
    }
  })
}
```

### 5.3 ä¿®æ”¹ closeFile æ–¹æ³•ï¼ˆæ·»åŠ ç¡®è®¤ï¼‰

```typescript
async function closeFile() {
  // æ–°å¢ï¼šå¦‚æœæœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
  // æ³¨æ„ï¼šéœ€è¦æ·»åŠ ä¸€ä¸ªçŠ¶æ€æ¥è·Ÿè¸ªæ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
  
  const confirmed = await showConfirm({
    type: 'warning',
    title: 'ç¡®è®¤å…³é—­æ–‡ä»¶',
    message: 'ç¡®å®šè¦å…³é—­å½“å‰æ–‡ä»¶å—ï¼Ÿ',
    detail: 'è¯·ç¡®ä¿å·²ä¿å­˜æ‰€æœ‰æ›´æ”¹',
    confirmText: 'å…³é—­',
    cancelText: 'å–æ¶ˆ'
  })
  
  if (!confirmed) return
  
  fileStore.setLoading(true)
  historyStore.addLog('info', 'æ­£åœ¨å…³é—­æ–‡ä»¶...')
  
  window.pythonBridge.sendCommand({
    action: 'close_file',
    params: {}
  })
}
```

## æ­¥éª¤ 6ï¼šæ›´æ–°æ¨¡æ¿

### 6.1 åœ¨æ–‡ä»¶ç®¡ç†è§†å›¾ä¸­æ·»åŠ æŒ‰é’®å’Œæœ€è¿‘æ–‡ä»¶åˆ—è¡¨

æ‰¾åˆ°æ–‡ä»¶ç®¡ç†è§†å›¾ï¼ˆ`v-if="settingsStore.currentView === 'file'"`ï¼‰ï¼Œåœ¨ FileDropzone ä¹‹å‰æ·»åŠ ï¼š

```vue
<!-- æ–‡ä»¶é€‰æ‹©æŒ‰é’® -->
<div class="file-select-buttons" style="margin-bottom: 16px;">
  <button 
    @click="selectFileWithDialog" 
    :disabled="fileStore.isLoading" 
    class="btn btn-primary"
    style="width: 100%;"
  >
    ğŸ“‚ æµè§ˆæ–‡ä»¶
  </button>
</div>
```

åœ¨æ–‡ä»¶ä¿¡æ¯å¡ç‰‡ä¹‹åæ·»åŠ ï¼š

```vue
<!-- æœ€è¿‘æ–‡ä»¶åˆ—è¡¨ -->
<RecentFilesList 
  v-if="!fileStore.loadedFile"
  @file-selected="handleRecentFileSelected"
  style="margin-top: 24px;"
/>
```

### 6.2 åœ¨ App æ ¹å…ƒç´ æœ«å°¾æ·»åŠ å…¨å±€ç»„ä»¶

åœ¨ `</main>` ä¹‹åï¼Œ`</div>` ä¹‹å‰æ·»åŠ ï¼š

```vue
    </main>
    
    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <ConfirmDialog
      v-model:visible="showConfirmDialog"
      :type="confirmDialogOptions.type"
      :title="confirmDialogOptions.title"
      :message="confirmDialogOptions.message"
      :detail="confirmDialogOptions.detail"
      @confirm="confirmDialogOptions.onConfirm"
    />
    
    <!-- é”™è¯¯æç¤º -->
    <ErrorToast
      v-model:visible="showErrorToast"
      :type="errorToastOptions.type"
      :title="errorToastOptions.title"
      :message="errorToastOptions.message"
      :detail="errorToastOptions.detail"
    />
  </div>
</template>
```

## æ­¥éª¤ 7ï¼šæ·»åŠ æ ·å¼ï¼ˆå¯é€‰ï¼‰

åœ¨ `<style scoped>` éƒ¨åˆ†æ·»åŠ ï¼š

```css
.file-select-buttons {
  display: flex;
  gap: 12px;
}

.file-select-buttons .btn {
  flex: 1;
}
```

## æ­¥éª¤ 8ï¼šæµ‹è¯•

### 8.1 æµ‹è¯•åŸç”Ÿæ–‡ä»¶å¯¹è¯æ¡†
1. å¯åŠ¨åº”ç”¨ï¼š`npm run dev`
2. ç‚¹å‡»"ğŸ“‚ æµè§ˆæ–‡ä»¶"æŒ‰é’®
3. é€‰æ‹©ä¸€ä¸ª Excel æ–‡ä»¶
4. éªŒè¯æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½

### 8.2 æµ‹è¯•æœ€è¿‘æ–‡ä»¶åˆ—è¡¨
1. åŠ è½½å‡ ä¸ªä¸åŒçš„æ–‡ä»¶
2. å…³é—­æ–‡ä»¶
3. æŸ¥çœ‹æœ€è¿‘æ–‡ä»¶åˆ—è¡¨æ˜¯å¦æ˜¾ç¤º
4. ç‚¹å‡»æœ€è¿‘æ–‡ä»¶ï¼ŒéªŒè¯æ˜¯å¦èƒ½å¿«é€Ÿæ‰“å¼€

### 8.3 æµ‹è¯•ç¡®è®¤å¯¹è¯æ¡†
1. å°è¯•åˆ é™¤å·¥ä½œè¡¨
2. éªŒè¯æ˜¯å¦æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
3. æµ‹è¯•"ç¡®å®š"å’Œ"å–æ¶ˆ"æŒ‰é’®

### 8.4 æµ‹è¯•é”™è¯¯æç¤º
1. å°è¯•åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶
2. éªŒè¯æ˜¯å¦æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
3. éªŒè¯æç¤ºæ˜¯å¦è‡ªåŠ¨æ¶ˆå¤±

## å®Œæ•´çš„ä»£ç ç‰‡æ®µ

å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§æ·»åŠ æ‰€æœ‰åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹å®Œæ•´ä»£ç ï¼š

### å¯¼å…¥éƒ¨åˆ†
```typescript
<script setup lang="ts">
import { ref, computed, onMounted, onBeforeUnmount } from 'vue'
import { useFileStore } from './stores/fileStore'
import { useHistoryStore } from './stores/historyStore'
import { useSettingsStore } from './stores/settingsStore'
import { useRecentFilesStore } from './stores/recentFilesStore'

import FileDropzone from './components/FileDropzone.vue'
import GlobalDropzone from './components/GlobalDropzone.vue'
import CurrentFileBar from './components/CurrentFileBar.vue'
import Tooltip from './components/Tooltip.vue'
import HelpModal from './components/HelpModal.vue'
import WelcomeGuide from './components/WelcomeGuide.vue'
import ConfirmDialog from './components/ConfirmDialog.vue'
import RecentFilesList from './components/RecentFilesList.vue'
import ErrorToast from './components/ErrorToast.vue'

// åˆå§‹åŒ– stores
const fileStore = useFileStore()
const historyStore = useHistoryStore()
const settingsStore = useSettingsStore()
const recentFilesStore = useRecentFilesStore()

// ... å…¶ä½™ä»£ç 
```

## å¸¸è§é—®é¢˜

### Q1: dialogAPI æœªå®šä¹‰ï¼Ÿ
**A**: ç¡®ä¿å·²ç»é‡æ–°ç¼–è¯‘ Electronï¼š
```bash
npm run dev
```

### Q2: æœ€è¿‘æ–‡ä»¶åˆ—è¡¨ä¸æ˜¾ç¤ºï¼Ÿ
**A**: æ£€æŸ¥ localStorage æ˜¯å¦æœ‰æ•°æ®ï¼š
```javascript
console.log(localStorage.getItem('excel-toolkit-recent-files'))
```

### Q3: ç¡®è®¤å¯¹è¯æ¡†ä¸æ˜¾ç¤ºï¼Ÿ
**A**: æ£€æŸ¥ `showConfirmDialog` çš„å€¼å’Œç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥

### Q4: é”™è¯¯æç¤ºä¸è‡ªåŠ¨æ¶ˆå¤±ï¼Ÿ
**A**: æ£€æŸ¥ `duration` å±æ€§æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼ˆé»˜è®¤ 5000msï¼‰

## ä¸‹ä¸€æ­¥

å®Œæˆé›†æˆåï¼Œä½ å¯ä»¥ï¼š

1. æµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½
2. æ ¹æ®éœ€è¦è°ƒæ•´æ ·å¼
3. æ·»åŠ æ›´å¤šç¡®è®¤å¯¹è¯æ¡†åˆ°å…¶ä»–å±é™©æ“ä½œ
4. å®ç°æ–‡ä»¶æ”¶è—åŠŸèƒ½
5. æ·»åŠ å¿«æ·é”®æ”¯æŒ

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** å¦‚æœåœ¨é›†æˆè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼

