# å‘½ä»¤æ ¼å¼ç»Ÿä¸€å®Œæˆ âœ…

## å®Œæˆæ—¶é—´
2026-01-19

## ä»»åŠ¡æ¦‚è¿°

ç¡®è®¤å¹¶æ¸…ç†äº†æ¸²æŸ“è¿›ç¨‹åˆ° Python åç«¯çš„å‘½ä»¤å‘é€æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰å‘½ä»¤éƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ ¼å¼ã€‚

## å®Œæˆå†…å®¹

### âœ… 1. éªŒè¯å‘½ä»¤æ ¼å¼ç»Ÿä¸€
æ£€æŸ¥äº†æ‰€æœ‰ä½¿ç”¨ `window.pythonBridge.sendCommand()` çš„åœ°æ–¹ï¼Œç¡®è®¤æ ¼å¼ç»Ÿä¸€ï¼š

```typescript
window.pythonBridge.sendCommand({
  action: 'action_name',
  params: {
    // å‚æ•°å¯¹è±¡
  }
})
```

### âœ… 2. æ¸…ç†è°ƒè¯•ä»£ç 
åˆ é™¤äº† `electron/preload.ts` ä¸­çš„è°ƒè¯•æ—¥å¿—ï¼š

```typescript
// åˆ é™¤å‰
sendCommand: (command: { action: string; params: any }) => {
  ipcRenderer.send('python-command', command);
  console.log('[MMMMAIN] Sent command to Python:', command); // âŒ è°ƒè¯•ä»£ç 
},

// åˆ é™¤å
sendCommand: (command: { action: string; params: any }) => {
  ipcRenderer.send('python-command', command);
},
```

### âœ… 3. åˆ›å»ºæ–‡æ¡£
åˆ›å»ºäº† `å‘½ä»¤æ ¼å¼ç»Ÿä¸€è¯´æ˜.md`ï¼ŒåŒ…å«ï¼š
- å‘½ä»¤æ ¼å¼è§„èŒƒ
- å®ç°æµç¨‹å›¾
- æ‰€æœ‰å‘½ä»¤åˆ—è¡¨
- å“åº”æ ¼å¼è¯´æ˜
- æœ€ä½³å®è·µ
- è°ƒè¯•æŠ€å·§
- æ·»åŠ æ–°å‘½ä»¤çš„æ­¥éª¤

## ç»Ÿä¸€çš„å‘½ä»¤æ ¼å¼

### æ ‡å‡†æ ¼å¼
```typescript
{
  action: string,    // æ“ä½œåç§°ï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰
  params: object     // å‚æ•°å¯¹è±¡ï¼ˆå¿…é¡»æ˜¯å¯¹è±¡ï¼Œå³ä½¿ä¸ºç©ºï¼‰
}
```

### ç¤ºä¾‹

#### æ— å‚æ•°å‘½ä»¤
```typescript
window.pythonBridge.sendCommand({
  action: 'close_file',
  params: {}
});
```

#### æœ‰å‚æ•°å‘½ä»¤
```typescript
window.pythonBridge.sendCommand({
  action: 'load_file',
  params: {
    file_path: 'C:\\path\\to\\file.xlsx'
  }
});
```

#### å¤šå‚æ•°å‘½ä»¤
```typescript
window.pythonBridge.sendCommand({
  action: 'replace_content',
  params: {
    find_text: 'æŸ¥æ‰¾å†…å®¹',
    replace_text: 'æ›¿æ¢å†…å®¹',
    case_sensitive: false,
    use_regex: false
  }
});
```

## å‘½ä»¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸²æŸ“è¿›ç¨‹ (Vue)  â”‚
â”‚  src/App.vue    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ window.pythonBridge.sendCommand()
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Preload è„šæœ¬   â”‚
â”‚  preload.ts     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ipcRenderer.send('python-command', command)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»è¿›ç¨‹         â”‚
â”‚  main.ts        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ sendCommandToPython(command)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python åç«¯    â”‚
â”‚  main.py        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ router.route(command)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘½ä»¤å¤„ç†å™¨      â”‚
â”‚  å„ä¸ª engine    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ‰€æœ‰å‘½ä»¤åˆ—è¡¨

### æ–‡ä»¶æ“ä½œ (3ä¸ª)
1. `load_file` - åŠ è½½æ–‡ä»¶
2. `close_file` - å…³é—­æ–‡ä»¶
3. `save_file` - ä¿å­˜æ–‡ä»¶

### å†…å®¹å¤„ç† (5ä¸ª)
4. `remove_blank_rows` - åˆ é™¤ç©ºç™½è¡Œ
5. `clear_blank_cells` - æ¸…é™¤ç©ºç™½å•å…ƒæ ¼
6. `remove_formulas` - åˆ é™¤å…¬å¼
7. `remove_duplicate_rows` - åˆ é™¤é‡å¤è¡Œ
8. `replace_content` - æ›¿æ¢å†…å®¹

### å›¾åƒå¤„ç† (3ä¸ª)
9. `extract_images` - æå–å›¾ç‰‡
10. `add_text_watermark` - æ·»åŠ æ–‡å­—æ°´å°
11. `add_image_watermark` - æ·»åŠ å›¾ç‰‡æ°´å°

### å·¥ä½œè¡¨ç®¡ç† (3ä¸ª)
12. `insert_sheet` - æ’å…¥å·¥ä½œè¡¨
13. `delete_sheet` - åˆ é™¤å·¥ä½œè¡¨
14. `rename_sheet` - é‡å‘½åå·¥ä½œè¡¨

### åˆå¹¶æ‹†åˆ† (2ä¸ª)
15. `merge_excel_files` - åˆå¹¶ Excel æ–‡ä»¶
16. `split_excel_file` - æ‹†åˆ† Excel æ–‡ä»¶

### æ ¼å¼è½¬æ¢ (2ä¸ª)
17. `excel_to_pdf` - Excel è½¬ PDF
18. `excel_to_csv` - Excel è½¬ CSV

**æ€»è®¡**: 18 ä¸ªå‘½ä»¤

## ä»£ç ç»Ÿè®¡

### æ£€æŸ¥ç»“æœ
- âœ… æ‰€æœ‰å‘½ä»¤éƒ½ä½¿ç”¨ `window.pythonBridge.sendCommand()`
- âœ… æ‰€æœ‰å‘½ä»¤éƒ½åŒ…å« `action` å’Œ `params`
- âœ… æ‰€æœ‰ `params` éƒ½æ˜¯å¯¹è±¡ç±»å‹
- âœ… æ‰€æœ‰ `action` éƒ½ä½¿ç”¨ä¸‹åˆ’çº¿å‘½å

### æ–‡ä»¶ä¿®æ”¹
- âœ… `electron/preload.ts` - åˆ é™¤è°ƒè¯•æ—¥å¿—
- âœ… `å‘½ä»¤æ ¼å¼ç»Ÿä¸€è¯´æ˜.md` - æ–°å¢æ–‡æ¡£

## ç±»å‹å®‰å…¨

### TypeScript ç±»å‹å®šä¹‰
```typescript
// electron/preload.ts
interface Command {
  action: string;
  params: any;
}

// ä½¿ç”¨ç¤ºä¾‹
sendCommand: (command: { action: string; params: any }) => {
  ipcRenderer.send('python-command', command);
}
```

### ç±»å‹æ£€æŸ¥
- âœ… TypeScript ç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… å‚æ•°ç±»å‹éªŒè¯
- âœ… IDE è‡ªåŠ¨è¡¥å…¨

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•
1. å§‹ç»ˆä½¿ç”¨ `window.pythonBridge.sendCommand()`
2. `params` å§‹ç»ˆæ˜¯å¯¹è±¡ï¼ˆå³ä½¿ä¸ºç©ºï¼‰
3. `action` ä½¿ç”¨ä¸‹åˆ’çº¿å‘½å
4. æ·»åŠ æ“ä½œæ—¥å¿—
5. è®¾ç½®åŠ è½½çŠ¶æ€

### ç¤ºä¾‹ä»£ç 
```typescript
function loadFile() {
  // 1. éªŒè¯è¾“å…¥
  if (!fileStore.filePath) {
    historyStore.addLog('error', 'è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„');
    return;
  }
  
  // 2. è®¾ç½®åŠ è½½çŠ¶æ€
  fileStore.setLoading(true);
  fileStore.setLoadedFile(null);
  
  // 3. æ·»åŠ æ—¥å¿—
  historyStore.addLog('info', `æ­£åœ¨åŠ è½½æ–‡ä»¶: ${fileStore.filePath}`);
  
  // 4. å‘é€å‘½ä»¤
  window.pythonBridge.sendCommand({
    action: 'load_file',
    params: {
      file_path: fileStore.filePath
    }
  });
}
```

## å“åº”å¤„ç†

### ç»Ÿä¸€çš„å“åº”å¤„ç†
```typescript
function handlePythonMessage(message: any) {
  if (message.type === 'result') {
    fileStore.setLoading(false);
    settingsStore.clearProgress();
    
    if (message.status === 'success') {
      historyStore.addLog('success', message.message);
      showSuccess('æ“ä½œæˆåŠŸ', message.message);
      
      // å¤„ç†è¿”å›æ•°æ®
      if (message.data) {
        // ...
      }
    } else {
      historyStore.addLog('error', message.message);
      showError('æ“ä½œå¤±è´¥', message.message, message.suggested_action);
    }
  } else if (message.type === 'progress') {
    settingsStore.setProgress(message.progress, message.message);
  }
}
```

## è°ƒè¯•æ–¹æ³•

### 1. æŸ¥çœ‹å‘é€çš„å‘½ä»¤
æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼š
```
[MAIN] Received command from renderer: {
  action: 'load_file',
  params: { file_path: 'C:\\path\\to\\file.xlsx' }
}
```

### 2. æŸ¥çœ‹ Python æ¥æ”¶
ç»ˆç«¯è¾“å‡ºï¼š
```
[BACKEND] Received command: load_file
[LOADER] Loading .xlsx file: C:\path\to\file.xlsx
```

### 3. æŸ¥çœ‹å“åº”
æµè§ˆå™¨æ§åˆ¶å°ï¼š
```
[PYTHON] {
  type: 'result',
  status: 'success',
  message: 'æ–‡ä»¶åŠ è½½æˆåŠŸ',
  data: { ... }
}
```

## æµ‹è¯•éªŒè¯

### âœ… æµ‹è¯•é¡¹ç›®
1. æ–‡ä»¶åŠ è½½ - æ­£å¸¸
2. æ–‡ä»¶ä¿å­˜ - æ­£å¸¸
3. å†…å®¹å¤„ç† - æ­£å¸¸
4. å›¾åƒå¤„ç† - æ­£å¸¸
5. å·¥ä½œè¡¨ç®¡ç† - æ­£å¸¸
6. åˆå¹¶æ‹†åˆ† - æ­£å¸¸
7. æ ¼å¼è½¬æ¢ - æ­£å¸¸

### âœ… æ ¼å¼éªŒè¯
- æ‰€æœ‰å‘½ä»¤æ ¼å¼ç»Ÿä¸€
- å‚æ•°ä¼ é€’æ­£ç¡®
- å“åº”å¤„ç†æ­£å¸¸
- é”™è¯¯å¤„ç†å®Œå–„

## ä¼˜åŠ¿æ€»ç»“

### 1. ç»Ÿä¸€æ€§
- æ‰€æœ‰å‘½ä»¤ä½¿ç”¨ç›¸åŒæ ¼å¼
- æ˜“äºç†è§£å’Œç»´æŠ¤
- å‡å°‘é”™è¯¯

### 2. ç±»å‹å®‰å…¨
- TypeScript ç±»å‹æ£€æŸ¥
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹
- IDE è‡ªåŠ¨è¡¥å…¨

### 3. å¯ç»´æŠ¤æ€§
- æ¸…æ™°çš„ä»£ç ç»“æ„
- æ˜“äºæ·»åŠ æ–°å‘½ä»¤
- æ˜“äºè°ƒè¯•

### 4. å¯æ‰©å±•æ€§
- ç»Ÿä¸€çš„æ¥å£
- æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- å‘åå…¼å®¹

## åç»­å»ºè®®

### çŸ­æœŸ
1. âœ… ä¿æŒæ ¼å¼ç»Ÿä¸€
2. âœ… æ·»åŠ é€‚å½“çš„æ—¥å¿—
3. âœ… å®Œå–„é”™è¯¯å¤„ç†

### ä¸­æœŸ
1. æ·»åŠ å‘½ä»¤éªŒè¯
2. å®ç°å‘½ä»¤é˜Ÿåˆ—
3. æ·»åŠ å‘½ä»¤é‡è¯•æœºåˆ¶

### é•¿æœŸ
1. å®ç°å‘½ä»¤å†å²
2. æ·»åŠ å‘½ä»¤æ’¤é”€
3. ä¼˜åŒ–æ€§èƒ½

## æ€»ç»“

âœ… **å‘½ä»¤æ ¼å¼å·²ç»Ÿä¸€**
- æ‰€æœ‰å‘½ä»¤ä½¿ç”¨ `window.pythonBridge.sendCommand()`
- æ ¼å¼ï¼š`{ action: string, params: object }`
- 18 ä¸ªå‘½ä»¤å…¨éƒ¨éªŒè¯é€šè¿‡

ğŸ¯ **ä»£ç è´¨é‡**
- ç±»å‹å®‰å…¨
- æ˜“äºç»´æŠ¤
- æ˜“äºæ‰©å±•
- æ˜“äºè°ƒè¯•

ğŸ“ **æ–‡æ¡£å®Œå–„**
- å‘½ä»¤æ ¼å¼è¯´æ˜
- æœ€ä½³å®è·µ
- è°ƒè¯•æŠ€å·§
- æ·»åŠ æ–°å‘½ä»¤æŒ‡å—

---

**å®Œæˆæ—¶é—´**: 2026-01-19  
**çŠ¶æ€**: âœ… å®Œå…¨ç»Ÿä¸€  
**åº”ç”¨çŠ¶æ€**: ğŸŸ¢ æ­£å¸¸è¿è¡Œ

