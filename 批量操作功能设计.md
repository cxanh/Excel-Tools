# æ‰¹é‡æ“ä½œåŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°æ‰¹é‡æ“ä½œåŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·å¯¹å¤šä¸ª Excel æ–‡ä»¶æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œå¤§å¹…æå‡å·¥ä½œæ•ˆç‡ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ‰¹é‡æ–‡ä»¶å¤„ç†
- é€‰æ‹©å¤šä¸ªæ–‡ä»¶
- å¯¹æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œç›¸åŒæ“ä½œ
- æ˜¾ç¤ºæ•´ä½“è¿›åº¦å’Œå½“å‰æ–‡ä»¶è¿›åº¦
- å¤±è´¥æ—¶ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶
- æ˜¾ç¤ºæ“ä½œæ‘˜è¦

### 2. ä»»åŠ¡æ¨¡æ¿
- åˆ›å»ºå’Œä¿å­˜ä»»åŠ¡æ¨¡æ¿
- åº”ç”¨ä»»åŠ¡æ¨¡æ¿
- ç®¡ç†ä»»åŠ¡æ¨¡æ¿åˆ—è¡¨
- å¯¼å…¥/å¯¼å‡ºæ¨¡æ¿

### 3. æ“ä½œå–æ¶ˆ
- æ”¯æŒå–æ¶ˆé•¿æ—¶é—´æ“ä½œ
- æç¤ºæ˜¯å¦ä¿ç•™éƒ¨åˆ†ç»“æœ

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å‰ç«¯ç»„ä»¶

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ BatchProcessor.vue       # æ‰¹é‡å¤„ç†ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ FileSelector.vue         # å¤šæ–‡ä»¶é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ OperationSelector.vue    # æ“ä½œé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ BatchProgress.vue        # æ‰¹é‡è¿›åº¦æ˜¾ç¤º
â”‚   â”œâ”€â”€ BatchSummary.vue         # æ‰¹é‡ç»“æœæ‘˜è¦
â”‚   â”œâ”€â”€ TemplateManager.vue      # æ¨¡æ¿ç®¡ç†å™¨
â”‚   â””â”€â”€ TemplateEditor.vue       # æ¨¡æ¿ç¼–è¾‘å™¨
â””â”€â”€ stores/
    â””â”€â”€ batchStore.ts            # æ‰¹é‡æ“ä½œçŠ¶æ€ç®¡ç†
```

### åç«¯æ¨¡å—

```
python-backend/
â””â”€â”€ engine/
    â””â”€â”€ batch/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ processor.py         # æ‰¹é‡å¤„ç†å™¨
        â””â”€â”€ template.py          # æ¨¡æ¿ç®¡ç†å™¨
```

## ğŸ“Š æ•°æ®ç»“æ„

### æ‰¹é‡ä»»åŠ¡

```typescript
interface BatchTask {
  id: string;                    // ä»»åŠ¡ ID
  name: string;                  // ä»»åŠ¡åç§°
  files: string[];               // æ–‡ä»¶è·¯å¾„åˆ—è¡¨
  operation: string;             // æ“ä½œç±»å‹
  params: Record<string, any>;   // æ“ä½œå‚æ•°
  status: 'pending' | 'running' | 'completed' | 'cancelled';
  progress: number;              // æ•´ä½“è¿›åº¦ (0-100)
  currentFile: string;           // å½“å‰å¤„ç†çš„æ–‡ä»¶
  currentFileProgress: number;   // å½“å‰æ–‡ä»¶è¿›åº¦
  results: BatchResult[];        // ç»“æœåˆ—è¡¨
  startTime?: number;            // å¼€å§‹æ—¶é—´
  endTime?: number;              // ç»“æŸæ—¶é—´
}
```

### æ‰¹é‡ç»“æœ

```typescript
interface BatchResult {
  file: string;                  // æ–‡ä»¶è·¯å¾„
  status: 'success' | 'error' | 'skipped';
  message: string;               // ç»“æœæ¶ˆæ¯
  error?: string;                // é”™è¯¯ä¿¡æ¯
  duration?: number;             // å¤„ç†æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
}
```

### ä»»åŠ¡æ¨¡æ¿

```typescript
interface TaskTemplate {
  id: string;                    // æ¨¡æ¿ ID
  name: string;                  // æ¨¡æ¿åç§°
  description: string;           // æ¨¡æ¿æè¿°
  operation: string;             // æ“ä½œç±»å‹
  params: Record<string, any>;   // æ“ä½œå‚æ•°
  createdAt: number;             // åˆ›å»ºæ—¶é—´
  updatedAt: number;             // æ›´æ–°æ—¶é—´
}
```

## ğŸ”„ å·¥ä½œæµç¨‹

### æ‰¹é‡å¤„ç†æµç¨‹

```
1. ç”¨æˆ·é€‰æ‹©å¤šä¸ªæ–‡ä»¶
   â†“
2. ç”¨æˆ·é€‰æ‹©æ“ä½œç±»å‹
   â†“
3. ç”¨æˆ·é…ç½®æ“ä½œå‚æ•°
   â†“
4. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æ‰¹é‡å¤„ç†"
   â†“
5. å‰ç«¯å‘é€æ‰¹é‡ä»»åŠ¡åˆ°åç«¯
   â†“
6. åç«¯é€ä¸ªå¤„ç†æ–‡ä»¶
   â”œâ”€ åŠ è½½æ–‡ä»¶
   â”œâ”€ æ‰§è¡Œæ“ä½œ
   â”œâ”€ ä¿å­˜æ–‡ä»¶
   â”œâ”€ å‘é€è¿›åº¦æ›´æ–°
   â””â”€ è®°å½•ç»“æœ
   â†“
7. åç«¯è¿”å›æ‰¹é‡ç»“æœæ‘˜è¦
   â†“
8. å‰ç«¯æ˜¾ç¤ºç»“æœæ‘˜è¦
```

### æ¨¡æ¿ä½¿ç”¨æµç¨‹

```
1. ç”¨æˆ·åˆ›å»º/é€‰æ‹©æ¨¡æ¿
   â†“
2. æ¨¡æ¿è‡ªåŠ¨å¡«å……æ“ä½œå‚æ•°
   â†“
3. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
   â†“
4. ç”¨æˆ·ç‚¹å‡»"åº”ç”¨æ¨¡æ¿"
   â†“
5. æ‰§è¡Œæ‰¹é‡å¤„ç†
```

## ğŸ¨ ç”¨æˆ·ç•Œé¢è®¾è®¡

### æ‰¹é‡å¤„ç†è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ æ‰¹é‡æ“ä½œ                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ 1. é€‰æ‹©æ–‡ä»¶                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“‚ å·²é€‰æ‹© 5 ä¸ªæ–‡ä»¶                            â”‚   â”‚
â”‚ â”‚ â”œâ”€ file1.xlsx                                â”‚   â”‚
â”‚ â”‚ â”œâ”€ file2.xlsx                                â”‚   â”‚
â”‚ â”‚ â”œâ”€ file3.xlsx                                â”‚   â”‚
â”‚ â”‚ â””â”€ ...                                       â”‚   â”‚
â”‚ â”‚ [æµè§ˆæ–‡ä»¶] [æ¸…é™¤åˆ—è¡¨]                         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚ 2. é€‰æ‹©æ“ä½œ                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ æ“ä½œç±»å‹: [åˆ é™¤ç©ºç™½è¡Œ â–¼]                      â”‚   â”‚
â”‚ â”‚                                               â”‚   â”‚
â”‚ â”‚ å‚æ•°é…ç½®:                                     â”‚   â”‚
â”‚ â”‚ (æ ¹æ®æ“ä½œç±»å‹åŠ¨æ€æ˜¾ç¤º)                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚ 3. æ¨¡æ¿ç®¡ç†                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [ä¿å­˜ä¸ºæ¨¡æ¿] [åŠ è½½æ¨¡æ¿] [ç®¡ç†æ¨¡æ¿]            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚ [å¼€å§‹æ‰¹é‡å¤„ç†] [å–æ¶ˆ]                                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰¹é‡è¿›åº¦è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­£åœ¨æ‰¹é‡å¤„ç†...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ æ•´ä½“è¿›åº¦: 60% (3/5 ä¸ªæ–‡ä»¶)                           â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                                â”‚
â”‚                                                      â”‚
â”‚ å½“å‰æ–‡ä»¶: file3.xlsx                                 â”‚
â”‚ å½“å‰è¿›åº¦: 45%                                        â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                                â”‚
â”‚                                                      â”‚
â”‚ å·²å®Œæˆ:                                              â”‚
â”‚ âœ“ file1.xlsx - æˆåŠŸ                                 â”‚
â”‚ âœ“ file2.xlsx - æˆåŠŸ                                 â”‚
â”‚                                                      â”‚
â”‚ [å–æ¶ˆæ‰¹é‡å¤„ç†]                                       â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰¹é‡ç»“æœæ‘˜è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡å¤„ç†å®Œæˆ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ ğŸ“Š å¤„ç†æ‘˜è¦                                          â”‚
â”‚ â”œâ”€ æ€»æ–‡ä»¶æ•°: 5                                       â”‚
â”‚ â”œâ”€ æˆåŠŸ: 4                                           â”‚
â”‚ â”œâ”€ å¤±è´¥: 1                                           â”‚
â”‚ â””â”€ æ€»è€—æ—¶: 2 åˆ† 30 ç§’                                â”‚
â”‚                                                      â”‚
â”‚ ğŸ“‹ è¯¦ç»†ç»“æœ                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ âœ“ file1.xlsx - æˆåŠŸ (15 ç§’)                  â”‚   â”‚
â”‚ â”‚ âœ“ file2.xlsx - æˆåŠŸ (20 ç§’)                  â”‚   â”‚
â”‚ â”‚ âœ“ file3.xlsx - æˆåŠŸ (18 ç§’)                  â”‚   â”‚
â”‚ â”‚ âœ— file4.xlsx - å¤±è´¥: æ–‡ä»¶æŸå                â”‚   â”‚
â”‚ â”‚ âœ“ file5.xlsx - æˆåŠŸ (22 ç§’)                  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚ [å¯¼å‡ºæŠ¥å‘Š] [å…³é—­]                                    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å‰ç«¯å®ç°

#### 1. Pinia Store

```typescript
// src/stores/batchStore.ts
import { defineStore } from 'pinia';

export const useBatchStore = defineStore('batch', {
  state: () => ({
    currentTask: null as BatchTask | null,
    templates: [] as TaskTemplate[],
    isProcessing: false,
  }),
  
  actions: {
    startBatchTask(task: BatchTask) {
      this.currentTask = task;
      this.isProcessing = true;
    },
    
    updateProgress(progress: number, currentFile: string, currentFileProgress: number) {
      if (this.currentTask) {
        this.currentTask.progress = progress;
        this.currentTask.currentFile = currentFile;
        this.currentTask.currentFileProgress = currentFileProgress;
      }
    },
    
    addResult(result: BatchResult) {
      if (this.currentTask) {
        this.currentTask.results.push(result);
      }
    },
    
    completeBatchTask() {
      if (this.currentTask) {
        this.currentTask.status = 'completed';
        this.currentTask.endTime = Date.now();
      }
      this.isProcessing = false;
    },
    
    cancelBatchTask() {
      if (this.currentTask) {
        this.currentTask.status = 'cancelled';
        this.currentTask.endTime = Date.now();
      }
      this.isProcessing = false;
    },
    
    // æ¨¡æ¿ç®¡ç†
    saveTemplate(template: TaskTemplate) {
      this.templates.push(template);
      localStorage.setItem('taskTemplates', JSON.stringify(this.templates));
    },
    
    loadTemplates() {
      const stored = localStorage.getItem('taskTemplates');
      if (stored) {
        this.templates = JSON.parse(stored);
      }
    },
    
    deleteTemplate(id: string) {
      this.templates = this.templates.filter(t => t.id !== id);
      localStorage.setItem('taskTemplates', JSON.stringify(this.templates));
    },
  },
});
```

#### 2. æ‰¹é‡å¤„ç†ç»„ä»¶

```vue
<!-- src/components/BatchProcessor.vue -->
<template>
  <div class="batch-processor">
    <h2>ğŸ“¦ æ‰¹é‡æ“ä½œ</h2>
    
    <!-- æ–‡ä»¶é€‰æ‹© -->
    <section class="file-selection">
      <h3>1. é€‰æ‹©æ–‡ä»¶</h3>
      <FileSelector v-model="selectedFiles" />
    </section>
    
    <!-- æ“ä½œé€‰æ‹© -->
    <section class="operation-selection">
      <h3>2. é€‰æ‹©æ“ä½œ</h3>
      <OperationSelector 
        v-model:operation="selectedOperation"
        v-model:params="operationParams"
      />
    </section>
    
    <!-- æ¨¡æ¿ç®¡ç† -->
    <section class="template-management">
      <h3>3. æ¨¡æ¿ç®¡ç†</h3>
      <button @click="saveAsTemplate">ä¿å­˜ä¸ºæ¨¡æ¿</button>
      <button @click="loadTemplate">åŠ è½½æ¨¡æ¿</button>
      <button @click="manageTemplates">ç®¡ç†æ¨¡æ¿</button>
    </section>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="actions">
      <button 
        @click="startBatchProcessing" 
        :disabled="!canStart"
        class="btn-primary"
      >
        å¼€å§‹æ‰¹é‡å¤„ç†
      </button>
      <button @click="cancel" class="btn-secondary">å–æ¶ˆ</button>
    </div>
    
    <!-- è¿›åº¦æ˜¾ç¤º -->
    <BatchProgress 
      v-if="batchStore.isProcessing"
      :task="batchStore.currentTask"
      @cancel="cancelBatchProcessing"
    />
    
    <!-- ç»“æœæ‘˜è¦ -->
    <BatchSummary 
      v-if="showSummary"
      :task="batchStore.currentTask"
      @close="showSummary = false"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { useBatchStore } from '../stores/batchStore';
import FileSelector from './FileSelector.vue';
import OperationSelector from './OperationSelector.vue';
import BatchProgress from './BatchProgress.vue';
import BatchSummary from './BatchSummary.vue';

const batchStore = useBatchStore();

const selectedFiles = ref<string[]>([]);
const selectedOperation = ref('');
const operationParams = ref({});
const showSummary = ref(false);

const canStart = computed(() => {
  return selectedFiles.value.length > 0 && selectedOperation.value !== '';
});

function startBatchProcessing() {
  const task: BatchTask = {
    id: Date.now().toString(),
    name: `æ‰¹é‡${selectedOperation.value}`,
    files: selectedFiles.value,
    operation: selectedOperation.value,
    params: operationParams.value,
    status: 'running',
    progress: 0,
    currentFile: '',
    currentFileProgress: 0,
    results: [],
    startTime: Date.now(),
  };
  
  batchStore.startBatchTask(task);
  
  // å‘é€æ‰¹é‡ä»»åŠ¡åˆ°åç«¯
  window.pythonBridge.sendCommand({
    action: 'batch_process',
    params: {
      files: selectedFiles.value,
      operation: selectedOperation.value,
      operation_params: operationParams.value,
    },
  });
}

function cancelBatchProcessing() {
  // å‘é€å–æ¶ˆå‘½ä»¤
  window.pythonBridge.sendCommand({
    action: 'cancel_batch',
    params: {},
  });
  
  batchStore.cancelBatchTask();
}

function saveAsTemplate() {
  // å®ç°ä¿å­˜æ¨¡æ¿é€»è¾‘
}

function loadTemplate() {
  // å®ç°åŠ è½½æ¨¡æ¿é€»è¾‘
}

function manageTemplates() {
  // å®ç°ç®¡ç†æ¨¡æ¿é€»è¾‘
}
</script>
```

### åç«¯å®ç°

#### 1. æ‰¹é‡å¤„ç†å™¨

```python
# python-backend/engine/batch/processor.py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Batch Processor - æ‰¹é‡å¤„ç†å™¨
è´Ÿè´£æ‰¹é‡å¤„ç†å¤šä¸ª Excel æ–‡ä»¶
"""

import sys
import time
from typing import Dict, Any, List


def log(message):
    """å°†æ—¥å¿—è¾“å‡ºåˆ° stderr"""
    sys.stderr.write(f"[BATCH_PROCESSOR] {message}\n")
    sys.stderr.flush()


def send_progress(progress, message="", data=None):
    """å‘é€è¿›åº¦æ¶ˆæ¯"""
    import json
    progress_msg = {
        "type": "batch_progress",
        "progress": progress,
        "message": message
    }
    if data:
        progress_msg["data"] = data
    
    print(json.dumps(progress_msg, ensure_ascii=False), flush=True)


class BatchProcessor:
    """æ‰¹é‡å¤„ç†å™¨"""
    
    def __init__(self, file_loader, file_saver, operation_handler):
        """
        åˆå§‹åŒ–æ‰¹é‡å¤„ç†å™¨
        
        Args:
            file_loader: æ–‡ä»¶åŠ è½½å™¨
            file_saver: æ–‡ä»¶ä¿å­˜å™¨
            operation_handler: æ“ä½œå¤„ç†å™¨ï¼ˆCommandRouterï¼‰
        """
        self.file_loader = file_loader
        self.file_saver = file_saver
        self.operation_handler = operation_handler
        self.cancelled = False
    
    def process(self, params: Dict[str, Any]) -> Dict[str, Any]:
        """
        æ‰¹é‡å¤„ç†æ–‡ä»¶
        
        Args:
            params: dict, åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                - files: list, æ–‡ä»¶è·¯å¾„åˆ—è¡¨
                - operation: str, æ“ä½œç±»å‹
                - operation_params: dict, æ“ä½œå‚æ•°
                - save_files: bool, æ˜¯å¦ä¿å­˜æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œé»˜è®¤ Trueï¼‰
        
        Returns:
            dict, æ‰¹é‡å¤„ç†ç»“æœ
        """
        files = params.get('files', [])
        operation = params.get('operation')
        operation_params = params.get('operation_params', {})
        save_files = params.get('save_files', True)
        
        if not files:
            return {
                "type": "result",
                "status": "error",
                "error_code": "MISSING_FILES",
                "message": "ç¼ºå°‘æ–‡ä»¶åˆ—è¡¨"
            }
        
        if not operation:
            return {
                "type": "result",
                "status": "error",
                "error_code": "MISSING_OPERATION",
                "message": "ç¼ºå°‘æ“ä½œç±»å‹"
            }
        
        log(f"Starting batch processing: {len(files)} files, operation: {operation}")
        
        total_files = len(files)
        results = []
        success_count = 0
        error_count = 0
        start_time = time.time()
        
        self.cancelled = False
        
        for index, file_path in enumerate(files):
            if self.cancelled:
                log("Batch processing cancelled by user")
                break
            
            file_name = file_path.split('\\')[-1].split('/')[-1]
            log(f"Processing file {index + 1}/{total_files}: {file_name}")
            
            # å‘é€æ•´ä½“è¿›åº¦
            overall_progress = int((index / total_files) * 100)
            send_progress(
                overall_progress,
                f"æ­£åœ¨å¤„ç†ç¬¬ {index + 1}/{total_files} ä¸ªæ–‡ä»¶: {file_name}",
                {
                    "current_file": file_name,
                    "current_file_index": index + 1,
                    "total_files": total_files
                }
            )
            
            file_start_time = time.time()
            
            try:
                # 1. åŠ è½½æ–‡ä»¶
                load_result = self.file_loader.load({
                    "file_path": file_path
                })
                
                if load_result['status'] != 'success':
                    results.append({
                        "file": file_path,
                        "file_name": file_name,
                        "status": "error",
                        "message": load_result['message'],
                        "duration": int((time.time() - file_start_time) * 1000)
                    })
                    error_count += 1
                    continue
                
                # 2. æ‰§è¡Œæ“ä½œ
                operation_result = self.operation_handler.route({
                    "action": operation,
                    "params": operation_params
                })
                
                if operation_result['status'] != 'success':
                    results.append({
                        "file": file_path,
                        "file_name": file_name,
                        "status": "error",
                        "message": operation_result['message'],
                        "duration": int((time.time() - file_start_time) * 1000)
                    })
                    error_count += 1
                    
                    # å…³é—­æ–‡ä»¶
                    self.file_loader.close()
                    continue
                
                # 3. ä¿å­˜æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if save_files:
                    save_result = self.file_saver.save({
                        "workbook": self.file_loader.get_current_workbook(),
                        "file_path": file_path,
                        "overwrite": True,
                        "create_backup": True
                    })
                    
                    if save_result['status'] != 'success':
                        results.append({
                            "file": file_path,
                            "file_name": file_name,
                            "status": "error",
                            "message": f"ä¿å­˜å¤±è´¥: {save_result['message']}",
                            "duration": int((time.time() - file_start_time) * 1000)
                        })
                        error_count += 1
                        
                        # å…³é—­æ–‡ä»¶
                        self.file_loader.close()
                        continue
                
                # 4. å…³é—­æ–‡ä»¶
                self.file_loader.close()
                
                # 5. è®°å½•æˆåŠŸç»“æœ
                results.append({
                    "file": file_path,
                    "file_name": file_name,
                    "status": "success",
                    "message": operation_result['message'],
                    "duration": int((time.time() - file_start_time) * 1000)
                })
                success_count += 1
                
            except Exception as e:
                log(f"Error processing file {file_name}: {str(e)}")
                results.append({
                    "file": file_path,
                    "file_name": file_name,
                    "status": "error",
                    "message": f"å¤„ç†å¤±è´¥: {str(e)}",
                    "duration": int((time.time() - file_start_time) * 1000)
                })
                error_count += 1
                
                # ç¡®ä¿æ–‡ä»¶è¢«å…³é—­
                try:
                    self.file_loader.close()
                except:
                    pass
        
        # å‘é€å®Œæˆè¿›åº¦
        send_progress(100, "æ‰¹é‡å¤„ç†å®Œæˆ")
        
        total_duration = int((time.time() - start_time) * 1000)
        
        log(f"Batch processing completed: {success_count} success, {error_count} errors")
        
        return {
            "type": "result",
            "status": "success" if error_count == 0 else "partial_success",
            "message": f"æ‰¹é‡å¤„ç†å®Œæˆ: æˆåŠŸ {success_count}/{total_files} ä¸ªæ–‡ä»¶",
            "data": {
                "total_files": total_files,
                "success_count": success_count,
                "error_count": error_count,
                "cancelled": self.cancelled,
                "duration": total_duration,
                "results": results
            }
        }
    
    def cancel(self):
        """å–æ¶ˆæ‰¹é‡å¤„ç†"""
        self.cancelled = True
        log("Batch processing cancellation requested")
```

#### 2. åœ¨ main.py ä¸­æ·»åŠ è·¯ç”±

```python
# python-backend/main.py

from engine.batch.processor import BatchProcessor

class CommandRouter:
    def __init__(self):
        # ... å…¶ä»–åˆå§‹åŒ–
        self.batch_processor = BatchProcessor(
            self.file_loader,
            self.file_saver,
            self  # ä¼ å…¥è‡ªå·±ä½œä¸º operation_handler
        )
        
        # å‘½ä»¤è·¯ç”±è¡¨
        self.routes = {
            # ... å…¶ä»–è·¯ç”±
            'batch_process': self.handle_batch_process,
            'cancel_batch': self.handle_cancel_batch,
        }
    
    def handle_batch_process(self, params: dict) -> dict:
        """å¤„ç†æ‰¹é‡å¤„ç†å‘½ä»¤"""
        return self.batch_processor.process(params)
    
    def handle_cancel_batch(self, params: dict) -> dict:
        """å¤„ç†å–æ¶ˆæ‰¹é‡å¤„ç†å‘½ä»¤"""
        self.batch_processor.cancel()
        return {
            "type": "result",
            "status": "success",
            "message": "å·²è¯·æ±‚å–æ¶ˆæ‰¹é‡å¤„ç†"
        }
```

## ğŸ“ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: åŸºç¡€æ‰¹é‡å¤„ç†ï¼ˆMVPï¼‰
1. âœ… åˆ›å»ºæ‰¹é‡å¤„ç†å™¨æ¨¡å—
2. âœ… å®ç°åŸºç¡€æ‰¹é‡å¤„ç†é€»è¾‘
3. âœ… æ·»åŠ è¿›åº¦æŠ¥å‘Š
4. âœ… å®ç°é”™è¯¯å¤„ç†
5. âœ… åˆ›å»ºå‰ç«¯æ‰¹é‡å¤„ç†ç»„ä»¶
6. âœ… é›†æˆåˆ°ä¸»ç•Œé¢

### é˜¶æ®µ 2: æ¨¡æ¿åŠŸèƒ½
1. â¬œ å®ç°æ¨¡æ¿ä¿å­˜
2. â¬œ å®ç°æ¨¡æ¿åŠ è½½
3. â¬œ å®ç°æ¨¡æ¿ç®¡ç†ç•Œé¢
4. â¬œ å®ç°æ¨¡æ¿å¯¼å…¥/å¯¼å‡º

### é˜¶æ®µ 3: é«˜çº§åŠŸèƒ½
1. â¬œ å®ç°æ“ä½œå–æ¶ˆ
2. â¬œ å®ç°ç»“æœå¯¼å‡º
3. â¬œ å®ç°æ‰¹é‡ä»»åŠ¡å†å²
4. â¬œ å®ç°æ‰¹é‡ä»»åŠ¡è°ƒåº¦

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- æ‰¹é‡å¤„ç†å™¨åŸºç¡€åŠŸèƒ½
- é”™è¯¯å¤„ç†
- è¿›åº¦æŠ¥å‘Š
- å–æ¶ˆåŠŸèƒ½

### é›†æˆæµ‹è¯•
- å‰åç«¯é€šä¿¡
- å¤šæ–‡ä»¶å¤„ç†
- ä¸åŒæ“ä½œç±»å‹
- æ¨¡æ¿åŠŸèƒ½

### æ€§èƒ½æµ‹è¯•
- å¤§é‡æ–‡ä»¶å¤„ç†ï¼ˆ100+ æ–‡ä»¶ï¼‰
- å¤§æ–‡ä»¶å¤„ç†
- å†…å­˜ä½¿ç”¨
- å¤„ç†é€Ÿåº¦

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
- ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼ŒèŠ‚çœæ—¶é—´
- æ¸…æ™°çš„è¿›åº¦æ˜¾ç¤ºï¼Œäº†è§£å¤„ç†çŠ¶æ€
- è¯¦ç»†çš„ç»“æœæ‘˜è¦ï¼Œå¿«é€Ÿå®šä½é—®é¢˜
- æ¨¡æ¿åŠŸèƒ½ï¼Œé‡å¤ä»»åŠ¡ä¸€é”®æ‰§è¡Œ

### æ€§èƒ½æŒ‡æ ‡
- æ”¯æŒåŒæ—¶å¤„ç† 100+ æ–‡ä»¶
- å•æ–‡ä»¶å¤„ç†æ—¶é—´ < 5 ç§’
- å†…å­˜ä½¿ç”¨ < 500MB
- UI å“åº”æ—¶é—´ < 100ms

---

**è®¾è®¡å®Œæˆæ—¶é—´**: 2026-01-19
**è®¾è®¡è€…**: Kiro AI Assistant
**çŠ¶æ€**: ğŸ“ è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½
