# Python 后端功能使用指南

## 概述

Python 后端现在已经完全集成了 Excel 处理功能，可以通过前端界面直接使用。

## 支持的功能

### 📁 文件操作

#### 1. 加载文件
- **功能**: 加载 Excel 文件（.xlsx, .xls）
- **操作**: 点击"浏览文件"或拖拽文件到界面
- **返回**: 文件信息（文件名、大小、工作表列表等）

#### 2. 保存文件
- **功能**: 保存当前文件
- **操作**: 点击"保存文件"按钮
- **特性**: 
  - 自动创建备份
  - 最多保留 5 个备份
  - 备份保存在 `.{filename}_backups/` 目录

#### 3. 关闭文件
- **功能**: 关闭当前打开的文件
- **操作**: 点击"关闭文件"按钮
- **特性**: 会弹出确认对话框

### ✏️ 内容处理

#### 1. 删除空白行
- **功能**: 删除所有单元格均为空的行
- **操作**: 在"内容处理"页面点击"删除空白行"
- **应用范围**: 所有工作表
- **返回**: 每个工作表删除的行数

#### 2. 清除空白单元格
- **功能**: 清除空白单元格内容但保留结构
- **操作**: 点击"清除空白单元格"
- **应用范围**: 所有工作表
- **返回**: 清除的单元格数量

#### 3. 删除公式
- **功能**: 将公式替换为计算结果值
- **操作**: 点击"删除公式"
- **应用范围**: 所有工作表
- **特性**: 保持单元格格式不变
- **返回**: 删除的公式数量

#### 4. 删除重复行
- **功能**: 删除完全重复的数据行
- **操作**: 点击"删除重复行"
- **应用范围**: 所有工作表
- **特性**: 保留第一次出现的行
- **返回**: 删除的重复行数量

#### 5. 替换内容
- **功能**: 按规则查找并替换单元格内容
- **操作**: 
  1. 输入查找内容
  2. 输入替换内容
  3. 选择选项（区分大小写、使用正则表达式）
  4. 点击"执行替换"
- **应用范围**: 所有工作表
- **返回**: 替换的单元格数量

## 使用流程

### 基本流程

```
1. 加载文件
   ↓
2. 选择操作（内容处理）
   ↓
3. 查看进度和结果
   ↓
4. 保存文件
   ↓
5. 关闭文件
```

### 示例：清理 Excel 文件

```
1. 点击"浏览文件"选择 Excel 文件
   → 文件信息显示在界面上

2. 切换到"内容处理"页面

3. 点击"删除空白行"
   → 进度条显示处理进度
   → 完成后显示删除的行数

4. 点击"删除重复行"
   → 进度条显示处理进度
   → 完成后显示删除的重复行数

5. 点击"保存文件"
   → 文件保存成功
   → 自动创建备份

6. 点击"关闭文件"
   → 确认后关闭文件
```

## 进度显示

所有操作都会显示实时进度：

```
正在处理工作表: 测试数据 (1/2)
进度: 50%
```

## 错误处理

### 常见错误

#### 1. 文件不存在
```
错误: 文件不存在
建议: 请检查文件路径是否正确
```

#### 2. 文件被占用
```
错误: 文件正在被其他程序使用
建议: 请关闭 Microsoft Excel 或其他正在使用该文件的程序
```

#### 3. 文件损坏
```
错误: 文件已损坏或格式不正确
建议: 请检查文件是否完整，或尝试使用 Excel 修复该文件
```

#### 4. 没有加载文件
```
错误: 没有加载的文件
建议: 请先加载一个 Excel 文件
```

## 操作结果

每个操作都会返回详细的结果信息：

### 删除空白行
```json
{
  "operation": "删除空白行",
  "total_sheets": 2,
  "success_count": 2,
  "results": [
    {
      "sheet_name": "测试数据",
      "deleted_count": 5,
      "original_rows": 100,
      "remaining_rows": 95
    },
    {
      "sheet_name": "销售数据",
      "deleted_count": 3,
      "original_rows": 50,
      "remaining_rows": 47
    }
  ]
}
```

### 替换内容
```json
{
  "operation": "替换内容",
  "total_sheets": 2,
  "success_count": 2,
  "results": [
    {
      "sheet_name": "测试数据",
      "replace_count": 10,
      "find_text": "旧文本",
      "replace_text": "新文本"
    }
  ]
}
```

## 备份机制

### 自动备份
- 保存文件时自动创建备份
- 备份文件命名格式: `{filename}_{timestamp}.backup.xlsx`
- 备份保存在: `.{filename}_backups/` 目录

### 备份管理
- 最多保留 5 个备份
- 自动删除最旧的备份
- 按时间排序（最新的在前）

### 备份示例
```
原文件: data.xlsx

备份目录: .data_backups/
  ├── data_20260119_143025_123456.backup.xlsx  (最新)
  ├── data_20260119_142015_654321.backup.xlsx
  ├── data_20260119_141005_987654.backup.xlsx
  ├── data_20260119_140000_456789.backup.xlsx
  └── data_20260119_135000_321654.backup.xlsx  (最旧)
```

## 性能说明

### 处理速度
- 小文件（< 1MB）: 几乎瞬间完成
- 中等文件（1-10MB）: 1-5 秒
- 大文件（> 10MB）: 5-30 秒

### 内存使用
- Python 进程: ~30 MB
- 工作簿内存: 取决于文件大小
- 建议: 处理大文件时关闭其他程序

### 优化建议
1. 一次只打开一个文件
2. 处理完成后及时关闭文件
3. 定期清理备份文件
4. 大文件分批处理

## 注意事项

### ⚠️ 重要提示

1. **保存前备份**
   - 系统会自动创建备份
   - 建议手动备份重要文件

2. **文件占用**
   - 处理文件时请关闭 Excel
   - 避免多个程序同时访问文件

3. **格式支持**
   - 支持 .xlsx（Excel 2007+）
   - 支持 .xls（Excel 97-2003）
   - 不支持 .csv（将在后续版本支持）

4. **数据安全**
   - 操作不可撤销（除非从备份恢复）
   - 重要操作前请确认

5. **性能考虑**
   - 大文件处理需要时间
   - 请耐心等待进度完成
   - 不要在处理过程中关闭应用

## 快捷键

- `Ctrl+O` - 打开文件
- `Ctrl+S` - 保存文件
- `Ctrl+W` - 关闭文件
- `F1` - 打开帮助

## 常见问题

### Q1: 为什么操作后看不到变化？
**A**: 需要保存文件后才能看到变化。操作只是修改了内存中的工作簿，需要点击"保存文件"才会写入磁盘。

### Q2: 可以撤销操作吗？
**A**: 目前不支持撤销。但系统会自动创建备份，可以从备份恢复。

### Q3: 为什么文件保存失败？
**A**: 可能的原因：
- 文件被 Excel 或其他程序占用
- 磁盘空间不足
- 没有写入权限

### Q4: 备份文件在哪里？
**A**: 备份文件保存在原文件所在目录的 `.{filename}_backups/` 子目录中。

### Q5: 如何从备份恢复？
**A**: 
1. 找到备份目录
2. 选择要恢复的备份文件
3. 复制到原文件位置
4. 重命名为原文件名

### Q6: 处理大文件很慢怎么办？
**A**: 
- 关闭其他程序释放内存
- 分批处理（拆分文件）
- 只处理需要的工作表

### Q7: 支持哪些文件格式？
**A**: 
- ✅ .xlsx（Excel 2007+）
- ✅ .xls（Excel 97-2003）
- ⏳ .csv（计划支持）
- ⏳ .xlsm（计划支持）

## 技术支持

如果遇到问题：
1. 查看操作日志（"操作日志"页面）
2. 检查错误提示和建议
3. 尝试重启应用
4. 查看备份文件

## 更新日志

### v1.0.0 (2026-01-19)
- ✅ 实现文件加载功能
- ✅ 实现文件保存功能
- ✅ 实现自动备份机制
- ✅ 实现删除空白行
- ✅ 实现清除空白单元格
- ✅ 实现删除公式
- ✅ 实现删除重复行
- ✅ 实现替换内容
- ✅ 实现进度报告
- ✅ 实现错误处理

---

**文档版本**: 1.0.0  
**更新时间**: 2026-01-19  
**适用版本**: Excel 工具箱 v1.0.0
